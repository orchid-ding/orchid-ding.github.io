<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zookeeper分布式协调框架 | clivia‘s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="Java后端、大数据等技术博客，专注于各种技术总结。Java、高并发、hadoop、spark、hbase、hive、zookeeper、mysql、mongodb、redis">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.027adcb0.css" as="style"><link rel="preload" href="/assets/js/app.06f86fe0.js" as="script"><link rel="preload" href="/assets/js/2.ed69dcfc.js" as="script"><link rel="preload" href="/assets/js/3.b6cd915d.js" as="script"><link rel="preload" href="/assets/js/16.ad74e0a9.js" as="script"><link rel="prefetch" href="/assets/js/10.2b0a2d8d.js"><link rel="prefetch" href="/assets/js/100.16d5c2bc.js"><link rel="prefetch" href="/assets/js/101.c4ff0a78.js"><link rel="prefetch" href="/assets/js/102.4e574824.js"><link rel="prefetch" href="/assets/js/103.ac1661b8.js"><link rel="prefetch" href="/assets/js/104.dfdf274c.js"><link rel="prefetch" href="/assets/js/105.f792ba33.js"><link rel="prefetch" href="/assets/js/106.4347b2a7.js"><link rel="prefetch" href="/assets/js/107.7248a258.js"><link rel="prefetch" href="/assets/js/108.a3c43671.js"><link rel="prefetch" href="/assets/js/109.e8c087b3.js"><link rel="prefetch" href="/assets/js/11.0c3d61f1.js"><link rel="prefetch" href="/assets/js/110.2b89ad56.js"><link rel="prefetch" href="/assets/js/111.d35e07d0.js"><link rel="prefetch" href="/assets/js/112.2402331a.js"><link rel="prefetch" href="/assets/js/113.82a39665.js"><link rel="prefetch" href="/assets/js/114.4c8d3fcb.js"><link rel="prefetch" href="/assets/js/115.f038010e.js"><link rel="prefetch" href="/assets/js/116.c7865d0c.js"><link rel="prefetch" href="/assets/js/117.2729b824.js"><link rel="prefetch" href="/assets/js/118.b8c9bb1f.js"><link rel="prefetch" href="/assets/js/119.a9eea003.js"><link rel="prefetch" href="/assets/js/12.e4b75a11.js"><link rel="prefetch" href="/assets/js/120.06f1eb1b.js"><link rel="prefetch" href="/assets/js/121.354a7fd4.js"><link rel="prefetch" href="/assets/js/122.af00dd2b.js"><link rel="prefetch" href="/assets/js/123.976e22ad.js"><link rel="prefetch" href="/assets/js/124.de810dba.js"><link rel="prefetch" href="/assets/js/125.2c17fa05.js"><link rel="prefetch" href="/assets/js/126.ffeb8997.js"><link rel="prefetch" href="/assets/js/127.6b2f64dd.js"><link rel="prefetch" href="/assets/js/128.f9b62119.js"><link rel="prefetch" href="/assets/js/129.ce5c5c0e.js"><link rel="prefetch" href="/assets/js/13.2c54c92b.js"><link rel="prefetch" href="/assets/js/130.7db38d34.js"><link rel="prefetch" href="/assets/js/131.5abdd66a.js"><link rel="prefetch" href="/assets/js/132.5dd5eece.js"><link rel="prefetch" href="/assets/js/133.651d4b9b.js"><link rel="prefetch" href="/assets/js/134.68173250.js"><link rel="prefetch" href="/assets/js/135.ca520569.js"><link rel="prefetch" href="/assets/js/136.1515cd12.js"><link rel="prefetch" href="/assets/js/137.d783808b.js"><link rel="prefetch" href="/assets/js/138.05efd534.js"><link rel="prefetch" href="/assets/js/139.a65dce22.js"><link rel="prefetch" href="/assets/js/14.5cb33b3a.js"><link rel="prefetch" href="/assets/js/140.44dc5c4e.js"><link rel="prefetch" href="/assets/js/141.0632e3aa.js"><link rel="prefetch" href="/assets/js/142.66ac9883.js"><link rel="prefetch" href="/assets/js/143.8a75f55a.js"><link rel="prefetch" href="/assets/js/144.349bba43.js"><link rel="prefetch" href="/assets/js/15.06dff62d.js"><link rel="prefetch" href="/assets/js/17.e0d7a93c.js"><link rel="prefetch" href="/assets/js/18.0c217b19.js"><link rel="prefetch" href="/assets/js/19.33d29011.js"><link rel="prefetch" href="/assets/js/20.5c47e53a.js"><link rel="prefetch" href="/assets/js/21.4623dcf3.js"><link rel="prefetch" href="/assets/js/22.1d2819bf.js"><link rel="prefetch" href="/assets/js/23.da3264cc.js"><link rel="prefetch" href="/assets/js/24.a3976766.js"><link rel="prefetch" href="/assets/js/25.52b1b746.js"><link rel="prefetch" href="/assets/js/26.527a58d4.js"><link rel="prefetch" href="/assets/js/27.1a611ca9.js"><link rel="prefetch" href="/assets/js/28.19848920.js"><link rel="prefetch" href="/assets/js/29.0399b7cc.js"><link rel="prefetch" href="/assets/js/30.f4967fc4.js"><link rel="prefetch" href="/assets/js/31.ec15c096.js"><link rel="prefetch" href="/assets/js/32.ea29ed83.js"><link rel="prefetch" href="/assets/js/33.2506e8df.js"><link rel="prefetch" href="/assets/js/34.b317cb6a.js"><link rel="prefetch" href="/assets/js/35.e98b1f8e.js"><link rel="prefetch" href="/assets/js/36.5a3c937d.js"><link rel="prefetch" href="/assets/js/37.d8e66f15.js"><link rel="prefetch" href="/assets/js/38.583bd78a.js"><link rel="prefetch" href="/assets/js/39.02884927.js"><link rel="prefetch" href="/assets/js/4.4f8d037f.js"><link rel="prefetch" href="/assets/js/40.11d31d5e.js"><link rel="prefetch" href="/assets/js/41.e3b7229f.js"><link rel="prefetch" href="/assets/js/42.ed31fd5c.js"><link rel="prefetch" href="/assets/js/43.71601b99.js"><link rel="prefetch" href="/assets/js/44.7235eb98.js"><link rel="prefetch" href="/assets/js/45.8adef6f7.js"><link rel="prefetch" href="/assets/js/46.44d68224.js"><link rel="prefetch" href="/assets/js/47.ec6b4de8.js"><link rel="prefetch" href="/assets/js/48.ee56118d.js"><link rel="prefetch" href="/assets/js/49.0f6101ee.js"><link rel="prefetch" href="/assets/js/5.0e4db68d.js"><link rel="prefetch" href="/assets/js/50.2d01b40c.js"><link rel="prefetch" href="/assets/js/51.ddf132cb.js"><link rel="prefetch" href="/assets/js/52.fbc9619b.js"><link rel="prefetch" href="/assets/js/53.089b304e.js"><link rel="prefetch" href="/assets/js/54.34c0d377.js"><link rel="prefetch" href="/assets/js/55.41e71cff.js"><link rel="prefetch" href="/assets/js/56.ed6b0ac8.js"><link rel="prefetch" href="/assets/js/57.538bf884.js"><link rel="prefetch" href="/assets/js/58.d0051104.js"><link rel="prefetch" href="/assets/js/59.00792d53.js"><link rel="prefetch" href="/assets/js/6.6a15c5c7.js"><link rel="prefetch" href="/assets/js/60.44529245.js"><link rel="prefetch" href="/assets/js/61.6a6e2fe6.js"><link rel="prefetch" href="/assets/js/62.b02509d6.js"><link rel="prefetch" href="/assets/js/63.c865f599.js"><link rel="prefetch" href="/assets/js/64.7aafe0f4.js"><link rel="prefetch" href="/assets/js/65.029254a7.js"><link rel="prefetch" href="/assets/js/66.1d8c00be.js"><link rel="prefetch" href="/assets/js/67.191949ec.js"><link rel="prefetch" href="/assets/js/68.fc11d430.js"><link rel="prefetch" href="/assets/js/69.5e5d346e.js"><link rel="prefetch" href="/assets/js/7.4353a828.js"><link rel="prefetch" href="/assets/js/70.61cd3f71.js"><link rel="prefetch" href="/assets/js/71.1a87ddd4.js"><link rel="prefetch" href="/assets/js/72.f561b5cf.js"><link rel="prefetch" href="/assets/js/73.d1c67ae7.js"><link rel="prefetch" href="/assets/js/74.3725d6d7.js"><link rel="prefetch" href="/assets/js/75.310c7556.js"><link rel="prefetch" href="/assets/js/76.b8a53386.js"><link rel="prefetch" href="/assets/js/77.e04be33a.js"><link rel="prefetch" href="/assets/js/78.17c06f28.js"><link rel="prefetch" href="/assets/js/79.3ff2fb40.js"><link rel="prefetch" href="/assets/js/8.248194f5.js"><link rel="prefetch" href="/assets/js/80.96d575dc.js"><link rel="prefetch" href="/assets/js/81.770ca2a4.js"><link rel="prefetch" href="/assets/js/82.8900493c.js"><link rel="prefetch" href="/assets/js/83.4716d242.js"><link rel="prefetch" href="/assets/js/84.5ae9874f.js"><link rel="prefetch" href="/assets/js/85.924e7d3d.js"><link rel="prefetch" href="/assets/js/86.5073d16d.js"><link rel="prefetch" href="/assets/js/87.1148acd0.js"><link rel="prefetch" href="/assets/js/88.629d8beb.js"><link rel="prefetch" href="/assets/js/89.36b4cdb0.js"><link rel="prefetch" href="/assets/js/9.85151a25.js"><link rel="prefetch" href="/assets/js/90.fac275aa.js"><link rel="prefetch" href="/assets/js/91.93484ec9.js"><link rel="prefetch" href="/assets/js/92.01e42c63.js"><link rel="prefetch" href="/assets/js/93.50a55dd7.js"><link rel="prefetch" href="/assets/js/94.6a3f96c8.js"><link rel="prefetch" href="/assets/js/95.7dd7befb.js"><link rel="prefetch" href="/assets/js/96.38d049b2.js"><link rel="prefetch" href="/assets/js/97.a129eb48.js"><link rel="prefetch" href="/assets/js/98.f848c937.js"><link rel="prefetch" href="/assets/js/99.2dc3271b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.027adcb0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/C-logo.png" alt="clivia‘s blog" class="logo"> <span class="site-name can-hide">clivia‘s blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link">大数据</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/project/" class="nav-link">项目</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://gitee.com/kflys/clivia-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Gitee
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>clivia’s blog</h3> <span>专注于后端开发，致力于简洁知识。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/bigdata/" class="nav-link">大数据</a></div><div class="nav-item"><a href="/technology/" class="nav-link">技术</a></div><div class="nav-item"><a href="/project/" class="nav-link">项目</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://gitee.com/kflys/clivia-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Gitee
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>大数据文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>大数据辅助框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>分布式协调框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/20dad1/" aria-current="page" class="active sidebar-link">Zookeeper分布式协调框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_1-zookeeper" class="sidebar-link">1. zookeeper</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_1-1-命令行" class="sidebar-link">1.1 命令行</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_1-2-java-api" class="sidebar-link">1.2 Java API</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-基本概念和操作" class="sidebar-link">2. 基本概念和操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-1-数据结构" class="sidebar-link">2.1 数据结构</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-2-数据节点znode" class="sidebar-link">2.2 数据节点ZNode</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-3-会话-session" class="sidebar-link">2.3 会话（Session)</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-4-事务zxid" class="sidebar-link">2.4 事务zxid</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-5-watcher监视与通知" class="sidebar-link">2.5 Watcher监视与通知</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-5-1-获取最新数据" class="sidebar-link">2.5.1 获取最新数据</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_2-5-2-事件监听器" class="sidebar-link">2.5.2 事件监听器；</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_3-工作原理" class="sidebar-link">3. 工作原理</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_4-应用场景" class="sidebar-link">4. 应用场景</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_5-acl访问控制列表" class="sidebar-link">5. ACL访问控制列表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_5-1-设置acl" class="sidebar-link">5.1 设置ACL</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_6-hdfs-ha方案" class="sidebar-link">6. HDFS HA方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_6-1-原理" class="sidebar-link">6.1 原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_7-zookeeper读写" class="sidebar-link">7. ZooKeeper读写</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_7-1-zookeeper集群架构图" class="sidebar-link">7.1 ZooKeeper集群架构图</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_7-2-读操作" class="sidebar-link">7.2 读操作</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_7-3-写操作" class="sidebar-link">7.3 写操作</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_7-4-zookeeper状态同步" class="sidebar-link">7.4 ZooKeeper状态同步</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_8-zookeeper服务" class="sidebar-link">8. ZooKeeper服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_8-1-架构问题" class="sidebar-link">8.1 架构问题</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_8-2-全新集群leader选举" class="sidebar-link">8.2 全新集群leader选举</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_9-zab算法" class="sidebar-link">9. ZAB算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/20dad1/#_9-1-仲裁quorum" class="sidebar-link">9.1 仲裁quorum</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_9-2-网络分区、脑裂" class="sidebar-link">9.2 网络分区、脑裂</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_9-3-zab算法" class="sidebar-link">9.3 ZAB算法</a></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_9-4-zookeeper服务器个数" class="sidebar-link">9.4 ZooKeeper服务器个数</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/20dad1/#_10-分布式锁" class="sidebar-link">10. 分布式锁</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>大数据缓冲层框架</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-70a2d273><div class="articleInfo" data-v-70a2d273><ul class="breadcrumbs" data-v-70a2d273><li data-v-70a2d273><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-70a2d273></a></li> <li data-v-70a2d273><a href="/bigdata" title="大数据-目录页" data-v-70a2d273>大数据</a></li> <li data-v-70a2d273><a href="/bigdata/#大数据文章" title="大数据#大数据文章" data-v-70a2d273>大数据文章</a></li> <li data-v-70a2d273><a href="/bigdata/#分布式协调框架" title="大数据#分布式协调框架" data-v-70a2d273>分布式协调框架</a></li></ul> <div class="info" data-v-70a2d273><div title="作者" class="author iconfont icon-touxiang" data-v-70a2d273><a href="https://gitee.com/kflys" target="_blank" title="作者" class="beLink" data-v-70a2d273>kflys</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-70a2d273><a href="javascript:;" data-v-70a2d273>2021-10-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          Zookeeper分布式协调框架
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><ul><li>ZooKeeper简单易用，能够很好的解决分布式框架在运行中，出现的各种协调问题。比如集群master主备切换、节点的上下线感知、统一命名服务、状态同步服务、集群管理、分布式应用配置项的管理等等</li> <li>是Google的Chubby的一个开源实现版
</li> <li>一个分布式的，开源的，用于分布式应用程序的协调服务（service）、主从架构。</li> <li>Zookeeper 作为一个分布式的服务框架
<ul><li>主要用来解决分布式集群中应用系统的一致性问题</li> <li>它能提供基于类似于文件系统的<strong>目录节点树</strong>方式的数据存储，</li> <li>Zookeeper 作用主要是用来维护和监控存储的数据的状态变化，通过监控这些数据状态的变化，从而达到基于数据的集群管理</li></ul></li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201906091839.png" alt="image"></p> <h2 id="_1-zookeeper"><a href="#_1-zookeeper" class="header-anchor">#</a> 1. zookeeper</h2> <h3 id="_1-1-命令行"><a href="#_1-1-命令行" class="header-anchor">#</a> 1.1 命令行</h3> <ul><li>集群命令（<strong>每个节点运行此命令</strong>）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 启动ZooKeeper集群；在ZooKeeper集群中的每个节点执行此命令
${ZK_HOME}/bin/zkServer.sh start
# 停止ZooKeeper集群（每个节点执行以下命令）
${ZK_HOME}/bin/zkServer.sh stop
# 查看集群状态（每个节点执行此命令）
${ZK_HOME}/bin/zkServer.sh status
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 使用ZooKeeper自带的脚本，连接ZooKeeper的服务器
zkCli.sh -server node01:2181,node02:2181,node03:2181
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#查看ZooKeeper根目录/下的文件列表
ls /
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#创建节点，并指定数据
create /kfly    kfly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#获得某节点的数据
get /kfly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>#修改节点的数据
set /kfly kfly_top
#删除节点
delete /kfly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-2-java-api"><a href="#_1-2-java-api" class="header-anchor">#</a> 1.2 Java API</h3> <ul><li>[Curator官网]</li></ul> <p>http://curator.apache.org/</p> <ul><li>Curator编程</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 重试连接策略，失败重试次数；每次休眠5000毫秒
// RetryPolicy policy = new ExponentialBackoffRetry(3000, 3);
RetryNTimes retryPolicy = new RetryNTimes(10, 5000);
// 设置客户端参数，参数1：指定连接的服务器集端口列表；参数2：重试策略
client = CuratorFrameworkFactory.newClient(ZK_ADDRESS, retryPolicy);
// 启动客户端，连接到zk集群
client.start();

///a/b/c
client.create().
 creatingParentsIfNeeded().
 withMode(CreateMode.PERSISTENT).
 forPath(&quot;/kfly/top/orchid&quot;, zNodeData.getBytes());

// 查询节点列表
client.getChildren().forPath(&quot;/&quot;)
// 删除节点
client.delete().forPath(ZK_PATH);
// 查询节点数据
client.getData().forPath(ZK_PATH)
// 修改节点数据
client.setData().forPath(ZK_PATH, data2.getBytes())
    
//设置节点的cache
TreeCache treeCache = new TreeCache(client, &quot;/zk_test&quot;);
//设置监听器和处理过程
treeCache.getListenable().addListener(new TreeCacheListener(){

})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_2-基本概念和操作"><a href="#_2-基本概念和操作" class="header-anchor">#</a> 2. 基本概念和操作</h2> <blockquote><p>分布式通信有几种方式</p> <p>1、直接通过网络连接的方式进行通信；</p> <p>2、通过共享存储的方式，来进行通信或数据的传输</p> <p>ZooKeeper使用第二种方式，提供分布式协调服务</p></blockquote> <h3 id="_2-1-数据结构"><a href="#_2-1-数据结构" class="header-anchor">#</a> 2.1 数据结构</h3> <p><strong>ZooKeeper=①简版文件系统(Znode)+②原语+③通知机制(Watcher)。</strong></p> <ul><li>ZK文件系统
<ul><li>基于类似于文件系统的<strong>目录节点树</strong>方式的数据存储</li></ul></li> <li>原语
<ul><li>可简单理解成ZooKeeper的基本的命令</li></ul></li> <li>Watcher（监听器）</li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/fcfaaf51f3deb48f36625a57fa1f3a292df57834.jpg" alt="image"></p> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201909181739.png" alt="image"></p> <h3 id="_2-2-数据节点znode"><a href="#_2-2-数据节点znode" class="header-anchor">#</a> 2.2 <strong>数据节点</strong>ZNode</h3> <table><thead><tr><th></th> <th>持久节点</th> <th>临时节点</th></tr></thead> <tbody><tr><td>非有序节点</td> <td>create</td> <td>create -e</td></tr> <tr><td>有序节点</td> <td>create -s</td> <td>create -s -e</td></tr></tbody></table> <h3 id="_2-3-会话-session"><a href="#_2-3-会话-session" class="header-anchor">#</a> 2.3 会话（Session)</h3> <ul><li>客户端要对ZooKeeper集群进行读写操作，得先与某一ZooKeeper服务器建立TCP长连接；此TCP长连接称为建立一个会话Session。</li> <li>每个会话有超时时间：SessionTimeout
<ul><li>当客户端与集群建立会话后，如果超过SessionTimeout时间，两者间没有通信，会话超时</li></ul></li></ul> <p><strong>特点</strong></p> <ul><li>客户端打开一个Session中的请求以FIFO（先进先出）的顺序执行；
<ul><li>如客户端client01与集群建立会话后，先发出一个create请求，再发出一个get请求；</li> <li>那么在执行时，会先执行create，再执行get</li></ul></li> <li>若打开两个Session，无法保证Session间，请求FIFO执行；只能保证一个session中请求的FIFO</li></ul> <p><strong>生命周期</strong></p> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201905311514.png" alt="image"></p> <h3 id="_2-4-事务zxid"><a href="#_2-4-事务zxid" class="header-anchor">#</a> 2.4 事务zxid</h3> <ul><li>事务
<ul><li>客户端的写请求，会对ZooKeeper中的数据做出更改；如增删改的操作</li> <li>每次写请求，会生成一次事务</li> <li>每个事务有一个全局唯一的事务ID，用 ZXID 表示；全局自增</li></ul></li> <li>事务特点
<ul><li>ACID：</li> <li>原子性atomicity | 一致性consistency | 隔离性isolation | 持久性durability</li></ul></li> <li>ZXID结构：
<ul><li>通常是一个64位的数字。由<strong>epoch+counter</strong>组成</li> <li>epoch、counter各32位</li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /kfly/install/zookeeper-3.4.5-cdh5.14.2/zkdatas/version-2
cat currentEpoch 
4 # 记录当前leader是选举出来的第几任

get /kfly kfly
cZxid = 0x400000007 # 第四任leader通过的第七个事务
# zxid = epoch(32位) + counter(32位)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-5-watcher监视与通知"><a href="#_2-5-watcher监视与通知" class="header-anchor">#</a> 2.5 Watcher监视与通知</h3> <h3 id="_2-5-1-获取最新数据"><a href="#_2-5-1-获取最新数据" class="header-anchor">#</a> 2.5.1 获取最新数据</h3> <ul><li><strong>方式一</strong>轮询：ZooKeeper以远程服务的方式，被客户端访问；客户端以轮询的方式获得znode数据，效率会比较低（代价比较大）</li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201905291811.png" alt="image"></p> <ul><li><strong>方式二</strong> 基于通知的机制：
<ul><li>客户端在znode上注册一个Watcher监视器</li> <li>当znode上数据出现变化，watcher监测到此变化，通知客户端</li></ul></li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201905291818.png" alt="image"></p> <h3 id="_2-5-2-事件监听器"><a href="#_2-5-2-事件监听器" class="header-anchor">#</a> 2.5.2 事件监听器；</h3> <ul><li>watcher用于监听znode上的某些事件
<ul><li>比如znode数据修改、节点增删等；</li> <li>当监听到事件后，watcher会触发通知客户端</li></ul></li></ul> <blockquote><p>注意：<strong>Watcher是一个单次触发的操作</strong></p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code># stat path [watch] 查看path节点状态
# ls path [watch]  查看节点有哪些子节点
# ls2 path [watch] 查看节点有哪些子节点、状态、相当于ls+stat
# get path [watch] 获得节点各种数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_3-工作原理"><a href="#_3-工作原理" class="header-anchor">#</a> 3. 工作原理</h2> <ul><li>ZooKeeper使用原子广播协议叫做Zab(ZooKeeper Automic Broadcast)协议</li> <li>Zab协议有两种模式
<ul><li><strong>恢复模式（选主）</strong>：因为ZooKeeper也是主从架构；当ZooKeeper集群没有主的角色leader时，从众多服务器中选举leader时，处于此模式</li> <li><strong>广播模式（同步）</strong>：当集群有了leader后，客户端向ZooKeeper集群读写数据时，集群处于此模式</li></ul></li> <li>为了保证事务的顺序一致性，ZooKeeper采用了递增的事务id号（zxid）来标识事务，所有提议（proposal）都有zxid</li></ul> <h2 id="_4-应用场景"><a href="#_4-应用场景" class="header-anchor">#</a> 4. 应用场景</h2> <ul><li>ZooKeeper应用场景</li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/20170221224856838.png" alt="image"></p> <ol><li>NameNode使用ZooKeeper实现高可用.</li> <li>Yarn ResourceManager使用ZooKeeper实现高可用.</li> <li>利用ZooKeeper对HBase集群做高可用配置</li> <li>kafka使用ZooKeeper
<ol><li>保存消息消费信息比如offset.</li> <li>用于检测崩溃</li></ol></li></ol> <ul><li>主题topic发现
<ul><li>保持主题的生产和消费状态</li></ul></li></ul> <h2 id="_5-acl访问控制列表"><a href="#_5-acl访问控制列表" class="header-anchor">#</a> 5. ACL访问控制列表</h2> <p>​		zk做为分布式架构中的重要中间件，通常会在上面以节点的方式存储一些关键信息，默认情况下，所有应用都可以读写任何节点，在复杂的应用中，这不太安全，ZK通过ACL机制来解决访问权限问题\</p> <p>​		ACL(Access Control List)可以设置某些客户端，对zookeeper服务器上节点的权限，如增删改查等</p> <p>​		ZooKeeper 采用 ACL（Access Control Lists）策略来进行权限控制。ZooKeeper 定义了如下5种权限。</p> <ul><li><p>CREATE: 创建<strong>子节点</strong>的权限。</p></li> <li><p>READ: 获取节点数据和子节点列表的权限。</p></li> <li><p>WRITE：更新节点数据的权限。</p></li> <li><p>DELETE: 删除<strong>子节点</strong>的权限。</p></li> <li><p>ADMIN: 设置节点ACL的权限。</p></li></ul> <blockquote><p>注意：CREATE 和 DELETE 都是针对子节点的权限控制。</p></blockquote> <h3 id="_5-1-设置acl"><a href="#_5-1-设置acl" class="header-anchor">#</a> 5.1 设置ACL</h3> <ol><li><p>五种权限简称</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CREATE -&gt; 增 -&gt; c
READ -&gt; 查 -&gt; r
WRITE -&gt; 改 -&gt; w
DELETE -&gt; 删 -&gt; d
ADMIN -&gt; 管理 -&gt; a
这5种权限简写为**crwda**
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>鉴权模式</p></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>- world：默认方式，相当于全世界都能访问
- auth：代表已经认证通过的用户(cli中可以通过addauth digest user:pwd 来添加当前上下文中的授权用户)
- digest：即用户名:密码这种方式认证，这也是业务系统中最常用的
- ip：使用Ip地址认证
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol><li>演示auth方式</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code># 1）增加一个认证用户
# addauth digest 用户名:密码明文
addauth digest kfly:kflt

# 2）设置权限
# setAcl /path auth:用户名:密码明文:权限
setAcl /zk_test auth:kfly:kfly:rw

# 3）查看ACL设置
getAcl /zk_test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_6-hdfs-ha方案"><a href="#_6-hdfs-ha方案" class="header-anchor">#</a> 6. HDFS HA方案</h2> <ul><li>关于ZooKeeper监听器有三个重要的逻辑：
<ul><li><strong>注册</strong>：客户端向ZooKeeper集群注册监听器</li> <li><strong>监听事件</strong>：监听器负责监听特定的事件</li> <li><strong>回调函数</strong>：当监听器监听到事件的发生后，调用注册监听器时定义的回调函数</li></ul></li></ul> <h3 id="_6-1-原理"><a href="#_6-1-原理" class="header-anchor">#</a> 6.1 原理</h3> <blockquote><p>关键逻辑：</p> <p>①监听器：<strong>注册、监听事件、回调函数</strong></p> <p>②共享存储：JournalNode</p></blockquote> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201905211519.png" alt="image"></p> <ul><li>在Hadoop 1.x版本，HDFS集群的NameNode一直存在单点故障问题：
<ul><li>集群只存在一个NameNode节点，它维护了HDFS所有的元数据信息</li> <li>当该节点所在服务器宕机或者服务不可用，整个HDFS集群处于不可用状态</li></ul></li> <li>Hadoop 2.x版本提出了高可用 (High Availability, HA) 解决方案</li></ul> <blockquote><p>HDFS HA方案，主要分两部分：</p> <p>①元数据同步</p> <p>②主备切换</p></blockquote> <ul><li>元数据同步</li> <li>在同一个HDFS集群，运行两个互为主备的NameNode节点。
<ul><li>一台为主Namenode节点，处于Active状态，一台为备NameNode节点，处于Standby状态。</li> <li>其中只有Active NameNode对外提供读写服务，Standby NameNode会根据Active NameNode的状态变化，在必要时<strong>切换</strong>成Active状态。</li> <li><strong>JournalNode集群</strong> <ul><li>在主备切换过程中，新的Active NameNode必须确保与原Active NamNode元数据同步完成，才能对外提供服务</li> <li>所以用JournalNode集群作为共享存储系统；</li> <li>当客户端对HDFS做操作，会在Active NameNode中edits.log文件中作日志记录，同时日志记录也会写入JournalNode集群；负责存储HDFS新产生的元数据</li> <li>当有新数据写入JournalNode集群时，Standby NameNode能监听到此情况，将新数据同步过来</li> <li>Active NameNode(写入)和Standby NameNode(读取)实现元数据同步</li> <li>另外，所有datanode会向两个主备namenode做block report</li></ul></li></ul></li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201909200732.png" alt="image"></p> <ul><li><p>②主备切换</p></li> <li><p><strong>ZKFC涉及角色</strong></p> <ul><li><p>每个NameNode节点上各有一个ZKFC进程</p></li> <li><p>ZKFC即ZKFailoverController，作为独立进程存在，负责控制NameNode的主备切换</p></li> <li><p>ZKFC会监控NameNode的健康状况，当发现Active NameNode异常时，通过Zookeeper集群进行namenode主备选举，完成Active和Standby状态的切换</p> <ul><li>ZKFC在启动时，同时会初始化HealthMonitor和ActiveStandbyElector服务</li> <li>ZKFC同时会向HealthMonitor和ActiveStandbyElector注册相应的回调方法（如上图的①回调、②回调）</li> <li><strong>HealthMonitor</strong>定时调用NameNode的HAServiceProtocol RPC接口(monitorHealth和getServiceStatus)，监控NameNode的健康状态并向ZKFC反馈</li> <li><strong>ActiveStandbyElector</strong>接收ZKFC的选举请求，通过Zookeeper自动完成namenode主备选举</li> <li>选举完成后回调ZKFC的主备切换方法对NameNode进行Active和Standby状态的切换</li></ul></li></ul></li> <li><p>**主备选举过程：**两个ZKFC通过各自ActiveStandbyElector发起NameNode的主备选举，这个过程利用Zookeeper的写一致性和临时节点机制实现</p> <ul><li>当发起一次<strong>主备</strong>选举时，ActiveStandbyElector会尝试在Zookeeper创建临时节点<code>/hadoop-ha/${dfs.nameservices}/ActiveStandbyElectorLock</code>，Zookeeper的写一致性保证最终只会有一个ActiveStandbyElector创建成功</li></ul></li> <li><p>ActiveStandbyElector从ZooKeeper获得选举结果</p> <ul><li>创建成功的 ActiveStandbyElector回调ZKFC的回调方法②，将对应的NameNode切换为Active NameNode状态</li></ul></li> <li><p>而创建失败的ActiveStandbyElector回调ZKFC的回调方法②，将对应的NameNode切换为Standby NameNode状态</p></li> <li><p>不管是否选举成功，所有ActiveStandbyElector都会在临时节点ActiveStandbyElectorLock上注册一个Watcher监听器，来监听这个节点的状态变化事件</p> <ul><li>如果Active NameNode对应的HealthMonitor检测到NameNode状态异常时，通知对应ZKFC</li></ul></li> <li><p>ZKFC会调用 ActiveStandbyElector 方法，删除在Zookeeper上创建的临时节点ActiveStandbyElectorLock</p> <ul><li>此时，Standby NameNode的ActiveStandbyElector注册的Watcher就会监听到此节点的 NodeDeleted事件。</li></ul></li> <li><p>收到这个事件后，此ActiveStandbyElector发起主备选举，成功创建临时节点ActiveStandbyElectorLock，如果创建成功，则Standby NameNode被选举为Active NameNode（过程同上）</p></li> <li><p><strong>如何防止脑裂</strong></p> <ul><li><p>脑裂
在分布式系统中双主现象又称为脑裂，由于Zookeeper的“假死”、长时间的垃圾回收或其它原因都可能导致双Active NameNode现象，此时两个NameNode都可以对外提供服务，无法保证数据一致性</p></li> <li><p>隔离</p> <p>​	对于生产环境，这种情况的出现是毁灭性的，必须通过自带的**隔离（Fencing）**机制预防此类情况</p></li> <li><p>原理</p> <ul><li><p>ActiveStandbyElector成功创建ActiveStandbyElectorLock临时节点后，会创建另一个ActiveBreadCrumb持久节点</p></li> <li><p>ActiveBreadCrumb持久节点保存了Active NameNode的地址信息</p></li> <li><p>当Active NameNode在正常的状态下断开Zookeeper Session，会一并删除临时节点ActiveStandbyElectorLock、持久节点ActiveBreadCrumb</p></li> <li><p>但是如果ActiveStandbyElector在异常的状态下关闭Zookeeper Session，那么持久节点ActiveBreadCrumb会保留下来（此时有可能由于active NameNode与ZooKeeper通信不畅导致，所以此NameNode<strong>还处于active状态</strong>）</p></li> <li><p>当另一个NameNode要由standy变成active状态时，会发现上一个Active NameNode遗留下来的ActiveBreadCrumb节点，那么会回调ZKFailoverController的方法对旧的Active NameNode进行隔离（fencing）</p> <blockquote><p>​		①首先ZKFC会尝试调用旧Active NameNode的HAServiceProtocol RPC接口的transitionToStandby方法，看能否将其状态切换为Standby</p> <p>​		②如果transitionToStandby方法切换状态失败，那么就需要执行Hadoop自带的隔离措施，Hadoop目前主要提供两种隔离措施：
sshfence：SSH to the Active NameNode and kill the process；
shellfence：run an arbitrary shell command to fence the Active NameNode</p> <p>​		③只有成功地fencing之后，选主成功的ActiveStandbyElector才会回调ZKFC的becomeActive方法将对应的NameNode切换为Active，开始对外提供服务</p></blockquote></li></ul></li></ul></li></ul> <h2 id="_7-zookeeper读写"><a href="#_7-zookeeper读写" class="header-anchor">#</a> 7. ZooKeeper读写</h2> <h3 id="_7-1-zookeeper集群架构图"><a href="#_7-1-zookeeper集群架构图" class="header-anchor">#</a> 7.1 ZooKeeper集群架构图</h3> <ul><li>ZooKeeper集群也是主从架构
<ul><li>主角色：leader</li> <li>从角色：follower或observer；统称为learner</li></ul></li></ul> <h3 id="_7-2-读操作"><a href="#_7-2-读操作" class="header-anchor">#</a> 7.2 读操作</h3> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201910251149.png" alt="image"></p> <ul><li>常见的读取操作，如ls /查看目录；get /zktest查询ZNode数据</li> <li>读操作
<ul><li>客户端先与某个ZK服务器建立Session</li> <li>然后，直接从此ZK服务器读取数据，并返回客户端即可</li> <li>关闭Session</li></ul></li></ul> <h3 id="_7-3-写操作"><a href="#_7-3-写操作" class="header-anchor">#</a> 7.3 写操作</h3> <ul><li>写操作比较复杂；为了便于理解，先举个生活中的例子：去银行存钱
<ul><li>银行柜台共有5个桂圆姐姐，编程从①到⑤，其中③是<strong>领导leader</strong></li> <li>有两个客户</li> <li>客户①找到桂圆①，说：昨天少给我存了1000万，现在需要给我加进去</li> <li>桂圆①说，对不起先生，我没有这么大的权限，请你稍等一下，我向领导<strong>leader</strong>③汇报一下</li> <li>领导③收到消息后，为了做出英明的决策，要征询下属的意见(<strong>proposal</strong>)①②④⑤</li> <li>只要有<strong>过半数quorum</strong>（5/2+1=3，包括leader自己）同意，则leader做出决定(<strong>commit</strong>)，同意此事</li> <li>leader告知所有下属follower，你们都记下此事生效</li> <li>桂圆①答复客户①，说已经给您账号里加了1000万</li></ul></li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image2019061212537.png" alt="image"></p> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201910251203.png" alt="image"></p> <ul><li>客户端写操作
<ul><li>①客户端向zk集群写入数据，如create /kfly；与一个follower建立Session连接，从节点follower01</li> <li>②follower将写请求转发给leader</li> <li>③leader收到消息后，发出<strong>proposal提案</strong>（创建/kfly），每个follower先<strong>记录下</strong>要创建/kfly</li> <li>④超过<strong>半数quorum</strong>（包括leader自己）同意提案，则leader提交<strong>commit提案</strong>，leader本地创建/kfly节点ZNode</li> <li>⑤leader通知所有follower，也commit提案；follower各自在本地创建/kfly</li> <li>⑥follower01响应client</li></ul></li></ul> <h3 id="_7-4-zookeeper状态同步"><a href="#_7-4-zookeeper状态同步" class="header-anchor">#</a> 7.4 ZooKeeper状态同步</h3> <blockquote><p>完成leader选举后，zk就进入ZooKeeper之间状态同步过程</p></blockquote> <ol><li>leader构建NEWLEADER封包，包含leader中最大的zxid值；广播给其它follower</li> <li>follower收到后，如果自己的最大zxid小于leader的，则需要与leader状态同步；否则不需要</li> <li>leader给需要同步的每个follower创建LearnerHandler线程，负责数据同步请求</li> <li>leader主线程等待LearnHandler线程处理结果</li> <li>只有多数follower完成同步，leader才开始对外服务，响应写请求</li> <li>LearnerHandler线程处理逻辑
<ol><li>接收follower封包FOLLOWERINFO，包含此follower最大zxid（代称f-max-zxid）</li> <li>f-max-zxid与leader最大zxid（代称l-max-zxid）比较</li> <li>若相等，说明当前follower是最新的</li> <li>另外，若在判断期间，有没有新提交的proposal
<ol><li>如果有那么会发送DIFF封包将有差异的数据同步过去.同时将follower没有的数据逐个发送COMMIT封包给follower要求记录下来.</li> <li>如果follower数据id更大,那么会发送TRUNC封包告知截除多余数据.</li> <li>如果这一阶段内没有提交的提议值,直接发送SNAP封包将快照同步发送给follower.</li></ol></li> <li>以上消息完毕之后,发送UPTODATE封包告知follower当前数据就是最新的了</li> <li>再次发送NEWLEADER封包宣称自己是leader,等待follower的响应.</li></ol></li></ol> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201906140856.png" alt="image"></p> <h2 id="_8-zookeeper服务"><a href="#_8-zookeeper服务" class="header-anchor">#</a> 8. ZooKeeper服务</h2> <h3 id="_8-1-架构问题"><a href="#_8-1-架构问题" class="header-anchor">#</a> 8.1 <strong>架构问题</strong></h3> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/zkservice.jpg" alt="image"></p> <ul><li>leader很重要？</li> <li>如果没有leader怎么办？
<ul><li>开始选举新的leader</li></ul></li> <li><strong>ZooKeeper服务器四种状态：</strong> <ul><li>looking：服务器处于寻找Leader群首的状态</li> <li>leading：服务器作为群首时的状态</li> <li>following：服务器作为follower跟随者时的状态</li> <li>observing：服务器作为观察者时的状态</li></ul></li></ul> <blockquote><p>leader选举分<strong>两种情况</strong></p> <ul><li><p>全新集群leader选举</p></li> <li><p>非全新集群leader选举</p></li></ul></blockquote> <h3 id="_8-2-全新集群leader选举"><a href="#_8-2-全新集群leader选举" class="header-anchor">#</a> 8.2 全新集群leader选举</h3> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201906130749.png" alt="image"></p> <ul><li><p>以3台机器组成的ZooKeeper集群为例</p></li> <li><p>原则：集群中过<strong>半数</strong>（多数派quorum）Server启动后，才能选举出Leader；</p> <ul><li><p>此处quorum数是多少？3/2+1=2</p></li> <li><p>即quorum=集群服务器数除以2，再加1</p></li></ul></li> <li><p>理解leader选举前，先了解几个概念</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- 选举过程中，每个server需发出投票；投票信息**vote信息**结构为(sid, zxid)

    全新集群，server1~3初始投票信息分别为：

   server1 -&gt;  **(1, 0)**
   server2 -&gt;  **(2, 0)**
   server3 -&gt;  **(3, 0)**
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><ul><li><strong>leader选举公式</strong>：
server1 vote信息 (sid1,zxid1)
server2 vote信息 (sid2,zxid2)
<strong>①zxid大的server胜出；</strong> <strong>②若zxid相等，再根据判断sid判断，sid大的胜出</strong></li></ul></li> <li><p>选举leader流程：</p> <blockquote><p>假设按照ZK1、ZK2、ZK3的依次启动</p></blockquote> <ul><li><p>启动ZK1后，投票给自己，vote信息(1,0)，没有过半数，选举不出leader</p></li> <li><p>再启动ZK2；ZK1和ZK2票投给自己及其他服务器；ZK1的投票为(1, 0)，ZK2的投票为(2, 0)</p></li> <li><p>处理投票。每个server将收到的多个投票做处理</p> <ul><li>如ZK1投给自己的票(1,0)与ZK2传过来的票(2,0)比较；</li> <li>利用leader选举公式，因为zxid都为0，相等；所以判断sid最大值；2&gt;1；ZK1更新自己的投票为(2, 0)</li> <li>ZK2也是如此逻辑，ZK2更新自己的投票为(2,0)</li></ul></li> <li><p>再次发起投票</p> <ul><li>ZK1、ZK2上的投票都是(2,0)</li> <li>发起投票后，ZK1上有一个自己的票(2,0)和一票来自ZK2的票(2,0)，这两票都选ZK2为leader</li> <li>ZK2上有一个自己的票(2,0)和一票来自ZK1的票(2,0)，这两票都选ZK2为leader</li> <li>统计投票。server统计投票信息，是否有半数server投同一个服务器为leader；
<ul><li>ZK2当选2票；多数</li></ul></li> <li>改变服务器状态。确定Leader后，各服务器更新自己的状态
<ul><li>更改ZK2状态从looking到leading，为Leader</li> <li>更改ZK1状态从looking到following，为Follower</li></ul></li></ul></li> <li><p>当K3启动时，发现已有Leader，不再选举，直接从LOOKING改为FOLLOWING</p></li></ul></li> <li><p>选举原理同上比较zxid、sid</p></li></ul> <h2 id="_9-zab算法"><a href="#_9-zab算法" class="header-anchor">#</a> 9. ZAB算法</h2> <h3 id="_9-1-仲裁quorum"><a href="#_9-1-仲裁quorum" class="header-anchor">#</a> 9.1 仲裁quorum</h3> <ul><li>什么是仲裁quorum？
<ul><li>发起proposal时，只要多数派同意，即可生效</li></ul></li> <li>为什么要仲裁？
<ul><li>多数据派不需要所有的服务器都响应，proposal就能生效</li> <li>且能提高集群的响应速度</li></ul></li> <li>quorum数如何选择？
<ul><li><strong>集群节点数 / 2 + 1</strong></li> <li>如3节点的集群：quorum数=3/2+1=2</li></ul></li></ul> <h3 id="_9-2-网络分区、脑裂"><a href="#_9-2-网络分区、脑裂" class="header-anchor">#</a> 9.2 网络分区、脑裂</h3> <ul><li><p>网络分区：网络通信故障，集群被分成了2部分</p></li> <li><p>脑裂：</p> <ul><li><p>原leader处于一个分区；</p></li> <li><p>另外一个分区选举出新的leader</p></li> <li><p>集群出现2个leader</p></li></ul></li></ul> <h3 id="_9-3-zab算法"><a href="#_9-3-zab算法" class="header-anchor">#</a> 9.3 ZAB算法</h3> <blockquote><p><a href="http://thesecretlivesofdata.com/raft/#replication" target="_blank" rel="noopener noreferrer">raft算法动图地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li><p><strong>ZAB与RAFT相似，区别如下：</strong>
1、zab心跳从follower到leader；raft相反
2、zab任期叫epoch</p></li> <li><p>一下以RAFT算法动图为例，分析ZAB算法</p></li></ul> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/%E8%84%91%E8%A3%82.gif" alt="image"></p> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/%E8%84%91%E8%A3%82-1560463867696.png" alt="image"></p> <h3 id="_9-4-zookeeper服务器个数"><a href="#_9-4-zookeeper服务器个数" class="header-anchor">#</a> 9.4 ZooKeeper服务器个数</h3> <ul><li>仲裁模式下，服务器个数最好为奇数个。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>quorum数=3/2+1=2
集群数             quorum数         最大可容灾数
5 / 2 + 1 = 3                           5-3=2
6 / 2 +1 =  4                           6-4=2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_10-分布式锁"><a href="#_10-分布式锁" class="header-anchor">#</a> 10. 分布式锁</h2> <p><img src="http://kflys.gitee.io/upic/2020/03/31/uPic/kfly-top/zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83%E6%A1%86%E6%9E%B6/assets/Image201906121639.png" alt="image"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>create -s -e /locker/node_ ndata
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote></blockquote></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://gitee.com/kflys/clivia-blog/edit/master/docs/01.大数据/10.大数据文章/11.分布式协调框架/01.Zookeeper分布式协调框架.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=zookeeper" title="标签">#zookeeper</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/20/2021, 3:34:39 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/bd6912/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">工作流调度Azkaban</div></a> <a href="/pages/2aec28/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Kafka缓冲层</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/bd6912/" class="prev">工作流调度Azkaban</a></span> <span class="next"><a href="/pages/2aec28/">Kafka缓冲层</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8e0b33/"><div>阿里官方Redis开发规范</div></a> <span>10-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/20a714/"><div>无监督学习</div></a> <span>01-26</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/e78220/"><div>模拟保存预加载</div></a> <span>01-26</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:clivia.pro@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/kflys" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://y.qq.com/n/ryqq/songDetail/003lgoEG1SWHmF" title="music" target="_blank" class="iconfont icon-erji"></a></div> <div><span> Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> | Powered by <a href="https://webify.cloudbase.net/" target="_blank">CloudBase Webify</a></span></div> <span>Clivia‘s <a href="https://gitee.com/kflys/clivia-blog" target="_blank">blog</a> </span>
    | Copyright © 2019-2022
    <span><a href="http://beian.miit.gov.cn/" target="_blank">皖ICP备2021014093号</a> </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;left:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><!----></div></div></div>
    <script src="/assets/js/app.06f86fe0.js" defer></script><script src="/assets/js/2.ed69dcfc.js" defer></script><script src="/assets/js/3.b6cd915d.js" defer></script><script src="/assets/js/16.ad74e0a9.js" defer></script>
  </body>
</html>