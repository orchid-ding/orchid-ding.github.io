<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="天行健、君子以自强不息；地势坤，君子以厚德载物。">
    <meta name="keyword"  content="兰草">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        大数据开发之HBase（四）微博案例 - Kaffir Lily的博客 | Kaffir Lily&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 君子谦谦，温和有礼，有才而不骄，得志而不傲，居于谷而不卑。 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>kfly</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="icon-font icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
 	   <li >
                <a href="/spec/">
                    <i class="icon-font icon-shouye1"></i>
                    <span>专题</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-hbase微博实战案例"><span class="toc-text">1. hbase微博实战案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-需求分析"><span class="toc-text">1.1 需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-代码实现"><span class="toc-text">1.2 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-准备工作"><span class="toc-text">1.2.1 准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-代码设计总览："><span class="toc-text">1.2.2 代码设计总览：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-创建命名空间以及表名的定义"><span class="toc-text">1.2.3 创建命名空间以及表名的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-创建微博内容表"><span class="toc-text">1.2.4 创建微博内容表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-创建用户关系表"><span class="toc-text">1.2.5 创建用户关系表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-创建微博收件箱表"><span class="toc-text">1.2.6 创建微博收件箱表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-发布微博内容"><span class="toc-text">1.2.7 发布微博内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-8-添加关注用户"><span class="toc-text">1.2.8 添加关注用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-9-移除（取关）用户"><span class="toc-text">1.2.9 移除（取关）用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-10-获取关注的人的微博内容"><span class="toc-text">1.2.10 获取关注的人的微博内容</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 君子谦谦，温和有礼，有才而不骄，得志而不傲，居于谷而不卑。 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        大数据开发之HBase（四）微博案例
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-11-19 10:29:52</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#项目练习" title="项目练习">项目练习</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#hbase" title="hbase">hbase</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h1 id="1-hbase微博实战案例"><a href="#1-hbase微博实战案例" class="headerlink" title="1. hbase微博实战案例"></a>1. hbase微博实战案例</h1><h2 id="1-1-需求分析"><a href="#1-1-需求分析" class="headerlink" title="1.1 需求分析"></a>1.1 需求分析</h2><blockquote>
<ol>
<li><p>hbase属于OLAP数据库，表设计与OLTP数据库不同，支持百万列。列的动态变化。</p>
</li>
<li><p>设计规范</p>
<p>| <strong>项目</strong>     | <strong>说明</strong>                                                     | <strong>示例</strong>                                                     |<br>| ———— | ———————————————————— | ———————————————————— |<br>| <strong>命名空间</strong> | 采用英文单词、阿拉伯数字的组合形式，其中，单词必须大写，并且首字符必须为英文字符，不能是数字。不建议用连接符（下划线）拼接多个单词，简单语义的可采用单个单词，复杂语义的可采用多个单词的首字母拼接。长度尽量限制在4~8字符之间。命名空间一般可与项目名称、组织机构名称等保持一致。 | 根据项目名称构建命名空间：DLQX（电力气象首字母拼接形式），简短明了。不建议过长的命名空间名称，譬如不推荐采用以下形式：USER_INFO_MANAGE等。 |<br>| <strong>表名称</strong>   | 采用英文单词、阿拉伯数字、连接符（_）的组合形式，其中，单词必须大写，并且首字符必须为英文字符，不能是数字，可用连接符拼接多个单词。长度尽量限制在8~16字符之间。尽量采用具有明确意义的英文单词，而不建议采用汉字的拼音字母或者拼音首字母组合。 | 符合规范的表名称：USER_INFO_MANAGE、WEATHER_DATA、T_ELECTRIC_GATHER等。 |<br>| <strong>列族名称</strong> | 采用英文单词、阿拉伯数字的组合形式，其中，单词必须大写，并且首字符必须为英文字符，不能是数字。长度尽量限制在1~6字符之间，过长的列族名称将占用更多的存储空间。 | 符合规范的列族名称：D1、D2、DATA等。不推荐的列族名称：USER_INFO、D_1等。 |<br>| <strong>列名称</strong>   | 采用英文单词、阿拉伯数字、连接符（_）的组合形式，其中，单词必须大写，并且首字符必须为英文字符，不能是数字，可用连接符拼接多个单词。长度尽量限制在1~16字符之间。尽量采用具有明确意义的英文单词，而不建议采用汉字的拼音字母或者拼音首字母组合。 | 符合规范的列名称：USER_ID、DATA_1、REMARK等。不推荐的列名称：UserID、1_DA |</p>
</li>
</ol>
</blockquote>
<p>1) 微博内容的浏览，数据库表设计</p>
<ul>
<li>rowKey: uid + timestamp</li>
</ul>
<p><img src="assets/image-20191119172809987.png" alt="image-20191119172809987"></p>
<p>2) 用户社交体现：关注用户，取关用户</p>
<ul>
<li><p>rowKey： uid</p>
</li>
<li><p>ColumnFamily： 关注（attends）、粉丝（fans）两个列族</p>
</li>
<li><p>列族下列名称和cell值直接使用uid，当新增关注或者粉丝时直接动态增加列即可</p>
</li>
</ul>
<p><img src="assets/image-20191119172951520.png" alt="image-20191119172951520"></p>
<p>3) 拉取关注的人的微博内容</p>
<ul>
<li>发送微博直接推送给粉丝，需要表微博收件箱</li>
<li>rowKey 和列都用uid，动态增加列接收发送的微博</li>
<li>cell值使用微博id，设置微博版本ß</li>
</ul>
<p><img src="assets/image-20191119174811329.png" alt="image-20191119174811329"></p>
<h2 id="1-2-代码实现"><a href="#1-2-代码实现" class="headerlink" title="1.2 代码实现"></a>1.2 代码实现</h2><h3 id="1-2-1-准备工作"><a href="#1-2-1-准备工作" class="headerlink" title="1.2.1 准备工作"></a>1.2.1 准备工作</h3><ul>
<li><p>第一步：创建maven工程并导入jar包</p>
<p>直接使用在版本确界当中创建的工程以及导入的jar包即可</p>
</li>
<li><p>第二步：拷贝三个配置文件到maven工程的下</p>
<p>将node01服务器的三个配置文件，分别是</p>
<p>core-site.xml、hdfs-site.xml、hbase-site.xml三个配置文件，拷贝到maven工程的resources资源目录下</p>
</li>
</ul>
<h3 id="1-2-2-代码设计总览："><a href="#1-2-2-代码设计总览：" class="headerlink" title="1.2.2 代码设计总览："></a>1.2.2 代码设计总览：</h3><p>1) 创建命名空间以及表名的定义</p>
<p>2) 创建微博内容表</p>
<p>3) 创建用户关系表</p>
<p>4) 创建用户微博内容接收邮件表</p>
<p>5) 发布微博内容</p>
<p>6) 添加关注用户</p>
<p>7) 移除（取关）用户</p>
<p>8) 获取关注的人的微博内容</p>
<h3 id="1-2-3-创建命名空间以及表名的定义"><a href="#1-2-3-创建命名空间以及表名的定义" class="headerlink" title="1.2.3 创建命名空间以及表名的定义"></a>1.2.3 创建命名空间以及表名的定义</h3><p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//微博内容表的表名</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] TABLE_CONTENT = Bytes.toBytes(<span class="string">"weibo:content"</span>);</span><br><span class="line"><span class="comment">//用户关系表的表名</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] TABLE_RELATIONS = Bytes.toBytes(<span class="string">"weibo:relations"</span>);</span><br><span class="line"><span class="comment">//微博收件箱表的表名</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] TABLE_RECEIVE_CONTENT_EMAIL = Bytes.toBytes(<span class="string">"weibo:receive_content_email"</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化命名空间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initNameSpace</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    Admin admin = connection.getAdmin();</span><br><span class="line">    NamespaceDescriptor namespaceDescriptor = NamespaceDescriptor.create(<span class="string">"weibo2"</span>).addConfiguration(<span class="string">"creator"</span>,<span class="string">"jim"</span>).build();</span><br><span class="line">    admin.createNamespace(namespaceDescriptor);</span><br><span class="line">    admin.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Configuration configuration = HBaseConfiguration.create();</span><br><span class="line">    configuration.set(<span class="string">"hbase.zookeeper.quorum"</span>,<span class="string">"node01:2181,node02:2181,node03:2181"</span>);</span><br><span class="line">    Connection connection = ConnectionFactory.createConnection();</span><br><span class="line">    <span class="keyword">return</span> connection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-4-创建微博内容表"><a href="#1-2-4-创建微博内容表" class="headerlink" title="1.2.4 创建微博内容表"></a>1.2.4 创建微博内容表</h3><p><strong>表结构：</strong></p>
<table>
<thead>
<tr>
<th><strong>方法名</strong></th>
<th>creatTableeContent</th>
</tr>
</thead>
<tbody>
<tr>
<td>Table Name</td>
<td>weibo:content</td>
</tr>
<tr>
<td>RowKey</td>
<td>用户ID_时间戳</td>
</tr>
<tr>
<td>ColumnFamily</td>
<td>info</td>
</tr>
<tr>
<td>ColumnLabel</td>
<td>标题,内容,图片</td>
</tr>
<tr>
<td>Version</td>
<td>1个版本</td>
</tr>
</tbody>
</table>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建微博内容存储表</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 方法名 creatTableeContent</span></span><br><span class="line"><span class="comment"> Table Name    weibo:content</span></span><br><span class="line"><span class="comment"> RowKey    用户ID_时间戳</span></span><br><span class="line"><span class="comment"> ColumnFamily  info</span></span><br><span class="line"><span class="comment"> ColumnLabel   标题,内容,图片</span></span><br><span class="line"><span class="comment"> Version   1个版本</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">creatTableeContent</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//获取连接</span></span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    <span class="comment">//获取管理员对象</span></span><br><span class="line">    Admin admin = connection.getAdmin();</span><br><span class="line">    <span class="comment">//得到HTableDescriptor对象</span></span><br><span class="line">    HTableDescriptor hTableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(<span class="string">"weibo:content"</span>));</span><br><span class="line">    <span class="comment">//添加列族info</span></span><br><span class="line">    HColumnDescriptor info = <span class="keyword">new</span> HColumnDescriptor(<span class="string">"info"</span>);</span><br><span class="line">    <span class="comment">//设置版本确界</span></span><br><span class="line">    info.setMaxVersions(<span class="number">1</span>);</span><br><span class="line">    info.setMinVersions(<span class="number">1</span>);</span><br><span class="line">    info.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//设置数据压缩</span></span><br><span class="line">    <span class="comment">//   info.setCompressionType(Compression.Algorithm.SNAPPY);</span></span><br><span class="line">    info.setBlocksize(<span class="number">2048</span>*<span class="number">1024</span>);</span><br><span class="line">    hTableDescriptor.addFamily(info);</span><br><span class="line">    <span class="comment">//创建表</span></span><br><span class="line">    admin.createTable(hTableDescriptor);</span><br><span class="line">    admin.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-5-创建用户关系表"><a href="#1-2-5-创建用户关系表" class="headerlink" title="1.2.5 创建用户关系表"></a>1.2.5 创建用户关系表</h3><p><strong>表结构：</strong></p>
<table>
<thead>
<tr>
<th><strong>方法名</strong></th>
<th>createTableRelations</th>
</tr>
</thead>
<tbody>
<tr>
<td>Table Name</td>
<td>weibo:relations</td>
</tr>
<tr>
<td>RowKey</td>
<td>用户ID</td>
</tr>
<tr>
<td>ColumnFamily</td>
<td>attends、fans</td>
</tr>
<tr>
<td>ColumnLabel</td>
<td>关注用户ID，粉丝用户ID</td>
</tr>
<tr>
<td>ColumnValue</td>
<td>用户ID</td>
</tr>
<tr>
<td>Version</td>
<td>1个版本</td>
</tr>
</tbody>
</table>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建用户关系表</span></span><br><span class="line"><span class="comment"> * 方法名 createTableRelations</span></span><br><span class="line"><span class="comment"> Table Name    weibo:relations</span></span><br><span class="line"><span class="comment"> RowKey    用户ID</span></span><br><span class="line"><span class="comment"> ColumnFamily  attends、fans</span></span><br><span class="line"><span class="comment"> ColumnLabel   关注用户ID，粉丝用户ID</span></span><br><span class="line"><span class="comment"> ColumnValue   用户ID</span></span><br><span class="line"><span class="comment"> Version   1个版本</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTableRelations</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//获取连接</span></span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    <span class="comment">//获取管理员对象</span></span><br><span class="line">    Admin admin = connection.getAdmin();</span><br><span class="line">    <span class="comment">//得到表定义</span></span><br><span class="line">    HTableDescriptor hTableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line">    HColumnDescriptor attends = <span class="keyword">new</span> HColumnDescriptor(<span class="string">"attends"</span>);</span><br><span class="line">    HColumnDescriptor fans = <span class="keyword">new</span> HColumnDescriptor(<span class="string">"fans"</span>);</span><br><span class="line"></span><br><span class="line">    attends.setBlocksize(<span class="number">2048</span>*<span class="number">1024</span>);</span><br><span class="line">    attends.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">    attends.setMinVersions(<span class="number">1</span>);</span><br><span class="line">    attends.setMaxVersions(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    fans.setBlocksize(<span class="number">2048</span>*<span class="number">1024</span>);</span><br><span class="line">    fans.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">    fans.setMinVersions(<span class="number">1</span>);</span><br><span class="line">    fans.setMaxVersions(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    hTableDescriptor.addFamily(attends);</span><br><span class="line">    hTableDescriptor.addFamily(fans);</span><br><span class="line">    admin.createTable(hTableDescriptor);</span><br><span class="line">    admin.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-6-创建微博收件箱表"><a href="#1-2-6-创建微博收件箱表" class="headerlink" title="1.2.6 创建微博收件箱表"></a>1.2.6 创建微博收件箱表</h3><p><strong>表结构：</strong></p>
<table>
<thead>
<tr>
<th><strong>方法名</strong></th>
<th>createTableReceiveContentEmails</th>
</tr>
</thead>
<tbody>
<tr>
<td>Table Name</td>
<td>weibo:receive_content_email</td>
</tr>
<tr>
<td>RowKey</td>
<td>用户ID</td>
</tr>
<tr>
<td>ColumnFamily</td>
<td>info</td>
</tr>
<tr>
<td>ColumnLabel</td>
<td>用户ID</td>
</tr>
<tr>
<td>ColumnValue</td>
<td>取微博内容的RowKey</td>
</tr>
<tr>
<td>Version</td>
<td>1000</td>
</tr>
</tbody>
</table>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 表结构：</span></span><br><span class="line"><span class="comment"> 方法名   createTableReceiveContentEmails</span></span><br><span class="line"><span class="comment"> Table Name    weibo:receive_content_email</span></span><br><span class="line"><span class="comment"> RowKey    用户ID</span></span><br><span class="line"><span class="comment"> ColumnFamily  info</span></span><br><span class="line"><span class="comment"> ColumnLabel   用户ID</span></span><br><span class="line"><span class="comment"> ColumnValue   取微博内容的RowKey</span></span><br><span class="line"><span class="comment"> Version   1000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTableReceiveContentEmails</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//获取连接</span></span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    <span class="comment">//得到管理员对象</span></span><br><span class="line">    Admin admin = connection.getAdmin();</span><br><span class="line">    <span class="comment">//获取HTableDescriptor</span></span><br><span class="line">    HTableDescriptor hTableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">    <span class="comment">//定义列族名称</span></span><br><span class="line">    HColumnDescriptor info = <span class="keyword">new</span> HColumnDescriptor(<span class="string">"info"</span>);</span><br><span class="line">    info.setMaxVersions(<span class="number">1000</span>);</span><br><span class="line">    info.setMinVersions(<span class="number">1000</span>);</span><br><span class="line">    info.setBlockCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line">    info.setBlocksize(<span class="number">2048</span>*<span class="number">1024</span>);</span><br><span class="line">    hTableDescriptor.addFamily(info);</span><br><span class="line">    <span class="comment">//创建表</span></span><br><span class="line">    admin.createTable(hTableDescriptor);</span><br><span class="line">    admin.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-7-发布微博内容"><a href="#1-2-7-发布微博内容" class="headerlink" title="1.2.7 发布微博内容"></a>1.2.7 发布微博内容</h3><p>a、微博内容表中添加1条数据</p>
<p>b、微博收件箱表对所有粉丝用户添加数据</p>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发布微博内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> content</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishWeiBo</span><span class="params">(String uid ,String content)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    Table table = connection.getTable(TableName.valueOf(TABLE_CONTENT));</span><br><span class="line">    String rowkey = uid + <span class="string">"_"</span>+ System.currentTimeMillis();</span><br><span class="line">    Put put = <span class="keyword">new</span> Put(rowkey.getBytes());</span><br><span class="line">    put.addColumn(<span class="string">"info"</span>.getBytes(),<span class="string">"content"</span>.getBytes(),System.currentTimeMillis(),content.getBytes());</span><br><span class="line">    table.put(put);</span><br><span class="line">    <span class="comment">//微博用户关系表</span></span><br><span class="line">    Table table_relations = connection.getTable(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line">    Get get = <span class="keyword">new</span> Get(uid.getBytes());</span><br><span class="line">    get.addFamily(<span class="string">"fans"</span>.getBytes());</span><br><span class="line">    Result result = table_relations.get(get);</span><br><span class="line">    Cell[] cells = result.rawCells();</span><br><span class="line">    <span class="keyword">if</span>(cells.length &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;<span class="keyword">byte</span>[]&gt;  allFans = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">byte</span>[]&gt;();</span><br><span class="line">    <span class="comment">//将所有的粉丝都获取到，然后将数据保存到粉丝表当中去</span></span><br><span class="line">    <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = CellUtil.cloneQualifier(cell);</span><br><span class="line">        allFans.add(bytes);</span><br><span class="line">    &#125;</span><br><span class="line">    Table table_receive_content_email = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">    List&lt;Put&gt; putFansList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">byte</span>[] allFan : allFans) &#123;</span><br><span class="line">        Put put1 = <span class="keyword">new</span> Put(allFan);</span><br><span class="line">        put1.addColumn(<span class="string">"info"</span>.getBytes(),Bytes.toBytes(uid),System.currentTimeMillis(),rowkey.getBytes());</span><br><span class="line">        putFansList.add(put1);</span><br><span class="line">    &#125;</span><br><span class="line">    table_receive_content_email.put(putFansList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-8-添加关注用户"><a href="#1-2-8-添加关注用户" class="headerlink" title="1.2.8 添加关注用户"></a>1.2.8 添加关注用户</h3><p>a、在微博用户关系表中，对当前主动操作的用户添加新关注的好友</p>
<p>b、在微博用户关系表中，对被关注的用户添加新的粉丝</p>
<p>c、微博收件箱表中添加所关注的用户发布的微博</p>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加关注用户，一次可能添加多个关注用户</span></span><br><span class="line"><span class="comment"> * A 关注一批用户 B,C ,D</span></span><br><span class="line"><span class="comment"> * 第一步：A是B,C,D的关注者   在weibo:relations 当中attend列族当中以A作为rowkey，B,C,D作为列名，B,C,D作为列值，保存起来</span></span><br><span class="line"><span class="comment"> * 第二步：B,C,D都会多一个粉丝A  在weibo:relations 当中fans列族当中分别以B,C,D作为rowkey，A作为列名，A作为列值，保存起来</span></span><br><span class="line"><span class="comment"> * 第三步：A需要获取B,C,D 的微博内容存放到 receive_content_email 表当中去，以A作为rowkey，B,C,D作为列名，获取B,C,D发布的微博rowkey，放到对应的列值里面去</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attends</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAttends</span><span class="params">(String uid ,String ...attends)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    Table relation_table = connection.getTable(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line">    <span class="comment">//用户关注人,attend列族当中添加数据</span></span><br><span class="line">    Put put = <span class="keyword">new</span> Put(uid.getBytes());</span><br><span class="line">    <span class="keyword">for</span> (String attend : attends) &#123;</span><br><span class="line">        put.addColumn(<span class="string">"attends"</span>.getBytes(),attend.getBytes(),attend.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">    relation_table.put(put);</span><br><span class="line">    <span class="comment">//粉丝fans添加粉丝，A 关注B，那么自然B就需要添加一个粉丝A</span></span><br><span class="line">    <span class="keyword">for</span> (String attend : attends) &#123;</span><br><span class="line">        Put put1 = <span class="keyword">new</span> Put(attend.getBytes());</span><br><span class="line">        put1.addColumn(<span class="string">"fans"</span>.getBytes(),uid.getBytes(),uid.getBytes());</span><br><span class="line">        relation_table.put(put1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取uid的所有关注人的收件箱，放到收件箱列表weibo:receive_content_email里面去</span></span><br><span class="line">    <span class="comment">//A 关注B，那么A需要获取B所有的微博内容</span></span><br><span class="line">    Table table_content = connection.getTable(TableName.valueOf(TABLE_CONTENT));</span><br><span class="line">    Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">    List&lt;<span class="keyword">byte</span>[]&gt; rowkeyBytes = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String attend : attends) &#123;</span><br><span class="line">        RowFilter rowFilter = <span class="keyword">new</span> RowFilter(CompareFilter.CompareOp.EQUAL</span><br><span class="line">,<span class="keyword">new</span> SubstringComparator(attend+<span class="string">"_"</span>));</span><br><span class="line">        scan.setFilter(rowFilter);</span><br><span class="line">        ResultScanner scanner = table_content.getScanner(scan);</span><br><span class="line">        <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">            <span class="comment">//获取到数据的rowkey</span></span><br><span class="line">            <span class="keyword">byte</span>[] rowkey = result.getRow();</span><br><span class="line">            rowkeyBytes.add(rowkey);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(rowkeyBytes.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        Table table_receive_content = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">        List&lt;Put&gt; recPuts = <span class="keyword">new</span> ArrayList&lt;Put&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span>[] rowkeyByte : rowkeyBytes) &#123;</span><br><span class="line">            Put put1 = <span class="keyword">new</span> Put(uid.getBytes());</span><br><span class="line">            String rowKeyStr = Bytes.toString(rowkeyByte);</span><br><span class="line">            String attendUid = rowKeyStr.substring(<span class="number">0</span>, rowKeyStr.indexOf(<span class="string">"_"</span>));</span><br><span class="line">            <span class="keyword">long</span> timestamp = Long.parseLong(rowKeyStr.substring(rowKeyStr.indexOf(<span class="string">"_"</span>) + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">            put1.addColumn(<span class="string">"info"</span>.getBytes(),attendUid.getBytes(), timestamp,rowkeyByte);</span><br><span class="line">            recPuts.add(put1);</span><br><span class="line">        &#125;</span><br><span class="line">        table_receive_content.put(recPuts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-9-移除（取关）用户"><a href="#1-2-9-移除（取关）用户" class="headerlink" title="1.2.9 移除（取关）用户"></a>1.2.9 移除（取关）用户</h3><p>a、在微博用户关系表中，对当前主动操作的用户移除取关的好友(attends)</p>
<p>b、在微博用户关系表中，对被取关的用户移除粉丝</p>
<p>c、微博收件箱中删除取关的用户发布的微博</p>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取消关注 A取消关注 B,C,D这三个用户</span></span><br><span class="line"><span class="comment"> * 其实逻辑与关注B,C,D相反即可</span></span><br><span class="line"><span class="comment"> * 第一步：在weibo:relation关系表当中，在attends列族当中删除B,C,D这三个列</span></span><br><span class="line"><span class="comment"> * 第二步：在weibo:relation关系表当中，在fans列族当中，以B,C,D为rowkey，查找fans列族当中A这个粉丝，给删除掉</span></span><br><span class="line"><span class="comment"> * 第三步：A取消关注B,C,D,在收件箱中，删除取关的人的微博的rowkey</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attendCancel</span><span class="params">(String uid,String ...cancelAttends)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    Table table_relations = connection.getTable(TableName.valueOf(TABLE_RELATIONS));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//移除A关注的B,C,D这三个用户</span></span><br><span class="line">    <span class="keyword">for</span> (String cancelAttend : cancelAttends) &#123;</span><br><span class="line">        Delete delete = <span class="keyword">new</span> Delete(uid.getBytes());</span><br><span class="line">        delete.addColumn(<span class="string">"attends"</span>.getBytes(),cancelAttend.getBytes());</span><br><span class="line">        table_relations.delete(delete);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//B,C,D这三个用户移除粉丝A</span></span><br><span class="line">    <span class="keyword">for</span> (String cancelAttend : cancelAttends) &#123;</span><br><span class="line">        Delete delete = <span class="keyword">new</span> Delete(cancelAttend.getBytes());</span><br><span class="line">        delete.addColumn(<span class="string">"fans"</span>.getBytes(),uid.getBytes());</span><br><span class="line">        table_relations.delete(delete);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//收件箱表当中  A移除掉B,C,D的信息</span></span><br><span class="line">    Table table_receive_connection = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String cancelAttend : cancelAttends) &#123;</span><br><span class="line">        Delete delete = <span class="keyword">new</span> Delete(uid.getBytes());</span><br><span class="line">        delete.addColumn(<span class="string">"info"</span>.getBytes(),cancelAttend.getBytes());</span><br><span class="line">        table_receive_connection.delete(delete);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    table_receive_connection.close();</span><br><span class="line">    table_relations.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-10-获取关注的人的微博内容"><a href="#1-2-10-获取关注的人的微博内容" class="headerlink" title="1.2.10 获取关注的人的微博内容"></a>1.2.10 获取关注的人的微博内容</h3><p>a、从微博收件箱中获取所关注的用户的微博RowKey </p>
<p>b、根据获取的RowKey，得到微博内容</p>
<p><strong>代码实现：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 某个用户获取收件箱表内容</span></span><br><span class="line"><span class="comment"> * 例如A用户刷新微博，拉取他所有关注人的微博内容</span></span><br><span class="line"><span class="comment"> * A 从 weibo:receive_content_email  表当中获取所有关注人的rowkey</span></span><br><span class="line"><span class="comment"> * 通过rowkey从weibo:content表当中获取微博内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getContent</span><span class="params">(String uid)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//从weibo:receive_content_email 表当中获取用户id为uid的人的所有的微博列表</span></span><br><span class="line">    Connection connection = getConnection();</span><br><span class="line">    <span class="comment">//从 weibo:receive_content_email</span></span><br><span class="line">    Table table_receive_content_email = connection.getTable(TableName.valueOf(TABLE_RECEIVE_CONTENT_EMAIL));</span><br><span class="line">    <span class="comment">//定义list集合里面存储我们的所有的Get对象，用于下一步的查询</span></span><br><span class="line">    List&lt;Get&gt;  rowkeysList = <span class="keyword">new</span> ArrayList&lt;Get&gt;();</span><br><span class="line">    Get get = <span class="keyword">new</span> Get(uid.getBytes());</span><br><span class="line">    <span class="comment">//设置最大版本为5个</span></span><br><span class="line">    get.setMaxVersions(<span class="number">5</span>);</span><br><span class="line">    Result result = table_receive_content_email.get(get);</span><br><span class="line">    Cell[] cells = result.rawCells();</span><br><span class="line">    <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] rowkeys = CellUtil.cloneValue(cell);</span><br><span class="line">        Get get1 = <span class="keyword">new</span> Get(rowkeys);</span><br><span class="line">        rowkeysList.add(get1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从weibo:content表当中通过用户id进行查询微博内容</span></span><br><span class="line">    <span class="comment">//table_content内容表</span></span><br><span class="line">    Table table_content = connection.getTable(TableName.valueOf(TABLE_CONTENT));</span><br><span class="line">    <span class="comment">//所有查询出来的内容进行打印出来</span></span><br><span class="line">    Result[] results = table_content.get(rowkeysList);</span><br><span class="line">    <span class="keyword">for</span> (Result result1 : results) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] value = result1.getValue(<span class="string">"info"</span>.getBytes(), <span class="string">"content"</span>.getBytes());</span><br><span class="line">        <span class="keyword">byte</span>[] row = result1.getRow();</span><br><span class="line">        String rowkey = Bytes.toString(row);</span><br><span class="line">        String[] split = rowkey.split(<span class="string">"_"</span>);</span><br><span class="line">        Content content = <span class="keyword">new</span> Content();</span><br><span class="line">        content.setUid(split[<span class="number">0</span>]);</span><br><span class="line">        content.setTimeStamp(Long.parseLong(split[<span class="number">1</span>]));</span><br><span class="line">        content.setContent(Bytes.toString(value));</span><br><span class="line">        System.out.println(content.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/orchid-ding/hadoop-example/tree/master/src/main/java/hbase/weibo" target="_blank" rel="noopener">点击获取代码示例</a></p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
