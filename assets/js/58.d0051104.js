(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{543:function(s,a,n){"use strict";n.r(a);var e=n(19),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"_1、es的核心概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、es的核心概念"}},[s._v("#")]),s._v(" 1、ES的核心概念")]),s._v(" "),n("h3",{attrs:{id:"_1-1-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-概述"}},[s._v("#")]),s._v(" 1.1. 概述")]),s._v(" "),n("blockquote",[n("p",[s._v("Elasticsearch是面向文档(document orriented)的，这意味着它可以存储整个对象或文档(document)。然而它不仅仅是存储，还会索引(index)每个文档的内容使之可以被搜索。在Elasticsearch中，你可以对文档（而非成行成列的数据）进行索引、搜索、排序、过滤。")])]),s._v(" "),n("p",[s._v("Elasticsearch比传统关系型数据库如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Relational DB -> Databases -> Tables -> Rows -> Columns\nElasticsearch -> Indices  -> Types  -> Documents -> Fields\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"_1-2-elasticsearch核心概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-elasticsearch核心概念"}},[s._v("#")]),s._v(" 1.2. Elasticsearch核心概念")]),s._v(" "),n("h4",{attrs:{id:"_1-2-1-索引-index"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-索引-index"}},[s._v("#")]),s._v(" 1.2.1. 索引 index")]),s._v(" "),n("p",[s._v("一个索引就是一个拥有几分相似特征的文档的集合。比如说，你可以有一个客户数据的索引，另一个产品目录的索引，还有一个订单数据的索引。一个索引由一个名字来标识（必须全部是小写字母的），并且当我们要对对应于这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。在一个集群中，可以定义任意多的索引。")]),s._v(" "),n("h4",{attrs:{id:"_1-2-2-类型-type"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-类型-type"}},[s._v("#")]),s._v(" 1.2.2. 类型 type")]),s._v(" "),n("p",[s._v("在一个索引中，你可以定义一种或多种类型。一个类型是你的索引的一个逻辑上的分类/分区，其语义完全由你来定。通常，会为具有一组共同字段的文档定义一个类型。比如说，我们假设你运营一个博客平台并且将你所有的数据存储到一个索引中。在这个索引中，你可以为用户数据定义一个类型，为博客数据定义另一个类型，当然，也可以为评论数据定义另一个类型。")]),s._v(" "),n("h4",{attrs:{id:"_1-2-3-字段field"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-字段field"}},[s._v("#")]),s._v(" 1.2.3. 字段Field")]),s._v(" "),n("p",[s._v("相当于是数据表的字段，对文档数据根据不同属性进行的分类标识")]),s._v(" "),n("h4",{attrs:{id:"_1-2-4-映射-mapping"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-映射-mapping"}},[s._v("#")]),s._v(" 1.2.4. 映射 mapping")]),s._v(" "),n("p",[s._v("mapping是处理数据的方式和规则方面做一些限制，如某个字段的数据类型、默认值、分析器、是否被索引等等，这些都是映射里面可以设置的，其它就是处理es里面数据的一些使用规则设置也叫做映射，按着最优规则处理数据对性能提高很大，因此才需要建立映射，并且需要思考如何建立映射才能对性能更好。")]),s._v(" "),n("h4",{attrs:{id:"_1-2-5-文档-document"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-文档-document"}},[s._v("#")]),s._v(" 1.2.5. 文档 document")]),s._v(" "),n("p",[s._v("一个文档是一个可被索引的基础信息单元。比如，你可以拥有某一个客户的文档，某一个产品的一个文档，当然，也可以拥有某个订单的一个文档。文档以JSON（Javascript Object Notation）格式来表示，而JSON是一个到处存在的互联网数据交互格式。")]),s._v(" "),n("p",[s._v("在一个index/type里面，你可以存储任意多的文档。注意，尽管一个文档，物理上存在于一个索引之中，文档必须被索引/赋予一个索引的type。")]),s._v(" "),n("h4",{attrs:{id:"_1-2-6-接近实时-nrt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-6-接近实时-nrt"}},[s._v("#")]),s._v(" 1.2.6. 接近实时 NRT")]),s._v(" "),n("p",[s._v("Elasticsearch是一个接近实时的搜索平台。这意味着，从索引一个文档直到这个文档能够被搜索到有一个轻微的延迟（通常是1秒以内）")]),s._v(" "),n("h4",{attrs:{id:"_1-2-7-集群-cluster"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-7-集群-cluster"}},[s._v("#")]),s._v(" 1.2.7. 集群 cluster")]),s._v(" "),n("p",[s._v("一个集群就是由一个或多个节点组织在一起，它们共同持有整个的数据，并一起提供索引和搜索功能。一个集群由一个唯一的名字标识，这个名字默认就是“elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群")]),s._v(" "),n("h4",{attrs:{id:"_1-2-8-节点-node"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-8-节点-node"}},[s._v("#")]),s._v(" 1.2.8. 节点 node")]),s._v(" "),n("p",[s._v("一个节点是集群中的一个服务器，作为集群的一部分，它存储数据，参与集群的索引和搜索功能。和集群类似，一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点。这个名字对于管理工作来说挺重要的，因为在这个管理过程中，你会去确定网络中的哪些服务器对应于Elasticsearch集群中的哪些节点。")]),s._v(" "),n("p",[s._v("一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每个节点都会被安排加入到一个叫做“elasticsearch”的集群中，这意味着，如果你在你的网络中启动了若干个节点，并假定它们能够相互发现彼此，它们将会自动地形成并加入到一个叫做“elasticsearch”的集群中。")]),s._v(" "),n("p",[s._v("在一个集群里，只要你想，可以拥有任意多个节点。而且，如果当前你的网络中没有运行任何Elasticsearch节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的集群。")]),s._v(" "),n("h4",{attrs:{id:"_1-2-9-分片和复制-shards-replicas"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-9-分片和复制-shards-replicas"}},[s._v("#")]),s._v(" 1.2.9. 分片和复制 shards&replicas")]),s._v(" "),n("p",[s._v("一个索引可以存储超出单个结点硬件限制的大量数据。比如，一个具有10亿文档的索引占据1TB的磁盘空间，而任一节点都没有这样大的磁盘空间；或者单个节点处理搜索请求，响应太慢。为了解决这个问题，Elasticsearch提供了将索引划分成多份的能力，这些份就叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置到集群中的任何节点上。分片很重要，主要有两方面的原因：  1）允许你水平分割/扩展你的内容容量。  2）允许你在分片（潜在地，位于多个节点上）之上进行分布式的、并行的操作，进而提高性能/吞吐量。")]),s._v(" "),n("p",[s._v("至于一个分片怎样分布，它的文档怎样聚合回搜索请求，是完全由Elasticsearch管理的，对于作为用户的你来说，这些都是透明的。")]),s._v(" "),n("p",[s._v("在一个网络/云的环境里，失败随时都可能发生，在某个分片/节点不知怎么的就处于离线状态，或者由于任何原因消失了，这种情况下，有一个故障转移机制是非常有用并且是强烈推荐的。为此目的，Elasticsearch允许你创建分片的一份或多份拷贝，这些拷贝叫做复制分片，或者直接叫复制。")]),s._v(" "),n("p",[s._v("复制之所以重要，有两个主要原因： 在分片/节点失败的情况下，提供了高可用性。因为这个原因，注意到复制分片从不与原/主要（original/primary）分片置于同一节点上是非常重要的。扩展你的搜索量/吞吐量，因为搜索可以在所有的复制上并行运行。总之，每个索引可以被分成多个分片。一个索引也可以被复制0次（意思是没有复制）或多次。一旦复制了，每个索引就有了主分片（作为复制源的原来的分片）和复制分片（主分片的拷贝）之别。分片和复制的数量可以在索引创建的时候指定。在索引创建之后，你可以在任何时候动态地改变复制的数量，但是你事后不能改变分片的数量。")]),s._v(" "),n("p",[s._v("默认情况下，Elasticsearch中的每个索引被分片5个主分片和1个复制，这意味着，如果你的集群中至少有两个节点，你的索引将会有5个主分片和另外5个复制分片（1个完全拷贝），这样的话每个索引总共就有10个分片。")]),s._v(" "),n("h2",{attrs:{id:"_2-管理索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-管理索引"}},[s._v("#")]),s._v(" 2. 管理索引")]),s._v(" "),n("p",[s._v("curl是利用URL语法在命令行方式下工作的开源文件传输工具，使用curl可以简单实现常见的get/post请求。简单的认为是可以在命令行下面访问url的一个工具。在centos的默认库里面是有curl工具的，如果没有请yum安装即可。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl\n\n-X 指定http的请求方法 有HEAD GET POST PUT DELETE*\n*-d 指定要传输的数据*\n*-H 指定http请求头信息\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_2-1-使用-xput创建索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-使用-xput创建索引"}},[s._v("#")]),s._v(" 2.1. 使用 Xput创建索引")]),s._v(" "),n("h4",{attrs:{id:"_2-1-1-创建索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-创建索引"}},[s._v("#")]),s._v(" 2.1.1. 创建索引")]),s._v(" "),n("p",[s._v("在我们的kibana的dev tools当中执行以下语句")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -XPUT http://node01:9200/blog01/?pretty\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111241540595.jpg",alt:"img"}})]),s._v(" "),n("h4",{attrs:{id:"_2-1-2-插入文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-插入文档"}},[s._v("#")]),s._v(" 2.1.2. 插入文档")]),s._v(" "),n("p",[s._v("前面的命令使用 PUT 动词将一个文档添加到 /article(文档类型)，并为该文档分配 ID 为1。URL 路径显示为index/doctype/ID（索引/文档类型/ID）。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('curl -XPUT http://node01:9200/blog01/article/1?pretty -d  \'{"id": "1", "title": "What is lucene"}\'\n\n问题：Content-Type header [application/x-www-form-urlencoded] is not supported\n\n解决：\n\ncurl -XPUT http://node01:9200/blog01/article/1?pretty -d  \'{"id": "1", "title": "What is lucene"}\' -H "Content-Type: application/json"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("原因：")]),s._v(" "),n("p",[s._v("此原因时由于ES增加了安全机制， 进行严格的内容类型检查，严格检查内容类型也可以作为防止跨站点请求伪造攻击的一层保护。 "),n("a",{attrs:{href:"https://www.elastic.co/blog/strict-content-type-checking-for-elasticsearch-rest-requests",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网解释"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("http.content_type.required")]),s._v(" "),n("h4",{attrs:{id:"_2-1-3-查询文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-查询文档"}},[s._v("#")]),s._v(" 2.1.3. 查询文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('curl -XGET http://node01:9200/blog01/article/1?pretty\n\n问题：Content-Type header [application/x-www-form-urlencoded] is not supported\n\n解决：\n\ncurl -XPUT http://node01:9200/blog01/article/1?pretty -d  \'{"id": "1", "title": "What is lucene"}\' -H "Content-Type: application/json"\n\ncurl -XGET http://node01:9200/blog01/article/1?pretty -H "Content-Type: application/json"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"_2-1-4-更新文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-更新文档"}},[s._v("#")]),s._v(" 2.1.4. 更新文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('curl -XPUT *http://node01:9200/blog01/article/1?pretty -d  \'{"id": "1", "title": " What is elasticsearch"}\'*\n\n问题：Content-Type header [application/x-www-form-urlencoded] is not supported\n\n解决：\n\ncurl -XPUT http://node01:9200/blog01/article/1?pretty -d  \'{"id": "1", "title": " What is elasticsearch"}\' -H "Content-Type: application/json"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"_2-1-5-搜索文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-搜索文档"}},[s._v("#")]),s._v(" 2.1.5. 搜索文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('curl -XGET "http://node01:9200/blog01/article/_search?q=title:elasticsearch" \n\n \n\n问题：Content-Type header [application/x-www-form-urlencoded] is not supported\n\n解决：\n\ncurl -XGET "http://node01:9200/blog01/article/_search?q=title:\'elasticsearch\'&pretty" -H "Content-Type: application/json"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"_2-1-6-删除文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-6-删除文档"}},[s._v("#")]),s._v(" 2.1.6. 删除文档")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('curl -XDELETE "http://node01:9200/blog01/article/1?pretty"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"_2-1-7-删除索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-7-删除索引"}},[s._v("#")]),s._v(" 2.1.7. 删除索引")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -XDELETE http://node01:9200/blog01?pretty\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_2-2-、查询条件-查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-、查询条件-查询"}},[s._v("#")]),s._v(" 2.2 、查询条件 查询")]),s._v(" "),n("p",[s._v("在kibana提供的界面上进行操作。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /school/student/_bulk\n{ "index": { "_id": 1 }}\n{ "name" : "liubei", "age" : 20 , "sex": "boy", "birth": "1996-01-02" , "about": "i like diaocan he girl" }\n{ "index": { "_id": 2 }}\n{ "name" : "guanyu", "age" : 21 , "sex": "boy", "birth": "1995-01-02" , "about": "i like diaocan" }\n{ "index": { "_id": 3 }}\n{ "name" : "zhangfei", "age" : 18 , "sex": "boy", "birth": "1998-01-02" , "about": "i like travel" }\n{ "index": { "_id": 4 }}\n{ "name" : "diaocan", "age" : 20 , "sex": "girl", "birth": "1996-01-02" , "about": "i like travel and sport" }\n{ "index": { "_id": 5 }}\n{ "name" : "panjinlian", "age" : 25 , "sex": "girl", "birth": "1991-01-02" , "about": "i like travel and wusong" }\n{ "index": { "_id": 6 }}\n{ "name" : "caocao", "age" : 30 , "sex": "boy", "birth": "1988-01-02" , "about": "i like xiaoqiao" }\n{ "index": { "_id": 7 }}\n{ "name" : "zhaoyun", "age" : 31 , "sex": "boy", "birth": "1997-01-02" , "about": "i like travel and music" }\n{ "index": { "_id": 8 }}\n{ "name" : "xiaoqiao", "age" : 18 , "sex": "girl", "birth": "1998-01-02" , "about": "i like caocao" }\n{ "index": { "_id": 9 }}\n{ "name" : "daqiao", "age" : 20 , "sex": "girl", "birth": "1996-01-02" , "about": "i like travel and history" }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h4",{attrs:{id:"_2-2-1、使用match-all做查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1、使用match-all做查询"}},[s._v("#")]),s._v(" 2.2.1、使用match_all做查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /school/student/_search?pretty\n{\n    "query": {\n        "match_all": {}\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("问题：通过match_all匹配后，会把所有的数据检索出来，但是往往真正的业务需求并非要找全部的数据，而是检索出自己想要的；并且对于es集群来说，直接检索全部的数据，很容易造成GC现象。所以，我们要学会如何进行高效的检索数据")]),s._v(" "),n("h4",{attrs:{id:"_2-2-2、通过关键字段进行查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2、通过关键字段进行查询"}},[s._v("#")]),s._v(" 2.2.2、通过关键字段进行查询")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /school/student/_search?pretty\n{\n    "query": {\n         "match": {"about": "travel"}\n     }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("如果此时想查询"),n("strong",[s._v("喜欢旅游的，并且不能是男孩的")]),s._v("，怎么办？")]),s._v(" "),n("p",[s._v("【这种方式是错误的，因为一个match下，不能出现多个字段值[match] query doesn't support multiple fields】，需要使用复合查询")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111241613971.jpg",alt:"img"}})]),s._v(" "),n("h4",{attrs:{id:"_2-2-3、bool的复合查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3、bool的复合查询"}},[s._v("#")]),s._v(" 2.2.3、bool的复合查询")]),s._v(" "),n("p",[s._v("当出现多个查询语句组合的时候，可以用bool来包含。bool合并聚包含：must，must_not或者should， should表示or的意思")]),s._v(" "),n("p",[s._v("例子：查询非男性中喜欢旅行的人")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /school/student/_search?pretty\n{\n"query": {\n   "bool": {\n      "must": { "match": {"about": "travel"}},\n      "must_not": {"match": {"sex": "boy"}}\n     }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"_2-2-4、bool的复合查询中的should"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4、bool的复合查询中的should"}},[s._v("#")]),s._v(" 2.2.4、bool的复合查询中的should")]),s._v(" "),n("p",[s._v("should表示可有可无的（如果should匹配到了就展示，否则就不展示）")]),s._v(" "),n("p",[s._v("例子：")]),s._v(" "),n("p",[s._v("查询喜欢旅行的，如果有男性的则显示，否则不显示")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /school/student/_search?pretty\n{\n"query": {\n   "bool": {\n      "must": { "match": {"about": "travel"}},\n      "should": {"match": {"sex": "boy"}}         \n     }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h4",{attrs:{id:"_2-2-5、term匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5、term匹配"}},[s._v("#")]),s._v(" 2.2.5、term匹配")]),s._v(" "),n("p",[s._v("使用term进行精确匹配（比如数字，日期，布尔值或 not_analyzed的字符串(未经分析的文本数据类型)）")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('语法\n\n{ "term": { "age": 20 }}\n{ "term": { "date": "2018-04-01" }}\n{ "term": { "sex": “boy” }}\n{ "term": { "about": "trivel" }}\n\n例子：\n\n查询喜欢旅行的\n\nGET /school/student/_search?pretty\n{\n"query": {\n   "bool": {\n      "must": { "term": {"about": "travel"}},\n      "should": {"term": {"sex": "boy"}}         \n     }}\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h4",{attrs:{id:"_2-2-6、使用terms匹配多个值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-6、使用terms匹配多个值"}},[s._v("#")]),s._v(" 2.2.6、使用terms匹配多个值")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /school/student/_search?pretty\n{\n"query": {\n   "bool": {\n      "must": { "terms": {"about": ["travel","history"]}}          \n     }\n  }\n}\n\nterm主要是用于精确的过滤比如说：”我爱你”\n\n在match下面匹配可以为包含：我、爱、你、我爱等等的解析器\n\n在term语法下面就精准匹配到：”我爱你”\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h4",{attrs:{id:"_2-2-7、range过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-7、range过滤"}},[s._v("#")]),s._v(" 2.2.7、Range过滤")]),s._v(" "),n("p",[s._v("Range过滤允许我们按照指定的范围查找一些数据：操作范围：gt::大于，gae::大于等于,lt::小于，lte::小于等于")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('例子：\n\n查找出大于20岁，小于等于25岁的学生\n\nGET /school/student/_search?pretty\n{\n"query": {\n   "range": {\n    "age": {"gt":20,"lte":25}\n         }\n      }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h4",{attrs:{id:"_2-2-8、exists和-missing过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-8、exists和-missing过滤"}},[s._v("#")]),s._v(" 2.2.8、exists和 missing过滤")]),s._v(" "),n("p",[s._v("exists和missing过滤可以找到文档中是否包含某个字段或者是没有某个字段")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('例子：\n\n查找字段中包含age的文档\n\nGET /school/student/_search?pretty\n{\n"query": {\n   "exists": {\n    "field": "age"  \n         }\n      }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h4",{attrs:{id:"_2-2-9、bool的多条件过滤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-9、bool的多条件过滤"}},[s._v("#")]),s._v(" 2.2.9、bool的多条件过滤")]),s._v(" "),n("p",[s._v("用bool也可以像之前match一样来过滤多行条件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('must :: 多个查询条件的完全匹配,相当于 and 。*\n*must_not :: 多个查询条件的相反匹配，相当于 not 。*\n*should :: 至少有一个查询条件匹配, 相当于 or\n\n例子：\n\n过滤出about字段包含travel并且年龄大于20岁小于30岁的同学\n\nGET /school/student/_search?pretty\n{\n  "query": {\n    "bool": {\n      "must": [\n        {"term": {\n          "about": {\n            "value": "travel"\n          }\n        }},{"range": {\n          "age": {\n            "gte": 20,\n            "lte": 30\n          }\n        }}\n      ]\n    }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h4",{attrs:{id:"_2-2-10、查询与过滤条件合并"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-10、查询与过滤条件合并"}},[s._v("#")]),s._v(" 2.2.10、查询与过滤条件合并")]),s._v(" "),n("p",[s._v("通常复杂的查询语句，我们也要配合过滤语句来实现缓存，用filter语句就可以来实现")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('例子：\n\n查询出喜欢旅行的，并且年龄是20岁的文档\n\nGET /school/student/_search?pretty\n{\n  "query": {\n   "bool": {\n     "must": {"match": {"about": "travel"}},     \n     "filter": [{"term":{"age": 20}}]\n     }\n  }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"_2-3、-定义字段类型mappings"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3、-定义字段类型mappings"}},[s._v("#")]),s._v(" 2.3、 定义字段类型mappings")]),s._v(" "),n("p",[s._v("在es当中，每个字段都会有默认的类型，根据我们第一次插入数据进去，es会自动帮我们推断字段的类型，当然我们也可以通过设置mappings来提前自定义我们字段的类型")]),s._v(" "),n("h4",{attrs:{id:"_2-3-1、-使用mappings来-提前-定义字段类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1、-使用mappings来-提前-定义字段类型"}},[s._v("#")]),s._v(" 2.3.1、 使用mappings来 提前 定义字段类型")]),s._v(" "),n("p",[n("strong",[s._v("使用mapping的映射管理，提前指定字段的类型，防止后续的程序问题；")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE  document\nPUT document\n{\n  "mappings": {\n    "article" : {\n      "properties":\n      {\n        "title" : {"type": "text"} , \n        "author" : {"type": "text"} , \n        "titleScore" : {"type": "double"} \n        \n      }\n    }\n  }\n}\nget document/article/_mapping\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h4",{attrs:{id:"_2-3-2-基本命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-基本命令"}},[s._v("#")]),s._v(" 2.3.2. 基本命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE school\nPUT school\n{\n  "mappings": {\n    "logs" : {\n      "properties": {"messages" : {"type": "text"}}\n    }\n  }\n}\n\n添加索引：school，文档类型类logs，索引字段为message ，字段的类型为text\n\nGET /school/_mapping/logs\n\n继续添加字段\n\nPOST /school/_mapping/logs\n{\n  "properties": {"number" : {"type": "text"}}\n}\n\nGET /school/_mapping/logs\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("h4",{attrs:{id:"_2-3-3-获取映射字段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-获取映射字段"}},[s._v("#")]),s._v(" 2.3.3. 获取映射字段")]),s._v(" "),n("p",[s._v("语法：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("GET /school/_mapping/logs/field/number\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_2-3-4、管理-索引库分片数以及副本数settings"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4、管理-索引库分片数以及副本数settings"}},[s._v("#")]),s._v(" 2.3.4、管理 索引库分片数以及副本数settings")]),s._v(" "),n("p",[n("strong",[s._v("所谓的settings就是用来修改索引分片和副本数的；")])]),s._v(" "),n("p",[s._v("比如有的重要索引，副本数很少甚至没有副本，那么我们可以通过setting来添加副本数")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE document\nPUT document\n{\n  "mappings": {\n    "article" : {\n      "properties":\n      {\n        "title" : {"type": "text"} , \n        "author" : {"type": "text"} , \n        "titleScore" : {"type": "double"} \n        \n      }\n    }\n  }\n}\n\nGET /document/_settings\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111241616897.jpg",alt:"img"}})]),s._v(" "),n("p",[s._v("可以看到当前的副本数是1，那么为了提高容错性，我们可以把副本数改成2：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /document/_settings\n{\n  "number_of_replicas": 2\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111241616907.jpg",alt:"img"}})]),s._v(" "),n("p",[n("strong",[s._v("副本可以改，分片不能改")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('PUT /document/_settings\n{\n  "number_of_shards": 3\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111241616227.jpg",alt:"img"}})]),s._v(" "),n("h2",{attrs:{id:"_3-分页解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-分页解决方案"}},[s._v("#")]),s._v(" 3. 分页解决方案")]),s._v(" "),n("h3",{attrs:{id:"_3-1、导入数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、导入数据"}},[s._v("#")]),s._v(" 3.1、导入数据")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('DELETE us\nPOST /_bulk\n{ "create": { "_index": "us", "_type": "tweet", "_id": "1" }}\n{ "email" : "john@smith.com", "name" : "John Smith", "username" : "@john" }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "2" }}\n{ "email" : "mary@jones.com", "name" : "Mary Jones", "username" : "@mary" }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "3" }}\n{ "date" : "2014-09-13", "name" : "Mary Jones", "tweet" : "Elasticsearch means full text search has never been so easy", "user_id" : 2 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "4" }}\n{ "date" : "2014-09-14", "name" : "John Smith", "tweet" : "@mary it is not just text, it does everything", "user_id" : 1 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "5" }}\n{ "date" : "2014-09-15", "name" : "Mary Jones", "tweet" : "However did I manage before Elasticsearch?", "user_id" : 2 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "6" }}\n{ "date" : "2014-09-16", "name" : "John Smith",  "tweet" : "The Elasticsearch API is really easy to use", "user_id" : 1 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "7" }}\n{ "date" : "2014-09-17", "name" : "Mary Jones", "tweet" : "The Query DSL is really powerful and flexible", "user_id" : 2 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "8" }}\n{ "date" : "2014-09-18", "name" : "John Smith", "user_id" : 1 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "9" }}\n{ "date" : "2014-09-19", "name" : "Mary Jones", "tweet" : "Geo-location aggregations are really cool", "user_id" : 2 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "10" }}\n{ "date" : "2014-09-20", "name" : "John Smith", "tweet" : "Elasticsearch surely is one of the hottest new NoSQL products", "user_id" : 1 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "11" }}\n{ "date" : "2014-09-21", "name" : "Mary Jones", "tweet" : "Elasticsearch is built for the cloud, easy to scale", "user_id" : 2 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "12" }}\n{ "date" : "2014-09-22", "name" : "John Smith", "tweet" : "Elasticsearch and I have left the honeymoon stage, and I still love her.", "user_id" : 1 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "13" }}\n{ "date" : "2014-09-23", "name" : "Mary Jones", "tweet" : "So yes, I am an Elasticsearch fanboy", "user_id" : 2 }\n{ "create": { "_index": "us", "_type": "tweet", "_id": "14" }}\n{ "date" : "2014-09-24", "name" : "John Smith", "tweet" : "How many more cheesy tweets do I have to write?", "user_id" : 1 }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("h3",{attrs:{id:"_3-2、size-from浅分页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、size-from浅分页"}},[s._v("#")]),s._v(" 3.2、size+from浅分页")]),s._v(" "),n("p",[s._v("按照一般的查询流程来说，如果我想查询前10条数据：")]),s._v(" "),n("p",[s._v("• 1 客户端请求发给某个节点")]),s._v(" "),n("p",[s._v("• 2 节点转发给个个分片，查询每个分片上的前10条")]),s._v(" "),n("p",[s._v("• 3 结果返回给节点，整合数据，提取前10条")]),s._v(" "),n("p",[s._v("• 4 返回给请求客户端")]),s._v(" "),n("p",[n("strong",[s._v("from定义了目标数据的偏移值，size定义当前返回的事件数目")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /us/_search?pretty\n{\n  "from" : 0 , "size" : 5\n}\n\nGET /us/_search?pretty\n{\n  "from" : 5 , "size" : 5\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("这种浅分页只适合少量数据，因为随from增大，查询的时间就会越大，而且数据量越大，查询的效率指数下降")]),s._v(" "),n("p",[s._v("优点：from+size在数据量不大的情况下，效率比较高")]),s._v(" "),n("p",[s._v("缺点：在数据量非常大的情况下，from+size分页会把全部记录加载到内存中，这样做不但运行速递特别慢，而且容易让es出现内存不足而挂掉")]),s._v(" "),n("h3",{attrs:{id:"_3-3、scroll深分页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3、scroll深分页"}},[s._v("#")]),s._v(" 3.3、scroll深分页")]),s._v(" "),n("p",[s._v("对于上面介绍的浅分页，当Elasticsearch响应请求时，它必须确定docs的顺序，排列响应结果。")]),s._v(" "),n("p",[s._v("如果请求的页数较少（假设每页20个docs）, Elasticsearch不会有什么问题，但是如果页数较大时，比如请求第20页，Elasticsearch不得不取出第1页到第20页的所有docs，再去除第1页到第19页的docs，得到第20页的docs。")]),s._v(" "),n("p",[s._v("解决的方式就是使用scroll，"),n("strong",[s._v("scroll就是维护了当前索引段的一份快照信息--缓存")]),s._v("（这个快照信息是你执行这个scroll查询时的快照）。")]),s._v(" "),n("p",[s._v("可以把 scroll 分为初始化和遍历两步： 1、初始化时将所有符合搜索条件的搜索结果缓存起来，可以想象成快照； 2、遍历时，从这个快照里取数据；")]),s._v(" "),n("p",[s._v("初始化")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET us/_search?scroll=3m\n{ \n"query": {"match_all": {}},\n "size": 3\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("初始化的时候就像是普通的search一样")]),s._v(" "),n("p",[s._v("其中的scroll=3m代表当前查询的数据缓存3分钟")]),s._v(" "),n("p",[s._v("Size：3 代表当前查询3条数据")]),s._v(" "),n("p",[s._v("遍历")]),s._v(" "),n("p",[s._v("在遍历时候，拿到上一次遍历中的"),n("em",[s._v("scroll")]),s._v("id，然后带scroll参数，重复上一次的遍历步骤，知道返回的数据为空，就表示遍历完成")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET /_search/scroll\n{\n  "scroll" : "1m",\n  "scroll_id" : "DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAAPXFk0xN1BmSnlVUldhYThEdWVzZ19xbkEAAAAAAAAAIxZuQWVJU0VSZ1JzcVZtMGVYZ3RDaFlBAAAAAAAAA9oWTVZOdHJ2cXBSOU9wN3c1dk5vcWd4QQAAAAAAAAPYFk0xN1BmSnlVUldhYThEdWVzZ19xbkEAAAAAAAAAIhZuQWVJU0VSZ1JzcVZtMGVYZ3RDaFlB"\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("【注意】：每次都要传参数scroll，刷新搜索结果的缓存时间，另外不需要指定index和type（"),n("strong",[s._v("不要把缓存的时时间设置太长，占用内存")]),s._v("）")]),s._v(" "),n("p",[n("strong",[s._v("对比")])]),s._v(" "),n("p",[s._v("浅分页，每次查询都会去索引库（本地文件夹）中查询pageNum*page条数据，然后截取掉前面的数据，留下最后的数据。 这样的操作在每个分片上都会执行，最后会将多个分片的数据合并到一起，再次排序，截取需要的。")]),s._v(" "),n("p",[s._v("深分页，可以一次性将所有满足查询条件的数据，都放到内存中。分页的时候，在内存中查询。相对浅分页，就可以避免多次读取磁盘。")]),s._v(" "),n("h2",{attrs:{id:"_4-es的-中文-分词器ik"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-es的-中文-分词器ik"}},[s._v("#")]),s._v(" 4 . ES的 中文 分词器IK")]),s._v(" "),n("p",[s._v("ES默认对英文文本的分词器支持较好，但和lucene一样，如果需要对中文进行全文检索，那么需要使用中文分词器，同lucene一样，在使用中文全文检索前，需要集成IK分词器。那么我们接下来就来安装IK分词器，以实现中文的分词")]),s._v(" "),n("h3",{attrs:{id:"_4-1-三台-机器安装-ik分词器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-三台-机器安装-ik分词器"}},[s._v("#")]),s._v(" 4.1  三台 机器安装 IK分词器")]),s._v(" "),n("p",[s._v("将安装包上传到node01机器的/home/es路径下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd / kfly/soft\n\nwget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.7.0/elasticsearch-analysis-ik-6.7.0.zip\n\n\\# 将ik分词器的插件，解压到对应路径下 \n\ncd / kfly/soft\n\nmkdir -p / kfly/install/elasticsearch-6.7.0/plugins/analysis-ik\n\nunzip elasticsearch-analysis-ik-6.7.0.zip  -d / kfly/install/elasticsearch-6.7.0/plugins/analysis-ik/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("将安装包分发到其他机器上")]),s._v(" "),n("p",[s._v("node01机器执行以下命令进行安装包的分发")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd / kfly/install/elasticsearch-6.7.0/plugins \n\nscp -r analysis-ik/ node02:$PWD \n\nscp -r analysis-ik/ node03:$PWD\n\n\\# 三台机器都配置完成*\n*# 配置完成之后，需要重启服务*。*\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("三台机器重启es服务")]),s._v(" "),n("p",[s._v("三台机器执行以下命令停止es服务并重启es服务")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ps -ef|grep elasticsearch | grep bootstrap | awk '{print $2}' |xargs kill -9\n\nnohup / kfly/install/elasticsearch-6.7.0/bin/elasticsearch 2>&1 &\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"_4-2-创建-索引库并配置-ik分词器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-创建-索引库并配置-ik分词器"}},[s._v("#")]),s._v(" 4.2 创建 索引库并配置 IK分词器")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('delete iktest\nPUT /iktest?pretty\n{\n    "settings" : {\n        "analysis" : {\n            "analyzer" : {\n                "ik" : {\n                    "tokenizer" : "ik_max_word"\n                }\n            }\n        }\n    },\n    "mappings" : {\n        "article" : {\n            "dynamic" : true,\n            "properties" : {\n                "subject" : {\n                    "type" : "text",\n                    "analyzer" : "ik_max_word"\n                }\n            }\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("说明：在创建索引库的时候，我们指定分词方式为ik_max_word，会对我们的中文进行最细粒度的切分")]),s._v(" "),n("h3",{attrs:{id:"_4-3-查看分词效果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-查看分词效果"}},[s._v("#")]),s._v(" 4.3  查看分词效果")]),s._v(" "),n("p",[s._v("在kibana当中执行以下查询，并验证分词效果")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('GET _analyze?pretty\n  {\n    "analyzer": "ik_max_word",\n    "text": "特朗普是美国总统"\n  }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_4-4-插入测试数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-插入测试数据"}},[s._v("#")]),s._v(" 4.4  插入测试数据")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /iktest/article/_bulk?pretty\n{ "index" : { "_id" : "1" } }\n{"subject" : "＂闺蜜＂崔顺实被韩检方传唤 韩总统府促彻查真相" }\n{ "index" : { "_id" : "2" } }\n{"subject" : "韩举行＂护国训练＂ 青瓦台:决不许国家安全出问题" }\n{ "index" : { "_id" : "3" } }\n{"subject" : "媒体称FBI已经取得搜查令 检视希拉里电邮" }\n{ "index" : { "_id" : "4" } }\n{"subject" : "村上春树获安徒生奖 演讲中谈及欧洲排外问题" }\n{ "index" : { "_id" : "5" } }\n{"subject" : "希拉里团队炮轰FBI 参院民主党领袖批其”违法”" }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("查看分词器")]),s._v(" "),n("p",[s._v('对"希拉里和韩国"进行分词查询')]),s._v(" "),n("p",[s._v("ikmaxword分词后的效果：希|拉|里|希拉里|和|韩国")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('POST /iktest/article/_search?pretty\n{\n    "query" : { "match" : { "subject" : "希拉里和韩国" }},\n    "highlight" : {\n        "pre_tags" : ["<font color=red>"],\n        "post_tags" : ["</font>"],\n        "fields" : {\n            "subject" : {}\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"_4-5-配置-热词更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-配置-热词更新"}},[s._v("#")]),s._v(" 4.5 配置 热词更新")]),s._v(" "),n("p",[s._v("查看分词效果")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(' GET _analyze?pretty\n\n {\n\n  "analyzer": "ik_max_word",\n\n  "text": "小老弟，你怎么肥事，老铁你来了！！！"\n\n }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("我们会发现，随着时间的推移和发展，有些网络热词我们并不能进行分词，因为网络热词并没有定义在我们的词库里面，这就需要我们经常能够实时的更新我们的网络热词，我们可以通过tomcat来实现远程词库来解决这个问题。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111241540814.jpeg",alt:"img"}})]),s._v(" "),n("h4",{attrs:{id:"_4-5-1-node03配置tomcat"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-1-node03配置tomcat"}},[s._v("#")]),s._v(" 4.5.1. node03配置Tomcat")]),s._v(" "),n("p",[s._v("使用hadoop用户来进行配置tomcat，此处我们将tomcat装在node03机器上面即可，将我们的tomcat安装包上传到node03服务器的/ kfly/soft路径下，然后进行解压")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd / kfly/soft/\n\ntar -zxf apache-tomcat-8.5.34.tar.gz -C / kfly/install/\n\ntomcat当中添加配置hot.dic\n\ncd / kfly/install/apache-tomcat-8.5.34/webapps/ROOT\n\nvi hot.dic \n\n \n\n老铁\n\n肥事\n\n启动tomcat\n\ncd / kfly/install/apache-tomcat-8.5.34/\n\nbin/startup.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("浏览器访问以验证tomcat是否安装成功")]),s._v(" "),n("p",[s._v("wget http://node03:8080/hot.dic")]),s._v(" "),n("p",[s._v("如果能够访问到，则证明tomcat安装成功")]),s._v(" "),n("h4",{attrs:{id:"_4-5-2-三台机器-修改配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-2-三台机器-修改配置文件"}},[s._v("#")]),s._v(" 4.5.2.  三台机器 修改配置文件")]),s._v(" "),n("p",[s._v("三台机器都要修改es的配置文件（使用es用户来进行修改即可）")]),s._v(" "),n("p",[s._v("第一台机器node01修改es的配置")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd / kfly/install/elasticsearch-6.7.0/plugins/analysis-ik/config\n\nvim IKAnalyzer.cfg.xml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">\n<properties>\n    <comment>IK Analyzer 扩展配置</comment>\n    \x3c!--用户可以在这里配置自己的扩展字典 --\x3e\n    <entry key="ext_dict"></entry>\n     \x3c!--用户可以在这里配置自己的扩展停止词字典--\x3e\n    <entry key="ext_stopwords"></entry>\n    \x3c!--用户可以在这里配置远程扩展字典 --\x3e\n    <entry key="remote_ext_dict">http://node03:8080/hot.dic</entry>\n    \x3c!--用户可以在这里配置远程扩展停止词字典--\x3e\n    \x3c!-- <entry key="remote_ext_stopwords">words_location</entry> --\x3e\n</properties>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("修改完成之后拷贝到node02与node03机器上面去")]),s._v(" "),n("p",[s._v("node01执行以下命令进行拷贝")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd / kfly/install/elasticsearch-6.7.0/plugins/analysis-ik/config \n\nscp IKAnalyzer.cfg.xml  node02:$PWD \n\nscp IKAnalyzer.cfg.xml  node03:$PWD \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"_4-5-3、三台-机器-重新-启动es"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-3、三台-机器-重新-启动es"}},[s._v("#")]),s._v(" 4.5.3、三台 机器 重新 启动es")]),s._v(" "),n("p",[s._v("三台机器重新启动es服务，三台机器先使用kill -9杀死es的服务，然后再执行以下命令进行重启")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ps -ef|grep elasticsearch | grep bootstrap | awk '{print $2}' |xargs kill -9\n\nnohup / kfly/install/elasticsearch-6.7.0/bin/elasticsearch 2>&1 &\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("在kibana当中执行以下命令，查看我们的分词过程")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(' GET _analyze?pretty\n\n {\n\n  "analyzer": "ik_max_word",\n\n  "text": "小老弟，你怎么肥事，老铁你来了"\n\n }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);