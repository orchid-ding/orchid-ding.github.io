(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{569:function(s,a,t){"use strict";t.r(a);var e=t(19),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"hive常用函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hive常用函数"}},[s._v("#")]),s._v(" Hive常用函数")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF",target:"_blank",rel:"noopener noreferrer"}},[s._v("UDF官网 : https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/apache/hive/blob/18d0b5a46c23056d3fe60032e00de4534a5be533/ql/src/java/org/apache/hadoop/hive/ql/exec/FunctionRegistry.java",target:"_blank",rel:"noopener noreferrer"}},[s._v("github FunctionRegistry.java 查看具体注册代码"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"hive的参数传递"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hive的参数传递"}},[s._v("#")]),s._v(" Hive的参数传递")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-hiveconf "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-i filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("* "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-f filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-e query-string"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、   -i 从文件初始化HQL。\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、   -e从命令行执行指定的HQL \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、   -f 执行HQL脚本 \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、   -v 输出执行的HQL语句到控制台 \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、   -p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" connect to Hive Server on port number \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("、   -hiveconf "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y Use this to "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" hive/hadoop configuration variables.  设置hive运行时候的参数配置\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("Hive参数大全：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("开发Hive应用时，不可避免地需要设定Hive的参数。设定Hive的参数可以调优HQL代码的执行效率，或帮助定位问题。然而实践中经常遇到的一个问题是，为什么设定的参数没有起作用？这通常是错误的设定方式导致的。")]),s._v(" "),t("p",[t("strong",[s._v("对于一般参数，有以下三种设定方式：")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 配置文件 ,以及读取的hadoop配置")]),s._v("\nhive-site.xml "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" hive-default.xml "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" hadoop配置\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 命令行参数  启动hive客户端的时候可以设置参数")]),s._v("\nbin/hive -hiveconf hive.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 参数声明   进入客户端以后设置的一些参数  set ")]),s._v("\nbin/hive\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" mapred.reduce.tasks"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 优先级： 参数声明  >   命令行参数   >  配置文件参数（hive）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"hiveconf使用说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hiveconf使用说明"}},[s._v("#")]),s._v(" hiveconf使用说明")]),s._v(" "),t("p",[s._v("hiveconf用于定义HIVE执行上下文的属性(配置参数)，可覆盖覆盖hive-site.xml（hive-default.xml）中的参数值，如用户执行目录、日志打印级别、执行队列等。例如我们可以使用hiveconf来覆盖我们的hive属性配置，")]),s._v(" "),t("p",[s._v("hiveconf变量取值必须要使用hiveconf作为前缀参数，具体格式如下:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('${hiveconf:key} \nbin/hive --hiveconf "mapred.job.queue.name=root.default"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"hivevar使用说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hivevar使用说明"}},[s._v("#")]),s._v(" hivevar使用说明")]),s._v(" "),t("p",[s._v("hivevar用于定义HIVE运行时的变量替换，类似于JAVA中的“PreparedStatement”，与${key}配合使用或者与 ${hivevar:key}")]),s._v(" "),t("p",[s._v("对于hivevar取值可以不使用前缀hivevar，具体格式如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("使用前缀:\n ${hivevar:key}\n不使用前缀:\n ${key}\n--hivevar  name=zhangsan    ${hivevar:name}  \n也可以这样取值  ${name}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"define使用说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#define使用说明"}},[s._v("#")]),s._v(" define使用说明")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('define与hivevar用途完全一样，还有一种简写“-d\nbin/hive --hiveconf "mapred.job.queue.name=root.default" -d my="201809" --database mydb\n执行SQL\nselect * from mydb where concat(year, month) = ${my} limit 10;\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"hiveconf与hivevar使用实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hiveconf与hivevar使用实战"}},[s._v("#")]),s._v(" hiveconf与hivevar使用实战")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 脚本文件如下 /kfly/sql/query.sql")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from student left "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" score on student.s_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" score.s_id where score.month "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${hiveconf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("month}")]),s._v(" and score.s_score "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${hivevar"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("s_score}")]),s._v(" and score.c_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${c_id}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行脚本文件")]),s._v("\nbin/hive --hiveconf "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("month")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("201807")]),s._v(" --hivevar "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("s_score")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --hivevar "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("c_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("03  -f /kfly/sql/query.sql\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"常用函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用函数"}},[s._v("#")]),s._v(" 常用函数")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1．查看系统自带的函数")]),s._v("\nhive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show functions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2．显示自带的函数的用法")]),s._v("\nhive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" desc "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3．详细显示自带的函数的用法")]),s._v("\nhive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" desc "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" extended upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_1、数值计算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、数值计算"}},[s._v("#")]),s._v(" 1、数值计算")]),s._v(" "),t("h4",{attrs:{id:"_1、取整函数-round"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、取整函数-round"}},[s._v("#")]),s._v(" 1、取整函数: round")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": round(double a)\n"),t("strong",[s._v("返回值")]),s._v(": BIGINT\n"),t("strong",[s._v("说明")]),s._v(": 返回double类型的整数值部分 （遵循四舍五入）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" round"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1415926")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from tableName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nhive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" round"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from tableName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nhive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create table tableName as "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" round"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9542.158")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from tableName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_2、指定精度取整函数-round"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、指定精度取整函数-round"}},[s._v("#")]),s._v(" 2、指定精度取整函数: round")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": round(double a, int d)\n"),t("strong",[s._v("返回值")]),s._v(": DOUBLE\n"),t("strong",[s._v("说明")]),s._v(": 返回指定精度d的double类型")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" round"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1415926")]),s._v(",4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" from tableName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1416")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_3、向下取整函数-floor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、向下取整函数-floor"}},[s._v("#")]),s._v(" 3、向下取整函数: floor")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": floor(double a)\n"),t("strong",[s._v("返回值")]),s._v(": BIGINT\n"),t("strong",[s._v("说明")]),s._v(": 返回等于或者小于该double变量的最大的整数")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select floor(3.1415926) from tableName;\n3\nhive> select floor(25) from tableName;\n25\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_4、向上取整函数-ceil"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、向上取整函数-ceil"}},[s._v("#")]),s._v(" 4、向上取整函数: ceil")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": ceil(double a)\n"),t("strong",[s._v("返回值")]),s._v(": BIGINT\n"),t("strong",[s._v("说明")]),s._v(": 返回等于或者大于该double变量的最小的整数")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select ceil(3.1415926) from tableName;\n4\nhive> select ceil(46) from tableName;\n46\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_5、向上取整函数-ceiling"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、向上取整函数-ceiling"}},[s._v("#")]),s._v(" 5、向上取整函数: ceiling")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": ceiling(double a)\n"),t("strong",[s._v("返回值")]),s._v(": BIGINT\n"),t("strong",[s._v("说明")]),s._v(": 与ceil功能相同")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select ceiling(3.1415926) from tableName;\n4\nhive> select ceiling(46) from tableName;\n46\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_6、取随机数函数-rand"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、取随机数函数-rand"}},[s._v("#")]),s._v(" 6、取随机数函数: rand")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": rand(),rand(int seed)\n"),t("strong",[s._v("返回值")]),s._v(": double\n"),t("strong",[s._v("说明")]),s._v(": 返回一个0到1范围内的随机数。如果指定种子seed，则会等到一个稳定的随机数序列")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select rand() from tableName;\n0.5577432776034763\nhive> select rand() from tableName;\n0.6638336467363424\nhive> select rand(100) from tableName;\n0.7220096548596434\nhive> select rand(100) from tableName;\n0.7220096548596434\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_2、日期函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、日期函数"}},[s._v("#")]),s._v(" 2、日期函数")]),s._v(" "),t("h4",{attrs:{id:"_1、unix时间戳转日期函数-from-unixtime"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、unix时间戳转日期函数-from-unixtime"}},[s._v("#")]),s._v(" 1、UNIX时间戳转日期函数: from_unixtime")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": from_unixtime(bigint unixtime[, string format])\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v(": 转化UNIX时间戳（从1970-01-01 00:00:00 UTC到指定时间的秒数）到当前时区的时间格式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select from_unixtime(1323308943,'yyyyMMdd') from tableName;\n20111208\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_2、获取当前unix时间戳函数-unix-timestamp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、获取当前unix时间戳函数-unix-timestamp"}},[s._v("#")]),s._v(" 2、获取当前UNIX时间戳函数: unix_timestamp")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": unix_timestamp()\n"),t("strong",[s._v("返回值")]),s._v(": bigint\n"),t("strong",[s._v("说明")]),s._v(": 获得当前时区的UNIX时间戳")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select unix_timestamp() from tableName;\n1323309615\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_3、日期转unix时间戳函数-unix-timestamp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、日期转unix时间戳函数-unix-timestamp"}},[s._v("#")]),s._v(" 3、日期转UNIX时间戳函数: unix_timestamp")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": unix_timestamp(string date)\n"),t("strong",[s._v("返回值")]),s._v(": bigint\n"),t("strong",[s._v("说明")]),s._v(': 转换格式为"yyyy-MM-dd HH:mm:ss"的日期到UNIX时间戳。如果转化失败，则返回0。')]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select unix_timestamp('2011-12-07 13:01:03') from tableName;\n1323234063\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_4、指定格式日期转unix时间戳函数-unix-timestamp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、指定格式日期转unix时间戳函数-unix-timestamp"}},[s._v("#")]),s._v(" 4、指定格式日期转UNIX时间戳函数: unix_timestamp")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": unix_timestamp(string date, string pattern)\n"),t("strong",[s._v("返回值")]),s._v(": bigint\n"),t("strong",[s._v("说明")]),s._v(": 转换pattern格式的日期到UNIX时间戳。如果转化失败，则返回0。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select unix_timestamp('20111207 13:01:03','yyyyMMdd HH:mm:ss') from tableName;\n1323234063\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_5、日期时间转日期函数-to-date"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、日期时间转日期函数-to-date"}},[s._v("#")]),s._v(" 5、日期时间转日期函数: to_date")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": to_date(string timestamp)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v(": 返回日期时间字段中的日期部分。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select to_date('2011-12-08 10:03:01') from tableName;\n2011-12-08\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_6、日期转年函数-year"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、日期转年函数-year"}},[s._v("#")]),s._v(" 6、日期转年函数: year")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": year(string date)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回日期中的年。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select year('2011-12-08 10:03:01') from tableName;\n2011\nhive> select year('2012-12-08') from tableName;\n2012\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_7、日期转月函数-month"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7、日期转月函数-month"}},[s._v("#")]),s._v(" 7、日期转月函数: month")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": month (string date)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回日期中的月份。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select month('2011-12-08 10:03:01') from tableName;\n12\nhive> select month('2011-08-08') from tableName;\n8\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_8、日期转天函数-day"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8、日期转天函数-day"}},[s._v("#")]),s._v(" 8、日期转天函数: day")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": day (string date)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回日期中的天。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select day('2011-12-08 10:03:01') from tableName;\n8\nhive> select day('2011-12-24') from tableName;\n24\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_9、日期转小时函数-hour"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9、日期转小时函数-hour"}},[s._v("#")]),s._v(" 9、日期转小时函数: hour")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": hour (string date)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回日期中的小时。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select hour('2011-12-08 10:03:01') from tableName;\n10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_10、日期转分钟函数-minute"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10、日期转分钟函数-minute"}},[s._v("#")]),s._v(" 10、日期转分钟函数: minute")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": minute (string date)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回日期中的分钟。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select minute('2011-12-08 10:03:01') from tableName;\n3\n\nhive> select second('2011-12-08 10:03:01') from tableName;\n1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_12、日期转周函数-weekofyear"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12、日期转周函数-weekofyear"}},[s._v("#")]),s._v(" 12、日期转周函数: weekofyear")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": weekofyear (string date)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回日期在当前的周数。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select weekofyear('2011-12-08 10:03:01') from tableName;\n49\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_13、日期比较函数-datediff"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13、日期比较函数-datediff"}},[s._v("#")]),s._v(" 13、日期比较函数: datediff")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": datediff(string enddate, string startdate)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回结束日期减去开始日期的天数。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select datediff('2012-12-08','2012-05-09') from tableName;\n213\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_14、日期增加函数-date-add"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14、日期增加函数-date-add"}},[s._v("#")]),s._v(" 14、日期增加函数: date_add")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": date_add(string startdate, int days)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v(": 返回开始日期startdate增加days天后的日期。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select date_add('2012-12-08',10) from tableName;\n2012-12-18\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_15、日期减少函数-date-sub"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15、日期减少函数-date-sub"}},[s._v("#")]),s._v(" 15、日期减少函数: date_sub")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": date_sub (string startdate, int days)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v(": 返回开始日期startdate减少days天后的日期。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select date_sub('2012-12-08',10) from tableName;\n2012-11-28\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_3、条件函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、条件函数"}},[s._v("#")]),s._v(" 3、条件函数")]),s._v(" "),t("h4",{attrs:{id:"_1、if函数-if"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、if函数-if"}},[s._v("#")]),s._v(" 1、If函数: if")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": if(boolean testCondition, T valueTrue, T valueFalseOrNull)\n"),t("strong",[s._v("返回值")]),s._v(": T\n"),t("strong",[s._v("说明")]),s._v(": 当条件testCondition为TRUE时，返回valueTrue；否则返回valueFalseOrNull")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select if(1=2,100,200) from tableName;\n200\nhive> select if(1=1,100,200) from tableName;\n100\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_2、非空查找函数-coalesce"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、非空查找函数-coalesce"}},[s._v("#")]),s._v(" 2、非空查找函数: COALESCE")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": COALESCE(T v1, T v2, …)\n"),t("strong",[s._v("返回值")]),s._v(": T\n"),t("strong",[s._v("说明")]),s._v(": 返回参数中的第一个非空值；如果所有值都为NULL，那么返回NULL")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select COALESCE(null,'100','50') from tableName;\n100\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_3、条件判断函数-case"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、条件判断函数-case"}},[s._v("#")]),s._v(" 3、条件判断函数：CASE")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END\n"),t("strong",[s._v("返回值")]),s._v(": T\n"),t("strong",[s._v("说明")]),s._v("：如果a等于b，那么返回c；如果a等于d，那么返回e；否则返回f")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> Select case 100 when 50 then 'tom' when 100 then 'mary' else 'tim' end from tableName;\nmary\nhive> Select case 200 when 50 then 'tom' when 100 then 'mary' else 'tim' end from tableName;\ntim\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_4、条件判断函数-case"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、条件判断函数-case"}},[s._v("#")]),s._v(" 4、条件判断函数：CASE")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": CASE WHEN a THEN b [WHEN c THEN d]* [ELSE e] END\n"),t("strong",[s._v("返回值")]),s._v(": T\n"),t("strong",[s._v("说明")]),s._v("：如果a为TRUE,则返回b；如果c为TRUE，则返回d；否则返回e")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select case when 1=2 then 'tom' when 2=2 then 'mary' else 'tim' end from tableName;\nmary\nhive> select case when 1=1 then 'tom' when 2=2 then 'mary' else 'tim' end from tableName;\ntom\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_4、字符串函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、字符串函数"}},[s._v("#")]),s._v(" 4、字符串函数")]),s._v(" "),t("h4",{attrs:{id:"_1、字符串长度函数-length"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、字符串长度函数-length"}},[s._v("#")]),s._v(" 1、字符串长度函数：length")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": length(string A)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v("：返回字符串A的长度")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select length('abcedfg') from tableName;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_2、字符串反转函数-reverse"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、字符串反转函数-reverse"}},[s._v("#")]),s._v(" 2、字符串反转函数：reverse")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": reverse(string A)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回字符串A的反转结果")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select reverse('abcedfg') from tableName;\ngfdecba\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_3、字符串连接函数-concat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、字符串连接函数-concat"}},[s._v("#")]),s._v(" 3、字符串连接函数：concat")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": concat(string A, string B…)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回输入字符串连接后的结果，支持任意个输入字符串")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select concat('abc','def','gh') from tableName;\nabcdefgh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_4、字符串连接并指定字符串分隔符-concat-ws"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、字符串连接并指定字符串分隔符-concat-ws"}},[s._v("#")]),s._v(" 4、字符串连接并指定字符串分隔符：concat_ws")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": concat_ws(string SEP, string A, string B…)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回输入字符串连接后的结果，SEP表示各个字符串间的分隔符")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select concat_ws(',','abc','def','gh')from tableName;\nabc,def,gh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_5、字符串截取函数-substr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、字符串截取函数-substr"}},[s._v("#")]),s._v(" 5、字符串截取函数：substr")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": substr(string A, int start),substring(string A, int start)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回字符串A从start位置到结尾的字符串")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select substr('abcde',3) from tableName;\ncde\nhive> select substring('abcde',3) from tableName;\ncde\nhive>  select substr('abcde',-1) from tableName;  （和ORACLE相同）\ne\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"_6、字符串截取函数-substr-substring"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、字符串截取函数-substr-substring"}},[s._v("#")]),s._v(" 6、字符串截取函数：substr,substring")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": substr(string A, int start, int len),substring(string A, int start, int len)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回字符串A从start位置开始，长度为len的字符串")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select substr('abcde',3,2) from tableName;\ncd\nhive> select substring('abcde',3,2) from tableName;\ncd\nhive>select substring('abcde',-2,2) from tableName;\nde\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"_7、字符串转大写函数-upper-ucase"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7、字符串转大写函数-upper-ucase"}},[s._v("#")]),s._v(" 7、字符串转大写函数：upper,ucase")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": upper(string A) ucase(string A)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回字符串A的大写格式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select upper('abSEd') from tableName;\nABSED\nhive> select ucase('abSEd') from tableName;\nABSED\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_8、字符串转小写函数-lower-lcase"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8、字符串转小写函数-lower-lcase"}},[s._v("#")]),s._v(" 8、字符串转小写函数：lower,lcase")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": lower(string A) lcase(string A)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回字符串A的小写格式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select lower('abSEd') from tableName;\nabsed\nhive> select lcase('abSEd') from tableName;\nabsed\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_9、去空格函数-trim"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9、去空格函数-trim"}},[s._v("#")]),s._v(" 9、去空格函数：trim")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": trim(string A)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：去除字符串两边的空格")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select trim(' abc ') from tableName;\nabc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_10、url解析函数-parse-url"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10、url解析函数-parse-url"}},[s._v("#")]),s._v(" 10、url解析函数  parse_url")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(":\nparse_url(string urlString, string partToExtract [, string keyToExtract])\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回URL中指定的部分。partToExtract的有效值为：HOST, PATH,\nQUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select parse_url\n('https://www.tableName.com/path1/p.php?k1=v1&k2=v2#Ref1', 'HOST') \nfrom tableName;\nwww.tableName.com \nhive> select parse_url\n('https://www.tableName.com/path1/p.php?k1=v1&k2=v2#Ref1', 'QUERY', 'k1')\n from tableName;\nv1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"_11、json解析-get-json-object"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11、json解析-get-json-object"}},[s._v("#")]),s._v(" 11、json解析  get_json_object")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": get_json_object(string json_string, string path)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：解析json的字符串json_string,返回path指定的内容。如果输入的json字符串无效，那么返回NULL。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('hive> select  get_json_object(\'{"store":{"fruit":\\[{"weight":8,"type":"apple"},{"weight":9,"type":"pear"}], "bicycle":{"price":19.95,"color":"red"} },"email":"amy@only_for_json_udf_test.net","owner":"amy"}\',\'$.owner\') from tableName;\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_12、重复字符串函数-repeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12、重复字符串函数-repeat"}},[s._v("#")]),s._v(" 12、重复字符串函数：repeat")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": repeat(string str, int n)\n"),t("strong",[s._v("返回值")]),s._v(": string\n"),t("strong",[s._v("说明")]),s._v("：返回重复n次后的str字符串")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select repeat('abc',5) from tableName;\nabcabcabcabcabc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_13、分割字符串函数-split"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13、分割字符串函数-split"}},[s._v("#")]),s._v(" 13、分割字符串函数: split")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": split(string str, string pat)\n"),t("strong",[s._v("返回值")]),s._v(": array\n"),t("strong",[s._v("说明")]),s._v(": 按照pat字符串分割str，会返回分割后的字符串数组")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('hive> select split(\'abtcdtef\',\'t\') from tableName;\n["ab","cd","ef"]\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_5、集合统计函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、集合统计函数"}},[s._v("#")]),s._v(" 5、集合统计函数")]),s._v(" "),t("h4",{attrs:{id:"_1、个数统计函数-count"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、个数统计函数-count"}},[s._v("#")]),s._v(" 1、个数统计函数: count")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": count(*), count(expr), count(DISTINCT expr[, expr_.])\n"),t("strong",[s._v("返回值")]),s._v("：Int")]),s._v(" "),t("p",[t("strong",[s._v("说明")]),s._v(": count(*)统计检索出的行的个数，包括NULL值的行；count(expr)返回指定字段的非空值的个数；count(DISTINCT\nexpr[, expr_.])返回指定字段的不同的非空值的个数")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select count(*) from tableName;\n20\nhive> select count(distinct t) from tableName;\n10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_2、总和统计函数-sum"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、总和统计函数-sum"}},[s._v("#")]),s._v(" 2、总和统计函数: sum")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": sum(col), sum(DISTINCT col)\n"),t("strong",[s._v("返回值")]),s._v(": double\n"),t("strong",[s._v("说明")]),s._v(": sum(col)统计结果集中col的相加的结果；sum(DISTINCT col)统计结果中col不同值相加的结果")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select sum(t) from tableName;\n100\nhive> select sum(distinct t) from tableName;\n70\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_3、平均值统计函数-avg"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、平均值统计函数-avg"}},[s._v("#")]),s._v(" 3、平均值统计函数: avg")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": avg(col), avg(DISTINCT col)\n"),t("strong",[s._v("返回值")]),s._v(": double\n"),t("strong",[s._v("说明")]),s._v(": avg(col)统计结果集中col的平均值；avg(DISTINCT col)统计结果中col不同值相加的平均值")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select avg(t) from tableName;\n50\nhive> select avg (distinct t) from tableName;\n30\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_4、最小值统计函数-min"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、最小值统计函数-min"}},[s._v("#")]),s._v(" 4、最小值统计函数: min")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": min(col)\n"),t("strong",[s._v("返回值")]),s._v(": double\n"),t("strong",[s._v("说明")]),s._v(": 统计结果集中col字段的最小值")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select min(t) from tableName;\n20\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_5、最大值统计函数-max"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、最大值统计函数-max"}},[s._v("#")]),s._v(" 5、最大值统计函数: max")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": maxcol)\n"),t("strong",[s._v("返回值")]),s._v(": double\n"),t("strong",[s._v("说明")]),s._v(": 统计结果集中col字段的最大值")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select max(t) from tableName;\n120\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_6、复合类型构建函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、复合类型构建函数"}},[s._v("#")]),s._v(" 6、复合类型构建函数")]),s._v(" "),t("h4",{attrs:{id:"_1、map类型构建-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、map类型构建-map"}},[s._v("#")]),s._v(" 1、Map类型构建: map")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": map (key1, value1, key2, value2, …)\n"),t("strong",[s._v("说明")]),s._v("：根据输入的key和value对构建map类型")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("create table score_map(name string, score map<string,int>)\nrow format delimited fields terminated by '\\t' \ncollection items terminated by ',' map keys terminated by ':';\n\n创建数据内容如下并加载数据\ncd /kfly/install/hivedatas/\nvim score_map.txt\n\nzhangsan\t数学:80,语文:89,英语:95\nlisi\t语文:60,数学:80,英语:99\n\n加载数据到hive表当中去\nload data local inpath '/kfly/install/hivedatas/score_map.txt' overwrite into table score_map;\n\nmap结构数据访问：\n获取所有的value：\nselect name,map_values(score) from score_map;\n\n获取所有的key：\nselect name,map_keys(score) from score_map;\n\n按照key来进行获取value值\nselect name,score[\"数学\"]  from score_map;\n\n查看map元素个数\nselect name,size(score) from score_map;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h4",{attrs:{id:"_2、struct类型构建-struct"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、struct类型构建-struct"}},[s._v("#")]),s._v(" 2、Struct类型构建: struct")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": struct(val1, val2, val3, …)\n"),t("strong",[s._v("说明")]),s._v("：根据输入的参数构建结构体struct类型，似于C语言中的结构体，内部数据通过X.X来获取，假设我们的数据格式是这样的，电影ABC，有1254人评价过，打分为7.4分")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('创建struct表\nhive> create table movie_score( name string,  info struct<number:int,score:float> )row format delimited fields terminated by "\\t"  collection items terminated by ":"; \n\n加载数据\ncd /kfly/install/hivedatas/\nvim struct.txt\n\nABC\t1254:7.4  \nDEF\t256:4.9  \nXYZ\t456:5.4\n\n加载数据\nload data local inpath \'/kfly/install/hivedatas/struct.txt\' overwrite into table movie_score;\n\n\nhive当中查询数据\nhive> select * from movie_score;  \nhive> select info.number,info.score from movie_score;  \nOK  \n1254    7.4  \n256     4.9  \n456     5.4\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h4",{attrs:{id:"_3、array类型构建-array"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、array类型构建-array"}},[s._v("#")]),s._v(" 3、array类型构建: array")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": array(val1, val2, …)\n"),t("strong",[s._v("说明")]),s._v("：根据输入的参数构建数组array类型")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> create table  person(name string,work_locations array<string>)\nROW FORMAT DELIMITED\nFIELDS TERMINATED BY '\\t'\nCOLLECTION ITEMS TERMINATED BY ',';\n\n加载数据到person表当中去\ncd /kfly/install/hivedatas/\nvim person.txt\n\n数据内容格式如下\nbiansutao\tbeijing,shanghai,tianjin,hangzhou\nlinan\tchangchu,chengdu,wuhan\n\n加载数据\nhive > load  data local inpath '/kfly/install/hivedatas/person.txt' overwrite into table person;\n\n查询所有数据数据\nhive > select * from person;\n\n按照下表索引进行查询\nhive > select work_locations[0] from person;\n\n查询所有集合数据\nhive  > select work_locations from person; \n\n查询元素个数\nhive >  select size(work_locations) from person;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("h4",{attrs:{id:"_7、复杂类型长度统计函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7、复杂类型长度统计函数"}},[s._v("#")]),s._v(" 7、复杂类型长度统计函数")]),s._v(" "),t("h4",{attrs:{id:"_1-map类型长度函数-size-map-k-v"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-map类型长度函数-size-map-k-v"}},[s._v("#")]),s._v(" 1.Map类型长度函数: size(Map<k .V>)")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": size(Map<k .V>)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回map类型的长度")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select size(t) from map_table2;\n2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_2-array类型长度函数-size-array"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-array类型长度函数-size-array"}},[s._v("#")]),s._v(" 2.array类型长度函数: size(Array)")]),s._v(" "),t("p",[t("strong",[s._v("语法")]),s._v(": size(Array)\n"),t("strong",[s._v("返回值")]),s._v(": int\n"),t("strong",[s._v("说明")]),s._v(": 返回array类型的长度")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select size(t) from arr_table2;\n4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_3-类型转换函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-类型转换函数"}},[s._v("#")]),s._v(" 3.类型转换函数")]),s._v(" "),t("p",[t("strong",[s._v("类型转换函数")]),s._v(": cast\n"),t("strong",[s._v("语法")]),s._v(": cast(expr as )\n"),t("strong",[s._v("返回值")]),s._v(': Expected "=" to follow "type"\n'),t("strong",[s._v("说明")]),s._v(": 返回转换后的数据类型")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive> select cast('1' as bigint) from tableName;\n1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"_8、hive当中的lateral-view-与-explode以及reflect和分析函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8、hive当中的lateral-view-与-explode以及reflect和分析函数"}},[s._v("#")]),s._v(" 8、hive当中的lateral view 与 explode以及reflect和分析函数")]),s._v(" "),t("h4",{attrs:{id:"_1、使用explode函数将hive表中的map和array字段数据进行拆分"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用explode函数将hive表中的map和array字段数据进行拆分"}},[s._v("#")]),s._v(" 1、使用explode函数将hive表中的Map和Array字段数据进行拆分")]),s._v(" "),t("p",[s._v("lateral view用于和split、explode等UDTF一起使用的，能将一行数据拆分成多行数据，在此基础上可以对拆分的数据进行聚合，lateral view首先为原始表的每行调用UDTF，UDTF会把一行拆分成一行或者多行，lateral view在把结果组合，产生一个支持别名表的虚拟表。\n其中explode还可以用于将hive一列中复杂的array或者map结构拆分成多行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("需求：现在有数据格式如下\nzhangsan\tchild1,child2,child3,child4\tk1:v1,k2:v2\nlisi\tchild5,child6,child7,child8\t k3:v3,k4:v4\n\n字段之间使用"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("t分割，需求将所有的child进行拆开成为一列\n \n+----------+--+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mychild  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------+--+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child3   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child4   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child5   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child6   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child7   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" child8   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------+--+\n\n将map的key和value也进行拆开，成为如下结果\n\n+-----------+-------------+--+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mymapkey  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mymapvalue  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------+-------------+--+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" k1        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" v1          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" k2        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" v2          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" k3        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" v3          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" k4        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" v4          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------+-------------+--+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h5",{attrs:{id:"第一步-创建hive数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一步-创建hive数据库"}},[s._v("#")]),s._v(" 第一步：创建hive数据库")]),s._v(" "),t("p",[s._v("创建hive数据库")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create database hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nhive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h5",{attrs:{id:"第二步-创建hive表-然后使用explode拆分map和array"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二步-创建hive表-然后使用explode拆分map和array"}},[s._v("#")]),s._v(" 第二步：创建hive表，然后使用explode拆分map和array")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create  table hive_explode.t3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name string,children array"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("string"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(",address Map"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("string,string"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),s._v(" delimited fields terminated by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\t'")]),s._v("  collection items    terminated by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v("  map keys terminated by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),s._v(" stored as textFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第三步-加载数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三步-加载数据"}},[s._v("#")]),s._v(" 第三步：加载数据")]),s._v(" "),t("p",[s._v("node03执行以下命令创建表数据文件")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v("  /kfly/install/hivedatas/\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" maparray\n数据内容格式如下\n\nzhangsan\tchild1,child2,child3,child4\tk1:v1,k2:v2\nlisi\tchild5,child6,child7,child8\tk3:v3,k4:v4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("hive表当中加载数据")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" load data "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" inpath "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/kfly/install/hivedatas/maparray'")]),s._v(" into table hive_explode.t3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第四步-使用explode将hive当中数据拆开"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第四步-使用explode将hive当中数据拆开"}},[s._v("#")]),s._v(" 第四步：使用explode将hive当中数据拆开")]),s._v(" "),t("p",[s._v("将array当中的数据拆分开")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" AS myChild FROM hive_explode.t3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将map当中的数据拆分开")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SELECT explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("address"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" AS "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("myMapKey, myMapValue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM hive_explode.t3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_2、使用explode拆分json字符串"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用explode拆分json字符串"}},[s._v("#")]),s._v(" 2、使用explode拆分json字符串")]),s._v(" "),t("p",[s._v("需求：现在有一些数据格式如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a:shandong,b:beijing,c:hebei"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3,4,5,6,7,8,9"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7fresh"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monthSales"')]),s._v(":4900,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userCount"')]),s._v(":1900,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.9"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jd"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monthSales"')]),s._v(":2090,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userCount"')]),s._v(":78981,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jdmart"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monthSales"')]),s._v(":6987,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userCount"')]),s._v(":1600,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其中字段与字段之间的分隔符是 |")]),s._v(" "),t("p",[s._v("我们要解析得到所有的monthSales对应的值为以下这一列（行转列）")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("4900\n2090\n6987\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h5",{attrs:{id:"第一步-创建hive表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一步-创建hive表"}},[s._v("#")]),s._v(" 第一步：创建hive表")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create table hive_explode.explode_lateral_view  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("area string, goods_id string, sale_info string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  ROW FORMAT DELIMITED FIELDS TERMINATED BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'|'")]),s._v(" STORED AS textfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第二步-准备数据并加载数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二步-准备数据并加载数据"}},[s._v("#")]),s._v(" 第二步：准备数据并加载数据")]),s._v(" "),t("p",[s._v("准备数据如下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /kfly/install/hivedatas\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" explode_json\n\na:shandong,b:beijing,c:hebei"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),s._v(",3,4,5,6,7,8,9"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7fresh"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monthSales"')]),s._v(":4900,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userCount"')]),s._v(":1900,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.9"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jd"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monthSales"')]),s._v(":2090,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userCount"')]),s._v(":78981,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jdmart"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monthSales"')]),s._v(":6987,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userCount"')]),s._v(":1600,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"score"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("加载数据到hive表当中去")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" load data "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" inpath "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/kfly/install/hivedatas/explode_json'")]),s._v(" overwrite into table hive_explode.explode_lateral_view"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第三步-使用explode拆分array"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三步-使用explode拆分array"}},[s._v("#")]),s._v(" 第三步：使用explode拆分Array")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("goods_id,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" as goods_id from hive_explode.explode_lateral_view"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第四步-使用explode拆解map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第四步-使用explode拆解map"}},[s._v("#")]),s._v(" 第四步：使用explode拆解Map")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("area,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" as area from hive_explode.explode_lateral_view"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第五步-拆解json字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第五步-拆解json字段"}},[s._v("#")]),s._v(" 第五步：拆解json字段")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)> select explode(split(regexp_replace(regexp_replace(sale_info,'\\\\[\\\\{',''),'}]',''),'},\\\\{')) as  sale_info from hive_explode.explode_lateral_view;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后我们想用get_json_object来获取key为monthSales的数据：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" get_json_object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("regexp_replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("regexp_replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sale_info,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\\\[\\\\{'")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'}]'")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'},\\\\{'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$.monthSales'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as  sale_info from hive_explode.explode_lateral_view"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n然后出现异常FAILED: SemanticException "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Error "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10081")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": UDTF"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s are not supported outside the SELECT clause, nor nested in expressions\nUDTF explode不能写在别的函数内\n如果你这么写，想查两个字段，select explode(split(area,'")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("')) as area,good_id from explode_lateral_view;\n会报错FAILED: SemanticException 1:40 Only a single expression in the SELECT clause is supported with UDTF'")]),s._v("s. Error encountered near token "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'good_id'")]),s._v("\n使用UDTF的时候，只支持一个字段，这时候就需要LATERAL VIEW出场了\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"_3、配合lateral-view使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、配合lateral-view使用"}},[s._v("#")]),s._v(" 3、配合LATERAL  VIEW使用")]),s._v(" "),t("p",[s._v("配合lateral view查询多个字段")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" goods_id2,sale_info from explode_lateral_view LATERAL VIEW explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("goods_id,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("goods as goods_id2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其中LATERAL VIEW explode(split(goods_id,','))goods相当于一个虚拟表，与原表explode_lateral_view笛卡尔积关联。")]),s._v(" "),t("p",[s._v("也可以多重使用")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" goods_id2,sale_info,area2 from explode_lateral_view  LATERAL VIEW explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("goods_id,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("goods as goods_id2 LATERAL VIEW explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("area,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("area as area2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("也是三个表笛卡尔积的结果")]),s._v(" "),t("p",[s._v("最终，我们可以通过下面的句子，把这个json格式的一行数据，完全转换成二维表的方式展现")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" get_json_object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("concat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{'")]),s._v(",sale_info_1,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'}'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$.source'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as source, get_json_object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("concat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{'")]),s._v(",sale_info_1,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'}'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$.monthSales'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as monthSales, get_json_object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("concat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{'")]),s._v(",sale_info_1,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'}'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$.userCount'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as monthSales,  get_json_object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("concat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{'")]),s._v(",sale_info_1,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'}'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$.score'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as monthSales from explode_lateral_view   LATERAL VIEW explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("regexp_replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("regexp_replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sale_info,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\\\[\\\\{'")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'}]'")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'},\\\\{'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("sale_info as sale_info_1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("总结：")]),s._v(" "),t("p",[s._v("Lateral View通常和UDTF一起出现，为了解决UDTF不允许在select字段的问题。\nMultiple Lateral View可以实现类似笛卡尔乘积。\nOuter关键字可以把不输出的UDTF的空结果，输出成NULL，防止丢失数据。")]),s._v(" "),t("h4",{attrs:{id:"_9、列转行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9、列转行"}},[s._v("#")]),s._v(" 9、列转行")]),s._v(" "),t("h4",{attrs:{id:"_1-相关函数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-相关函数说明"}},[s._v("#")]),s._v(" 1．相关函数说明")]),s._v(" "),t("p",[s._v("CONCAT(string A/col, string B/col…)：返回输入字符串连接后的结果，支持任意个输入字符串;")]),s._v(" "),t("p",[s._v("CONCAT_WS(separator, str1, str2,...)：它是一个特殊形式的 CONCAT()。第一个参数剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接的字符串之间;")]),s._v(" "),t("p",[s._v("COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重汇总，产生array类型字段。")]),s._v(" "),t("h4",{attrs:{id:"_2-数据准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-数据准备"}},[s._v("#")]),s._v(" 2．数据准备")]),s._v(" "),t("p",[s._v("表6-6 数据准备")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("name")]),s._v(" "),t("th",[s._v("constellation")]),s._v(" "),t("th",[s._v("blood_type")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("孙悟空")]),s._v(" "),t("td",[s._v("白羊座")]),s._v(" "),t("td",[s._v("A")])]),s._v(" "),t("tr",[t("td",[s._v("老王")]),s._v(" "),t("td",[s._v("射手座")]),s._v(" "),t("td",[s._v("A")])]),s._v(" "),t("tr",[t("td",[s._v("宋宋")]),s._v(" "),t("td",[s._v("白羊座")]),s._v(" "),t("td",[s._v("B")])]),s._v(" "),t("tr",[t("td",[s._v("猪八戒")]),s._v(" "),t("td",[s._v("白羊座")]),s._v(" "),t("td",[s._v("A")])]),s._v(" "),t("tr",[t("td",[s._v("冰冰")]),s._v(" "),t("td",[s._v("射手座")]),s._v(" "),t("td",[s._v("A")])])])]),s._v(" "),t("h4",{attrs:{id:"_3-需求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-需求"}},[s._v("#")]),s._v(" 3．需求")]),s._v(" "),t("p",[s._v("把星座和血型一样的人归类到一起。结果如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("射手座,A            老王"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("冰冰\n白羊座,A            孙悟空"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("猪八戒\n白羊座,B            宋宋\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"_4-创建本地constellation-txt-导入数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建本地constellation-txt-导入数据"}},[s._v("#")]),s._v(" 4．创建本地constellation.txt，导入数据")]),s._v(" "),t("p",[s._v("node03服务器执行以下命令创建文件，注意数据使用\\t进行分割")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kfly/install/hivedatas\nvim constellation.txt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("孙悟空\t白羊座\tA\n老王\t射手座\tA\n宋宋\t白羊座\tB       \n猪八戒\t白羊座\tA\n凤姐\t射手座\tA\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_5-创建hive表并导入数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-创建hive表并导入数据"}},[s._v("#")]),s._v(" 5．创建hive表并导入数据")]),s._v(" "),t("p",[s._v("创建hive表并加载数据")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("hive "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hive_explode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create table person_info"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("  name string,  constellation string,  blood_type string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  row "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),s._v(" delimited fields terminated by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("加载数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)> load data local inpath '/kfly/install/hivedatas/constellation.txt' into table person_info;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_6-按需求查询数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-按需求查询数据"}},[s._v("#")]),s._v(" 6．按需求查询数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("select t1.base, concat_ws('|', collect_set(t1.name)) name from    (select name, concat(constellation, \",\" , blood_type) base from person_info) t1 group by  t1.base;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_10、行转列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10、行转列"}},[s._v("#")]),s._v(" 10、行转列")]),s._v(" "),t("h4",{attrs:{id:"_1-函数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-函数说明"}},[s._v("#")]),s._v(" 1．函数说明")]),s._v(" "),t("p",[s._v("EXPLODE(col)：将hive一列中复杂的array或者map结构拆分成多行。")]),s._v(" "),t("p",[s._v("LATERAL VIEW")]),s._v(" "),t("p",[s._v("用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias")]),s._v(" "),t("p",[s._v("解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。")]),s._v(" "),t("h4",{attrs:{id:"_2-数据准备-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-数据准备-2"}},[s._v("#")]),s._v(" 2．数据准备")]),s._v(" "),t("p",[s._v("数据内容如下，字段之间都是使用\\t进行分割")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kfly/install/hivedatas\n\nvim movie.txt\n《疑犯追踪》\t悬疑,动作,科幻,剧情\n《Lie to me》\t悬疑,警匪,动作,心理,剧情\n《战狼2》\t战争,动作,灾难\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"_3-需求-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-需求-2"}},[s._v("#")]),s._v(" 3．需求")]),s._v(" "),t("p",[s._v("将电影分类中的数组数据展开。结果如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("《疑犯追踪》\t悬疑\n《疑犯追踪》\t动作\n《疑犯追踪》\t科幻\n《疑犯追踪》\t剧情\n《Lie to me》\t悬疑\n《Lie to me》\t警匪\n《Lie to me》\t动作\n《Lie to me》\t心理\n《Lie to me》\t剧情\n《战狼2》\t战争\n《战狼2》\t动作\n《战狼2》\t灾难\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h4",{attrs:{id:"_4-创建hive表并导入数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建hive表并导入数据"}},[s._v("#")]),s._v(" 4．创建hive表并导入数据")]),s._v(" "),t("p",[s._v("创建hive表")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('hive (hive_explode)> create table movie_info(movie string, category array<string>) row format delimited fields terminated by "\\t" collection items terminated by ",";\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("加载数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('load data local inpath "/kfly/install/hivedatas/movie.txt" into table movie_info;\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_5-按需求查询数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-按需求查询数据"}},[s._v("#")]),s._v(" 5．按需求查询数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)>  select movie, category_name  from  movie_info lateral view explode(category) table_tmp as category_name;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_11、reflect函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11、reflect函数"}},[s._v("#")]),s._v(" 11、reflect函数")]),s._v(" "),t("p",[s._v("reflect函数可以支持在sql中调用java中的自带函数，秒杀一切udf函数。")]),s._v(" "),t("h4",{attrs:{id:"使用java-lang-math当中的max求两列中最大值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用java-lang-math当中的max求两列中最大值"}},[s._v("#")]),s._v(" 使用java.lang.Math当中的Max求两列中最大值")]),s._v(" "),t("p",[s._v("创建hive表")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)>  create table test_udf(col1 int,col2 int) row format delimited fields terminated by ',';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("准备数据并加载数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kfly/install/hivedatas\n\nvim test_udf\n\n1,2\n4,3\n6,4\n7,5\n5,6\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("加载数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)> load data local inpath '/kfly/install/hivedatas/test_udf' overwrite into table test_udf;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用java.lang.Math当中的Max求两列当中的最大值")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('hive (hive_explode)> select reflect("java.lang.Math","max",col1,col2) from test_udf;\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"不同记录执行不同的java内置函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不同记录执行不同的java内置函数"}},[s._v("#")]),s._v(" 不同记录执行不同的java内置函数")]),s._v(" "),t("p",[s._v("创建hive表")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)> create table test_udf2(class_name string,method_name string,col1 int , col2 int) row format delimited fields terminated by ',';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("准备数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /export/servers/hivedatas\n\nvim test_udf2\n\njava.lang.Math,min,1,2\njava.lang.Math,max,2,3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("加载数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)> load data local inpath '/kfly/install/hivedatas/test_udf2' overwrite into table test_udf2;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("执行查询")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hive (hive_explode)> select reflect(class_name,method_name,col1,col2) from test_udf2;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"判断是否为数字"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#判断是否为数字"}},[s._v("#")]),s._v(" 判断是否为数字")]),s._v(" "),t("p",[s._v("使用apache commons中的函数，commons下的jar已经包含在hadoop的classpath中，所以可以直接使用。")]),s._v(" "),t("p",[s._v("使用方式如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('hive (hive_explode)> select reflect("org.apache.commons.lang.math.NumberUtils","isNumber","123");\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_12、hive当中的分析函数-分组求topn"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12、hive当中的分析函数-分组求topn"}},[s._v("#")]),s._v(" 12、hive当中的分析函数—分组求topN")]),s._v(" "),t("h4",{attrs:{id:"_1、分析函数的作用介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、分析函数的作用介绍"}},[s._v("#")]),s._v(" 1、分析函数的作用介绍")]),s._v(" "),t("p",[s._v("对于一些比较复杂的数据求取过程，我们可能就要用到分析函数，分析函数主要用于分组求topN，或者求取百分比，或者进行数据的切片等等，我们都可以使用分析函数来解决")]),s._v(" "),t("h4",{attrs:{id:"_2、常用的分析函数介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、常用的分析函数介绍"}},[s._v("#")]),s._v(" 2、常用的分析函数介绍")]),s._v(" "),t("p",[s._v("1、ROW_NUMBER()：")]),s._v(" "),t("p",[s._v("从1开始，按照顺序，生成分组内记录的序列,比如，按照pv降序排列，生成分组内每天的pv名次,ROW_NUMBER()的应用场景非常多，再比如，获取分组内排序第一的记录;获取一个session中的第一条refer等。")]),s._v(" "),t("p",[s._v("2、RANK() ：")]),s._v(" "),t("p",[s._v("生成数据项在分组中的排名，排名相等会在名次中留下空位")]),s._v(" "),t("p",[s._v("3、DENSE_RANK() ：")]),s._v(" "),t("p",[s._v("生成数据项在分组中的排名，排名相等会在名次中不会留下空位")]),s._v(" "),t("p",[s._v("4、CUME_DIST ：")]),s._v(" "),t("p",[s._v("小于等于当前值的行数/分组内总行数。比如，统计小于等于当前薪水的人数，所占总人数的比例")]),s._v(" "),t("p",[s._v("5、PERCENT_RANK ：")]),s._v(" "),t("p",[s._v("分组内当前行的RANK值/分组内总行数")]),s._v(" "),t("p",[s._v("6、NTILE(n) ：")]),s._v(" "),t("p",[s._v("用于将分组数据按照顺序切分成n片，返回当前切片值，如果切片不均匀，默认增加第一个切片的分布。NTILE不支持ROWS BETWEEN，比如 NTILE(2) OVER(PARTITION BY cookieid ORDER BY createtime ROWS BETWEEN 3 PRECEDING AND CURRENT ROW)。")]),s._v(" "),t("h4",{attrs:{id:"_3、需求描述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、需求描述"}},[s._v("#")]),s._v(" 3、需求描述")]),s._v(" "),t("p",[s._v("现有数据内容格式如下，分别对应三个字段，cookieid，createtime ，pv，求取每个cookie访问pv前三名的数据记录，其实就是分组求topN，求取每组当中的前三个值")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cookie1,2015-04-10,1\ncookie1,2015-04-11,5\ncookie1,2015-04-12,7\ncookie1,2015-04-13,3\ncookie1,2015-04-14,2\ncookie1,2015-04-15,4\ncookie1,2015-04-16,4\ncookie2,2015-04-10,2\ncookie2,2015-04-11,3\ncookie2,2015-04-12,5\ncookie2,2015-04-13,6\ncookie2,2015-04-14,3\ncookie2,2015-04-15,9\ncookie2,2015-04-16,7g\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h5",{attrs:{id:"第一步-创建数据库表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一步-创建数据库表"}},[s._v("#")]),s._v(" 第一步：创建数据库表")]),s._v(" "),t("p",[s._v("在hive当中创建数据库表")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CREATE EXTERNAL TABLE cookie_pv (\ncookieid string,\ncreatetime string, \npv INT\n) ROW FORMAT DELIMITED \nFIELDS TERMINATED BY ',' ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"第二步-准备数据并加载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二步-准备数据并加载"}},[s._v("#")]),s._v(" 第二步：准备数据并加载")]),s._v(" "),t("p",[s._v("node03执行以下命令，创建数据，并加载到hive表当中去")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kfly/install/hivedatas\nvim cookiepv.txt\n\ncookie1,2015-04-10,1\ncookie1,2015-04-11,5\ncookie1,2015-04-12,7\ncookie1,2015-04-13,3\ncookie1,2015-04-14,2\ncookie1,2015-04-15,4\ncookie1,2015-04-16,4\ncookie2,2015-04-10,2\ncookie2,2015-04-11,3\ncookie2,2015-04-12,5\ncookie2,2015-04-13,6\ncookie2,2015-04-14,3\ncookie2,2015-04-15,9\ncookie2,2015-04-16,7\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("加载数据到hive表当中去")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("load  data  local inpath '/kfly/install/hivedatas/cookiepv.txt'  overwrite into table  cookie_pv\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第三步-使用分析函数来求取每个cookie访问pv的前三条记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三步-使用分析函数来求取每个cookie访问pv的前三条记录"}},[s._v("#")]),s._v(" 第三步：使用分析函数来求取每个cookie访问PV的前三条记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT * FROM (\n\tSELECT \n  cookieid,\n  createtime,\n  pv,\n  RANK() OVER(PARTITION BY cookieid ORDER BY pv desc) AS rn1,\n  DENSE_RANK() OVER(PARTITION BY cookieid ORDER BY pv desc) AS rn2,\n  ROW_NUMBER() OVER(PARTITION BY cookieid ORDER BY pv DESC) AS rn3 \n  FROM cookie_pv) temp \nWHERE temp.rn1 <=  3 ;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"_13、hive自定义函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13、hive自定义函数"}},[s._v("#")]),s._v(" 13、hive自定义函数")]),s._v(" "),t("h4",{attrs:{id:"_1、自定义函数的基本介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、自定义函数的基本介绍"}},[s._v("#")]),s._v(" 1、自定义函数的基本介绍")]),s._v(" "),t("p",[s._v("1）Hive 自带了一些函数，比如：max/min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。")]),s._v(" "),t("p",[s._v("2）当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined function）。")]),s._v(" "),t("p",[s._v("3）根据用户自定义函数类别分为以下三种：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("    （1）UDF（User-Defined-Function）\n\n            一进一出\n\n    （2）UDAF（User-Defined Aggregation Function）\n\n            聚集函数，多进一出\n\n            类似于：count/max/min\n\n    （3）UDTF（User-Defined Table-Generating Functions）\n\n            一进多出\n\n            如lateral view explode()\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("4）官方文档地址")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://cwiki.apache.org/confluence/display/Hive/HivePlugins",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://cwiki.apache.org/confluence/display/Hive/HivePlugins"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("5）编程步骤：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("    （1）继承org.apache.hadoop.hive.ql.UDF\n\n    （2）需要实现evaluate函数；evaluate函数支持重载；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("6）注意事项")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("    （1）UDF必须要有返回类型，可以返回null，但是返回类型不能为void；\n\n    （2）UDF中常用Text/LongWritable等类型，不推荐使用java类型；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"_2、自定义函数开发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、自定义函数开发"}},[s._v("#")]),s._v(" 2、自定义函数开发")]),s._v(" "),t("h5",{attrs:{id:"第一步-创建maven-java-工程-并导入jar包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一步-创建maven-java-工程-并导入jar包"}},[s._v("#")]),s._v(" 第一步：创建maven java 工程，并导入jar包")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("repositories"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("cloudera"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("https://repository.cloudera.com/artifactory/cloudera-repos/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/repositories"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dependencies"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("org.apache.hadoop"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hadoop-common"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v(".0-cdh5.14."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v("<")]),s._v("/version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("org.apache.hive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hive-exec"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".0-cdh5.14."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v("<")]),s._v("/version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/dependencies"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("build"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("org.apache.maven.plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("maven-compiler-plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("/version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("configuration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("source"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v("<")]),s._v("/source"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v("<")]),s._v("/target"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("encoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("UTF-"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v("<")]),s._v("/encoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/configuration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("org.apache.maven.plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("maven-shade-plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v("<")]),s._v("/version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("executions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("execution"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("phase"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("package"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/phase"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("goals"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("goal"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("shade"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/goal"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/goals"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("configuration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("filters"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("filter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifact"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("*:*"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifact"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("excludes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("exclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("META-INF/*.SF"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/exclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("exclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("META-INF/*.DSA"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/exclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("exclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("META-INF/*/RSA"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/exclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/excludes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/filter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/filters"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/configuration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/execution"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/executions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/build"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br")])]),t("h5",{attrs:{id:"第二步-开发java类继承udf-并重载evaluate-方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二步-开发java类继承udf-并重载evaluate-方法"}},[s._v("#")]),s._v(" 第二步：开发java类继承UDF，并重载evaluate 方法")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("public class MyUDF extends UDF {\n     public Text evaluate(final Text s) {\n         if (null == s) {\n             return null;\n         }\n         //**返回大写字母         return new Text(s.toString().toUpperCase());\n     }\n }\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h5",{attrs:{id:"第三步-将我们的项目打包-并上传到hive的lib目录下"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三步-将我们的项目打包-并上传到hive的lib目录下"}},[s._v("#")]),s._v(" 第三步：将我们的项目打包，并上传到hive的lib目录下")]),s._v(" "),t("p",[s._v("使用maven的package进行打包，将我们打包好的jar包上传到node03服务器的/kfly/install/hive-1.1.0-cdh5.14.2/lib 这个路径下")]),s._v(" "),t("h5",{attrs:{id:"第四步-添加我们的jar包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第四步-添加我们的jar包"}},[s._v("#")]),s._v(" 第四步：添加我们的jar包")]),s._v(" "),t("p",[s._v("重命名我们的jar包名称")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kfly/install/hive-1.1.0-cdh5.14.2/lib\nmv original-day_hive_udf-1.0-SNAPSHOT.jar udf.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("hive的客户端添加我们的jar包")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("0: jdbc:hive2://node03:10000> add jar /kfly/install/hive-1.1.0-cdh5.14.2/lib/udf.jar;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第五步-设置函数与我们的自定义函数关联"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第五步-设置函数与我们的自定义函数关联"}},[s._v("#")]),s._v(" 第五步：设置函数与我们的自定义函数关联")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("0: jdbc:hive2://node03:10000> create temporary function tolowercase as 'com.kfly.udf.MyUDF';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"第六步-使用自定义函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第六步-使用自定义函数"}},[s._v("#")]),s._v(" 第六步：使用自定义函数")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("0: jdbc:hive2://node03:10000>select tolowercase('abc');\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("hive当中如何创建永久函数")]),s._v(" "),t("p",[s._v("在hive当中添加临时函数，需要我们每次进入hive客户端的时候都需要添加以下，退出hive客户端临时函数就会失效，那么我们也可以创建永久函数来让其不会失效")]),s._v(" "),t("p",[s._v("创建永久函数")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1、指定数据库，将我们的函数创建到指定的数据库下面\n0: jdbc:hive2://node03:10000>use myhive;\n\n2、使用add jar添加我们的jar包到hive当中来\n0: jdbc:hive2://node03:10000>add jar /kfly/install/hive-1.1.0-cdh5.14.2/lib/udf.jar;\n\n3、查看我们添加的所有的jar包\n0: jdbc:hive2://node03:10000>list  jars;\n\n4、创建永久函数，与我们的函数进行关联\n0: jdbc:hive2://node03:10000>create  function myuppercase as 'com.kfly.udf.MyUDF';\n\n5、查看我们的永久函数\n0: jdbc:hive2://node03:10000>show functions like 'my*';\n\n6、使用永久函数\n0: jdbc:hive2://node03:10000>select myhive.myuppercase('helloworld');\n\n7、删除永久函数\n0: jdbc:hive2://node03:10000>drop function myhive.myuppercase;\n\n8、查看函数\n show functions like 'my*';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h3",{attrs:{id:"_3-hive表的数据压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-hive表的数据压缩"}},[s._v("#")]),s._v(" 3. hive表的数据压缩")]),s._v(" "),t("h4",{attrs:{id:"_1、数据的压缩说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、数据的压缩说明"}},[s._v("#")]),s._v(" 1、数据的压缩说明")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("压缩模式评价")]),s._v(" "),t("ul",[t("li",[s._v("可使用以下三种标准对压缩方式进行评价\n"),t("ul",[t("li",[s._v("1、压缩比：压缩比越高，压缩后文件越小，所以压缩比越高越好")]),s._v(" "),t("li",[s._v("2、压缩时间：越快越好")]),s._v(" "),t("li",[s._v("3、已经压缩的格式文件是否可以再分割：可以分割的格式允许单一文件由多个Mapper程序处理，可以更好的并行化")])])])])]),s._v(" "),t("li",[t("p",[s._v("常见压缩格式\n| 压缩方式 | 压缩比 | 压缩速度 | 解压缩速度 | 是否可分割 |\n| --- | --- | --- | --- | --- |\n| gzip | 13.4% | 21 MB/s | 118 MB/s | 否 |\n| bzip2 | 13.2% | 2.4MB/s | 9.5MB/s | 是 |\n| lzo | 20.5% | 135 MB/s | 410 MB/s | 是 |\n| snappy | 22.2% | 172 MB/s | 409 MB/s | 否 |")])]),s._v(" "),t("li",[t("p",[s._v("Hadoop编码/解码器方式\n| 压缩格式 | 对应的编码/解码器 |\n| --- | --- |\n| DEFLATE | org.apache.hadoop.io.compress.DefaultCodec |\n| Gzip | org.apache.hadoop.io.compress.GzipCodec |\n| BZip2 | org.apache.hadoop.io.compress.BZip2Codec |\n| LZO | com.hadoop.compress.lzo.LzopCodec |\n| Snappy | org.apache.hadoop.io.compress.SnappyCodec |")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("压缩性能的比较\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",[s._v("压缩算法")]),s._v(" "),t("th",[s._v("原始文件大小")]),s._v(" "),t("th",[s._v("压缩文件大小")]),s._v(" "),t("th",[s._v("压缩速度")]),s._v(" "),t("th",[s._v("解压速度")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("gzip")]),s._v(" "),t("td",[s._v("8.3GB")]),s._v(" "),t("td",[s._v("1.8GB")]),s._v(" "),t("td",[s._v("17.5MB/s")]),s._v(" "),t("td",[s._v("58MB/s")])]),s._v(" "),t("tr",[t("td",[s._v("bzip2")]),s._v(" "),t("td",[s._v("8.3GB")]),s._v(" "),t("td",[s._v("1.1GB")]),s._v(" "),t("td",[s._v("2.4MB/s")]),s._v(" "),t("td",[s._v("9.5MB/s")])]),s._v(" "),t("tr",[t("td",[s._v("LZO")]),s._v(" "),t("td",[s._v("8.3GB")]),s._v(" "),t("td",[s._v("2.9GB")]),s._v(" "),t("td",[s._v("49.3MB/s")]),s._v(" "),t("td",[s._v("74.6MB/s")])])])]),s._v(" "),t("p",[t("a",{attrs:{href:"http://google.github.io/snappy/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://google.github.io/snappy/"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250 MB/sec or more and decompresses at about 500 MB/sec or more.")]),s._v(" "),t("h4",{attrs:{id:"_2、压缩配置参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、压缩配置参数"}},[s._v("#")]),s._v(" 2、压缩配置参数")]),s._v(" "),t("p",[s._v("要在Hadoop中启用压缩，可以配置如下参数（mapred-site.xml文件中）：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("参数")]),s._v(" "),t("th",[s._v("默认值")]),s._v(" "),t("th",[s._v("阶段")]),s._v(" "),t("th",[s._v("建议")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("io.compression.codecs      （在core-site.xml中配置）")]),s._v(" "),t("td",[s._v("org.apache.hadoop.io.compress.DefaultCodec,   org.apache.hadoop.io.compress.GzipCodec, org.apache.hadoop.io.compress.BZip2Codec,   org.apache.hadoop.io.compress.Lz4Codec")]),s._v(" "),t("td",[s._v("输入压缩")]),s._v(" "),t("td",[s._v("Hadoop使用文件扩展名判断是否支持某种编解码器")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.map.output.compress")]),s._v(" "),t("td",[s._v("false")]),s._v(" "),t("td",[s._v("mapper输出")]),s._v(" "),t("td",[s._v("这个参数设为true启用压缩")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.map.output.compress.codec")]),s._v(" "),t("td",[s._v("org.apache.hadoop.io.compress.DefaultCodec")]),s._v(" "),t("td",[s._v("mapper输出")]),s._v(" "),t("td",[s._v("使用LZO、LZ4或snappy编解码器在此阶段压缩数据")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.output.fileoutputformat.compress")]),s._v(" "),t("td",[s._v("false")]),s._v(" "),t("td",[s._v("reducer输出")]),s._v(" "),t("td",[s._v("这个参数设为true启用压缩")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.output.fileoutputformat.compress.codec")]),s._v(" "),t("td",[s._v("org.apache.hadoop.io.compress. DefaultCodec")]),s._v(" "),t("td",[s._v("reducer输出")]),s._v(" "),t("td",[s._v("使用标准工具或者编解码器，如gzip和bzip2")])]),s._v(" "),t("tr",[t("td",[s._v("mapreduce.output.fileoutputformat.compress.type")]),s._v(" "),t("td",[s._v("RECORD")]),s._v(" "),t("td",[s._v("reducer输出")]),s._v(" "),t("td",[s._v("SequenceFile输出使用的压缩类型：NONE和BLOCK")])])])]),s._v(" "),t("h4",{attrs:{id:"_3、开启map输出阶段压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、开启map输出阶段压缩"}},[s._v("#")]),s._v(" 3、开启Map输出阶段压缩")]),s._v(" "),t("p",[s._v("开启map输出阶段压缩可以减少job中map和Reduce task间数据传输量。具体配置如下：")]),s._v(" "),t("p",[t("strong",[s._v("案例实操：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1）开启hive中间传输数据压缩功能\nhive (default)>set hive.exec.compress.intermediate=true;\n\n2）开启mapreduce中map输出压缩功能\nhive (default)>set mapreduce.map.output.compress=true;\n\n3）设置mapreduce中map输出数据的压缩方式\nhive (default)>set mapreduce.map.output.compress.codec= org.apache.hadoop.io.compress.SnappyCodec;\n\n4）执行查询语句\n   select count(1) from score;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"_4、-开启reduce输出阶段压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、-开启reduce输出阶段压缩"}},[s._v("#")]),s._v(" 4、 开启Reduce输出阶段压缩")]),s._v(" "),t("p",[s._v("当Hive将输出写入到表中时，输出内容同样可以进行压缩。属性hive.exec.compress.output控制着这个功能。用户可能需要保持默认设置文件中的默认值false，这样默认的输出就是非压缩的纯文本文件了。用户可以通过在查询语句或执行脚本中设置这个值为true，来开启输出结果压缩功能。")]),s._v(" "),t("p",[t("strong",[s._v("案例实操：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1）开启hive最终输出数据压缩功能\nhive (default)>set hive.exec.compress.output=true;\n\n2）开启mapreduce最终输出数据压缩\nhive (default)>set mapreduce.output.fileoutputformat.compress=true;\n\n3）设置mapreduce最终数据输出压缩方式\nhive (default)> set mapreduce.output.fileoutputformat.compress.codec = org.apache.hadoop.io.compress.SnappyCodec;\n\n4）设置mapreduce最终数据输出压缩为块压缩\nhive (default)>set mapreduce.output.fileoutputformat.compress.type=BLOCK;\n\n5）测试一下输出结果是否是压缩文件\ninsert overwrite local directory '/kfly/install/hivedatas/snappy' select * from score distribute by s_id sort by s_id desc;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);