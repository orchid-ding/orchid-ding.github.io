(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{575:function(s,a,t){"use strict";t.r(a);var e=t(19),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-kylin的入门使用示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-kylin的入门使用示例"}},[s._v("#")]),s._v(" 1  kylin的入门使用示例")]),s._v(" "),t("p",[s._v("我们kylin环境安装成功之后，我们就可以在hive当中创建数据库以及数据库表，然后通过kylin来实现数据的查询")]),s._v(" "),t("h3",{attrs:{id:"_1-1-创建hive-数据库以及表并加载数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-创建hive-数据库以及表并加载数据"}},[s._v("#")]),s._v(" 1.1 创建hive 数据库以及表并加载数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# emp员工数据\n7369\tSMITH\tCLERK\t7902\t1980-12-17\t800.00\t\t20\n7499\tALLEN\tSALESMAN\t7698\t1981-2-20\t1600.00\t300.00\t30\n7521\tWARD\tSALESMAN\t7698\t1981-2-22\t1250.00\t500.00\t30\n7566\tJONES\tMANAGER\t7839\t1981-4-2\t2975.00\t\t20\n7654\tMARTIN\tSALESMAN\t7698\t1981-9-28\t1250.00\t1400.00\t30\n7698\tBLAKE\tMANAGER\t7839\t1981-5-1\t2850.00\t\t30\n7782\tCLARK\tMANAGER\t7839\t1981-6-9\t2450.00\t\t10\n7788\tSCOTT\tANALYST\t7566\t1987-4-19\t3000.00\t\t20\n7839\tKING\tPRESIDENT\t\t1981-11-17\t5000.00\t\t10\n7844\tTURNER\tSALESMAN\t7698\t1981-9-8\t1500.00\t0.00\t30\n7876\tADAMS\tCLERK\t7788\t1987-5-23\t1100.00\t\t20\n7900\tJAMES\tCLERK\t7698\t1981-12-3\t950.00\t\t30\n7902\tFORD\tANALYST\t7566\t1981-12-3\t3000.00\t\t20\n7934\tMILLER\tCLERK\t7782\t1982-1-23\t1300.00\t\t10\n\n\n# emp员工部门数据\n10\tACCOUNTING\t1700\n20\tRESEARCH\t1800\n30\tSALES\t1900\n40\tOPERATIONS\t1700\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("将以上两份文件上传到node03服务器的/kkb/install路径下，然后执行以下命令，创建hive数据库以及数据库表，并加载数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kkb/install/hive-1.1.0-cdh5.14.2/\nbin/beeline\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("创建数据库并使用该数据库")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("create database kylin_hive;\n\nuse kylin_hive;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"_1-1-1-创建部门表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-创建部门表"}},[s._v("#")]),s._v(" 1.1.1 创建部门表")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("create external table if not exists kylin_hive.dept(\ndeptno int,\ndname string,\nloc int )\nrow format delimited fields terminated by '\\t';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_1-1-2-创建员工表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-创建员工表"}},[s._v("#")]),s._v(" 1.1.2 创建员工表")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("create external table if not exists kylin_hive.emp(\nempno int,\nename string,\njob string,\nmgr int,\nhiredate string, \nsal double, \ncomm double,\ndeptno int)\nrow format delimited fields terminated by '\\t';\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h4",{attrs:{id:"_1-1-3-查看创建的表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-查看创建的表"}},[s._v("#")]),s._v(" 1.1.3 查看创建的表")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("jdbc:hive2://node03:10000> show tables;\nOK\ntab_name\ndept\nemp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"_1-1-4向外部表中导入数据导入数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4向外部表中导入数据导入数据"}},[s._v("#")]),s._v(" 1.1.4向外部表中导入数据导入数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("load data local inpath '/kkb/install/dept.txt' into table kylin_hive.dept;\n\nload data local inpath '/kkb/install/emp.txt' into table kylin_hive.emp;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"_1-1-5-查询结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-5-查询结果"}},[s._v("#")]),s._v(" 1.1.5 查询结果")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("jdbc:hive2://node03:10000> select * from emp;\n\njdbc:hive2://node03:10000> select * from dept;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_1-2-访问kylin-浏览器-界面-并创建project"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-访问kylin-浏览器-界面-并创建project"}},[s._v("#")]),s._v(" 1.2 访问kylin 浏览器 界面 ， 并创建project")]),s._v(" "),t("p",[s._v("直接在浏览器界面访问")]),s._v(" "),t("p",[s._v("http://node02:8066/kylin/login 并登录kylin，用户名 ADMIN，密码KYLIN")]),s._v(" "),t("h4",{attrs:{id:"_1-2-1-创建工程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-创建工程"}},[s._v("#")]),s._v(" 1.2.1 创建工程")]),s._v(" "),t("img",{staticStyle:{zoom:"150%"},attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251541306.png",alt:"image-20211125154109254"}}),s._v(" "),t("h4",{attrs:{id:"_1-2-2-输入工程名称以及工程描述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-输入工程名称以及工程描述"}},[s._v("#")]),s._v(" 1.2.2 输入工程名称以及工程描述")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251545724.png",alt:"image-20211125154511677"}})]),s._v(" "),t("h4",{attrs:{id:"_1-2-3-为工程添加数据源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-为工程添加数据源"}},[s._v("#")]),s._v(" 1.2.3 为工程添加数据源")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251545917.png",alt:"image-20211125154523957"}})]),s._v(" "),t("h4",{attrs:{id:"_1-2-4-添加数据源表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-添加数据源表"}},[s._v("#")]),s._v(" 1.2.4 添加数据源表")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251546772.png",alt:"image-20211125154603735"}})]),s._v(" "),t("h3",{attrs:{id:"_1-3-为kylin添加models"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-为kylin添加models"}},[s._v("#")]),s._v(" 1.3 为kylin添加models")]),s._v(" "),t("p",[s._v("1、回到models页面")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251547340.png",alt:"image-20211125154702298"}})]),s._v(" "),t("p",[s._v("2、添加new models")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251547851.png",alt:"image-20211125154710805"}})]),s._v(" "),t("p",[s._v("3、填写model name之后，继续下一步")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251547412.png",alt:"image-20211125154718382"}})]),s._v(" "),t("p",[s._v("4、选择事实表")]),s._v(" "),t("p",[s._v("这里就选择emp作为事实表")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251547078.png",alt:"image-20211125154736037"}})]),s._v(" "),t("p",[s._v("5、添加维度表")]),s._v(" "),t("p",[s._v("添加我们的DEPT作为维度表，并选择我们的join方式，以及join连接字段")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251558165.png",alt:"image-20211125155815114"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251558292.png",alt:"image-20211125155824251"}})]),s._v(" "),t("p",[s._v("6、选择聚合维度信息")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251558846.png",alt:"image-20211125155833802"}})]),s._v(" "),t("p",[s._v("7、选择度量信息")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251558620.png",alt:"image-20211125155839566"}})]),s._v(" "),t("p",[s._v("8、添加分区信息及过滤条件之后“Save”")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251558414.png",alt:"image-20211125155848369"}})]),s._v(" "),t("h3",{attrs:{id:"_1-4-通过kylin来构建cube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-通过kylin来构建cube"}},[s._v("#")]),s._v(" 1.4 通过kylin来构建cube")]),s._v(" "),t("p",[s._v("前面我们已经创建了project和我们的models，接下来我们就来构建我们的cube")]),s._v(" "),t("p",[s._v("1、页面添加，创建一个new  cube")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251559278.png",alt:"image-20211125155928229"}})]),s._v(" "),t("p",[s._v("2、选择我们的model以及cube name")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251559374.png",alt:"image-20211125155934317"}})]),s._v(" "),t("p",[s._v("3、添加我们的自定义维度")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251559012.png",alt:"image-20211125155938968"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251559730.png",alt:"image-20211125155947690"}})]),s._v(" "),t("p",[s._v("4、添加统计维度")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251559494.png",alt:"image-20211125155955451"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251600256.png",alt:"image-20211125160000213"}})]),s._v(" "),t("p",[s._v("5、设置多个分区cube合并信息")]),s._v(" "),t("p",[s._v("因为我们这里是全量统计，不涉及多个分区cube进行合并，所以不用设置历史多个cube进行合并")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251600940.png",alt:"image-20211125160007897"}})]),s._v(" "),t("p",[s._v("6、高级设置")]),s._v(" "),t("p",[s._v("高级设置我们这里暂时也不做任何设置，后续再单独详细讲解")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251600988.png",alt:"image-20211125160013932"}})]),s._v(" "),t("p",[s._v("7、额外的其他的配置属性，这里也暂时不做配置")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251600171.png",alt:"image-20211125160024111"}})]),s._v(" "),t("p",[s._v("8、完成，保存配置")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251600509.png",alt:"image-20211125160029468"}})]),s._v(" "),t("h3",{attrs:{id:"_1-5-构建-我们的cube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-构建-我们的cube"}},[s._v("#")]),s._v(" 1.5 构建 我们的cube")]),s._v(" "),t("p",[s._v("将我们的cube进行构建")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251600655.png",alt:"image-20211125160044616"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251600269.png",alt:"image-20211125160051226"}})]),s._v(" "),t("h3",{attrs:{id:"_1-6-对我们的数进行查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-对我们的数进行查询"}},[s._v("#")]),s._v(" 1.6 对我们的数进行查询")]),s._v(" "),t("p",[s._v("前面构建好了我们的cube之后，接下来我们就可以对我们的数据进行分析")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SELECT  DEPT.DNAME ,SUM(EMP.SAL) FROM EMP  INNER JOIN DEPT  ON DEPT.DEPTNO = EMP.DEPTNO  GROUP BY DEPT.DNAME\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251601512.png",alt:"image-20211125160127466"}})]),s._v(" "),t("p",[s._v("​\t\t我们会发现，数据的查询速度非常快，马上就可以产出结果了，通过kylin的与计算，已经将我们各种可能性的结果都获取到了，我们这里直接就可以得到我们计算完成的结果，所以结果非常快就能计算出来")]),s._v(" "),t("h2",{attrs:{id:"_2-kylin的构建流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-kylin的构建流程"}},[s._v("#")]),s._v(" 2 kylin的构建流程")]),s._v(" "),t("p",[s._v("双击下面图片，即可播放PPT浏览查看")]),s._v(" "),t("img",{staticStyle:{zoom:"150%"},attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251602861.png",alt:"img"}}),s._v(" "),t("h2",{attrs:{id:"_2-cube构建-算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-cube构建-算法"}},[s._v("#")]),s._v(" 2 cube构建 算法")]),s._v(" "),t("h3",{attrs:{id:"_3-1-逐层构建算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-逐层构建算法"}},[s._v("#")]),s._v(" 3.1 逐层构建算法")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251602977.png",alt:"image-20211125160244929"}})]),s._v(" "),t("p",[s._v("​\t\t我们知道，一个N维的Cube，是由1个N维子立方体、N个(N-1)维子立方体、N*(N-1)/2个(N-2)维子立方体、......、N个1维子立方体和1个0维子立方体构成，总共有2^N个子立方体组成，在逐层算法中，按维度数逐层减少来计算，每个层级的计算（除了第一层，它是从原始数据聚合而来），是基于它上一层级的结果来计算的。比如，[Group by A, B]的结果，可以基于[Group by A, B, C]的结果，通过去掉C后聚合得来的；这样可以减少重复计算；当 0维度Cuboid计算出来的时候，整个Cube的计算也就完成了。")]),s._v(" "),t("p",[s._v("​\t\t每一轮的计算都是一个MapReduce任务，且串行执行；一个N维的Cube，至少需要N次MapReduce Job。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251602466.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_3-1-1-算法优点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-算法优点"}},[s._v("#")]),s._v(" 3.1.1 "),t("strong",[s._v("算法优点：")])]),s._v(" "),t("p",[s._v("1）此算法充分利用了MapReduce的优点，处理了中间复杂的排序和shuffle工作，故而算法代码清晰简单，易于维护；")]),s._v(" "),t("p",[s._v("2）受益于Hadoop的日趋成熟，此算法非常稳定，即便是集群资源紧张时，也能保证最终能够完成。")]),s._v(" "),t("h4",{attrs:{id:"_3-1-2-算法缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-算法缺点"}},[s._v("#")]),s._v(" 3.1.2 "),t("strong",[s._v("算法缺点：")])]),s._v(" "),t("p",[s._v("1）当Cube有比较多维度的时候，所需要的MapReduce任务也相应增加；由于Hadoop的任务调度需要耗费额外资源，特别是集群较庞大的时候，反复递交任务造成的额外开销会相当可观；")]),s._v(" "),t("p",[s._v("2）由于Mapper逻辑中并未进行聚合操作，所以每轮MR的shuffle工作量都很大，导致效率低下。")]),s._v(" "),t("p",[s._v("3）对HDFS的读写操作较多：由于每一层计算的输出会用做下一层计算的输入，这些Key-Value需要写到HDFS上；当所有计算都完成后，Kylin还需要额外的一轮任务将这些文件转成HBase的HFile格式，以导入到HBase中去；")]),s._v(" "),t("p",[s._v("总体而言，该算法的效率较低，尤其是当Cube维度数较大的时候。")]),s._v(" "),t("h3",{attrs:{id:"_3-2、-快速构建算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、-快速构建算法"}},[s._v("#")]),s._v(" 3.2、 快速构建算法")]),s._v(" "),t("img",{staticStyle:{zoom:"150%"},attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251603862.png",alt:"image-20211125160349807"}}),s._v(" "),t("p",[s._v("​\t\t也被称作“逐段”(By Segment) 或“逐块”(By Split) 算法，从1.5.x开始引入该算法，该算法的主要思想是，每个Mapper将其所分配到的数据块，计算成一个完整的小Cube 段（包含所有Cuboid）。每个Mapper将计算完的Cube段输出给Reducer做合并，生成大Cube，也就是最终结果。如图所示解释了此流程。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251604968.png",alt:"img"}})]),s._v(" "),t("p",[s._v("与旧算法相比，快速算法主要有两点不同：")]),s._v(" "),t("p",[s._v("1） Mapper会利用内存做预聚合，算出所有组合；Mapper输出的每个Key都是不同的，这样会减少输出到Hadoop MapReduce的数据量，Combiner也不再需要；")]),s._v(" "),t("p",[s._v("2）一轮MapReduce便会完成所有层次的计算，减少Hadoop任务的调配。")]),s._v(" "),t("h2",{attrs:{id:"_4-cube构建的优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-cube构建的优化"}},[s._v("#")]),s._v(" 4 cube构建的优化")]),s._v(" "),t("p",[s._v("​\t\t从之前章节的介绍可以知道，在没有采取任何优化措施的情况下，Kylin会对每一种维度的组合进行预计算，每种维度的组合的预计算结果被称为Cuboid。假设有4个维度，我们最终会有24 =16个Cuboid需要计算。")]),s._v(" "),t("p",[s._v("​\t\t但在现实情况中，用户的维度数量一般远远大于4个。假设用户有10 个维度，那么没有经过任何优化的Cube就会存在210 =1024个Cuboid；而如果用户有20个维度，那么Cube中总共会存在220 =1048576个Cuboid。虽然每个Cuboid的大小存在很大的差异，但是单单想到Cuboid的数量就足以让人想象到这样的Cube对构建引擎、存储引擎来说压力有多么巨大。因此，在构建维度数量较多的Cube时，尤其要注意Cube的剪枝优化（即减少Cuboid的生成）。")]),s._v(" "),t("h3",{attrs:{id:"_4-1-使用衍生维度-derived-dimension"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-使用衍生维度-derived-dimension"}},[s._v("#")]),s._v(" 4.1  使用衍生维度（derived  dimension）")]),s._v(" "),t("p",[s._v("衍生维度用于在有效维度内将维度表上的非主键维度排除掉，并使用维度表的主键（其实是事实表上相应的外键）来替代它们。Kylin会在底层记录维度表主键与维度表其他维度之间的映射关系，以便在查询时能够动态地将维度表的主键“翻译”成这些非主键维度，并进行实时聚合。")]),s._v(" "),t("img",{staticStyle:{zoom:"150%"},attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251604597.png",alt:"img"}}),s._v(" "),t("p",[s._v("虽然衍生维度具有非常大的吸引力，但这也并不是说所有维度表上的维度都得变成衍生维度，如果从维度表主键到某个维度表维度所需要的聚合工作量非常大，则不建议使用衍生维度。")]),s._v(" "),t("h3",{attrs:{id:"_4-2-使用聚合组-aggregation-group"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-使用聚合组-aggregation-group"}},[s._v("#")]),s._v(" 4.2  使用聚合组（Aggregation  group）")]),s._v(" "),t("p",[s._v("​\t\t聚合组（Aggregation Group）是一种强大的剪枝工具。聚合组假设一个Cube的所有维度均可以根据业务需求划分成若干组（当然也可以是一个组），由于同一个组内的维度更可能同时被同一个查询用到，因此会表现出更加紧密的内在关联。每个分组的维度集合均是Cube所有维度的一个子集，不同的分组各自拥有一套维度集合，它们可能与其他分组有相同的维度，也可能没有相同的维度。每个分组各自独立地根据自身的规则贡献出一批需要被物化的Cuboid，所有分组贡献的Cuboid的并集就成为了当前Cube中所有需要物化的Cuboid的集合。不同的分组有可能会贡献出相同的Cuboid，构建引擎会察觉到这点，并且保证每一个Cuboid无论在多少个分组中出现，它都只会被物化一次。")]),s._v(" "),t("p",[s._v("​\t\t对于每个分组内部的维度，用户可以使用如下三种可选的方式定义，它们之间的关系，具体如下。")]),s._v(" "),t("h4",{attrs:{id:"_4-2-1-强制维度-mandatory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-强制维度-mandatory"}},[s._v("#")]),s._v(" 4.2.1 强制维度（Mandatory），")]),s._v(" "),t("p",[s._v("​\t\t如果一个维度被定义为强制维度，那么这个分组产生的所有Cuboid中每一个Cuboid都会包含该维度。每个分组中都可以有0个、1个或多个强制维度。如果根据这个分组的业务逻辑，则相关的查询一定会在过滤条件或分组条件中，因此可以在该分组中把该维度设置为强制维度。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251605568.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_4-2-2-层级维度-hierarchy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-层级维度-hierarchy"}},[s._v("#")]),s._v(" 4.2.2 层级维度（Hierarchy）")]),s._v(" "),t("p",[s._v("​\t\t每个层级包含两个或更多个维度。假设一个层级中包含D1，D2…Dn这n个维度，那么在该分组产生的任何Cuboid中， 这n个维度只会以（），（D1），（D1，D2）…（D1，D2…Dn）这n+1种形式中的一种出现。每个分组中可以有0个、1个或多个层级，不同的层级之间不应当有共享的维度。如果根据这个分组的业务逻辑，则多个维度直接存在层级关系，因此可以在该分组中把这些维度设置为层级维度。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251605030.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_4-2-3-联合维度-joint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-联合维度-joint"}},[s._v("#")]),s._v(" 4.2.3 联合维度（Joint）")]),s._v(" "),t("p",[s._v("​\t\t每个联合中包含两个或更多个维度，如果某些列形成一个联合，那么在该分组产生的任何Cuboid中，这些联合维度要么一起出现，要么都不出现。每个分组中可以有0个或多个联合，但是不同的联合之间不应当有共享的维度（否则它们可以合并成一个联合）。如果根据这个分组的业务逻辑，多个维度在查询中总是同时出现，则可以在该分组中把这些维度设置为联合维度。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251605426.png",alt:"img"}})]),s._v(" "),t("p",[s._v("这些操作可以在Cube Designer的Advanced Setting中的Aggregation Groups区域完成，如下图所示。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251611668.png",alt:""}})]),s._v(" "),t("p",[s._v("​\t\t聚合组的设计非常灵活，甚至可以用来描述一些极端的设计。假设我们的业务需求非常单一，只需要某些特定的Cuboid，那么可以创建多个聚合组，每个聚合组代表一个Cuboid。具体的方法是在聚合组中先包含某个Cuboid所需的所有维度，然后把这些维度都设置为强制维度。这样当前的聚合组就只能产生我们想要的那一个Cuboid了。")]),s._v(" "),t("p",[s._v("​\t\t再比如，有的时候我们的Cube中有一些基数非常大的维度，如果不做特殊处理，它就会和其他的维度进行各种组合，从而产生一大堆包含它的Cuboid。包含高基数维度的Cuboid在行数和体积上往往非常庞大，这会导致整个Cube的膨胀率变大。如果根据业务需求知道这个高基数的维度只会与若干个维度（而不是所有维度）同时被查询到，那么就可以通过聚合组对这个高基数维度做一定的“隔离”。我们把这个高基数的维度放入一个单独的聚合组，再把所有可能会与这个高基数维度一起被查询到的其他维度也放进来。这样，这个高基数的维度就被“隔离”在一个聚合组中了，所有不会与它一起被查询到的维度都没有和它一起出现在任何一个分组中，因此也就不会有多余的Cuboid产生。这点也大大减少了包含该高基数维度的Cuboid的数量，可以有效地控制Cube的膨胀率。")]),s._v(" "),t("h3",{attrs:{id:"_4-3-并发粒度优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-并发粒度优化"}},[s._v("#")]),s._v(" 4.3  并发粒度优化")]),s._v(" "),t("p",[s._v("​\t\t当Segment中某一个Cuboid的大小超出一定的阈值时，系统会将该Cuboid的数据分片到多个分区中，以实现Cuboid数据读取的并行化，从而优化Cube的查询速度。具体的实现方式如下：构建引擎根据Segment估计的大小，以及参数“kylin.hbase.region.cut”的设置决定Segment在存储引擎中总共需要几个分区来存储，如果存储引擎是HBase，那么分区的数量就对应于HBase中的Region数量。kylin.hbase.region.cut的默认值是5.0，单位是GB，也就是说对于一个大小估计是50GB的Segment，构建引擎会给它分配10个分区。用户还可以通过设置kylin.hbase.region.count.min（默认为1）和kylin.hbase.region.count.max（默认为500）两个配置来决定每个Segment最少或最多被划分成多少个分区。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251612762.png",alt:"image-20211125161210720"}})]),s._v(" "),t("p",[s._v("​\t\t由于每个Cube的并发粒度控制不尽相同，因此建议在Cube Designer 的Configuration Overwrites（上图所示）中为每个Cube量身定制控制并发粒度的参数。假设将把当前Cube的kylin.hbase.region.count.min设置为2，kylin.hbase.region.count.max设置为100。这样无论Segment的大小如何变化，它的分区数量最小都不会低于2，最大都不会超过100。相应地，这个Segment背后的存储引擎（HBase）为了存储这个Segment，也不会使用小于两个或超过100个的分区。我们还调整了默认的kylin.hbase.region.cut，这样50GB的Segment基本上会被分配到50个分区，相比默认设置，我们的Cuboid可能最多会获得5倍的并发量。")]),s._v(" "),t("h3",{attrs:{id:"_4-4-row-key优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-row-key优化"}},[s._v("#")]),s._v(" 4.4  Row  Key优化")]),s._v(" "),t("p",[s._v("​\t\tKylin会把所有的维度按照顺序组合成一个完整的Rowkey，并且按照这个Rowkey升序排列Cuboid中所有的行。")]),s._v(" "),t("p",[s._v("设计良好的Rowkey将更有效地完成数据的查询过滤和定位，减少IO次数，提高查询速度，维度在rowkey中的次序，对查询性能有显著的影响。")]),s._v(" "),t("p",[t("strong",[s._v("Row key")]),s._v("的设计原则如下：")]),s._v(" "),t("h4",{attrs:{id:"_4-4-1-被用作where过滤的维度放在前边"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-被用作where过滤的维度放在前边"}},[s._v("#")]),s._v(" 4.4.1 被用作where过滤的维度放在前边")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251612996.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_4-4-2-基数大的维度放在基数小的维度前边。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-基数大的维度放在基数小的维度前边。"}},[s._v("#")]),s._v(" 4.4.2 "),t("strong",[s._v("基数大的维度放在基数小的维度前边。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251615195.png",alt:"img"}})]),s._v(" "),t("h3",{attrs:{id:"_4-5、-增量cube构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5、-增量cube构建"}},[s._v("#")]),s._v(" 4.5、 增量cube构建")]),s._v(" "),t("p",[s._v("我们前面可以构建全量cube，也可以实现增量cube的构建，就是通过分区表的分区时间字段来进行怎量构建")]),s._v(" "),t("h4",{attrs:{id:"_4-5-1-更改model"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-1-更改model"}},[s._v("#")]),s._v(" 4.5.1 更改model")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251616282.png",alt:"image-20211125161539951"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251615237.png",alt:"image-20211125161552195"}})]),s._v(" "),t("h4",{attrs:{id:"_4-5-2-更改cube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-2-更改cube"}},[s._v("#")]),s._v(" 4.5.2  更改cube")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251617834.png",alt:"image-20211125161704601"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251617009.png",alt:"image-20211125161710965"}})]),s._v(" "),t("h2",{attrs:{id:"_5-备份以及-恢复kylin的-元-数据信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-备份以及-恢复kylin的-元-数据信息"}},[s._v("#")]),s._v(" 5 备份以及 恢复kylin的 元 数据信息")]),s._v(" "),t("p",[s._v("​\t\tKylin组织它所有的元数据(包括cube descriptions and instances, projects, inverted index description and instances,jobs, tables and dictionaries)作为一个层次的文件系统。")]),s._v(" "),t("p",[s._v("​\t\t然而，Kylin使用HBase来进行存储，而不是普通的文件系统。")]),s._v(" "),t("p",[s._v("​\t\t我们可以从Kylin的配置文件kylin.properties中查看到：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("## The metadata store in hbase\nkylin.metadata.url=kylin_metadata@hbase\n表示Kylin的元数据被保存在HBase的kylin_metadata表中。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("Kylin自身提供了元数据的备份程序，我们可以执行程序看一下帮助信息：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/metastore.sh\nusage: metastore.sh backup\nmetastore.sh fetch DATA\nmetastore.sh reset\nmetastore.sh refresh-cube-signature\nmetastore.sh restore PATH_TO_LOCAL_META\nmetastore.sh list RESOURCE_PATH\nmetastore.sh cat RESOURCE_PATH\nmetastore.sh remove RESOURCE_PATH\nmetastore.sh clean [--delete true]\n\n备份元数据\nbin/metastore.sh backup\n\n恢复元数据\nbin/metastore.sh reset\n\n接着，上传备份的元数据到Kylin的元数据中\n\nbin/metastore.sh restore $KYLIN_HOME/meta_backups/meta_xxxx_xx_xx_xx_xx_xx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("等待操作成功，用户在页面点击Reload Metadata按钮对元数据缓存进行刷新，即可看到最新的元数据")]),s._v(" "),t("h2",{attrs:{id:"_6-kylin的垃圾清理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-kylin的垃圾清理"}},[s._v("#")]),s._v(" 6  kylin的垃圾清理")]),s._v(" "),t("p",[s._v("​\t\t当kylin运行一段时间后，有很多数据因为不在使用就变成了垃圾数据，这些数据占据着HDFS HBase等资源，当积累到一定程度会对集群性能产生影响。")]),s._v(" "),t("p",[s._v("清理元数据")]),s._v(" "),t("p",[s._v("清理元数据指从kylin元数据中清理掉无用的资源。比如字典表的快照变得无用了。")]),s._v(" "),t("p",[s._v("步骤：")]),s._v(" "),t("ul",[t("li",[t("ol",[t("li",[s._v("检查哪些资源可以清理，这一步不会删除任何东西：")])])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/metastore.sh clean\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这会列出所有可以被清理的资源供用户核对，并不会实际上进行删除。")]),s._v(" "),t("p",[s._v("在上述命令中 添加 --delete true .这样就会清理掉晚一点资源，注意操作前最好备份一下元数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bin/metastore.sh clean --delete true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("清理存储器数据")]),s._v(" "),t("ul",[t("li",[t("ol",{attrs:{start:"2"}},[t("li",[s._v("检查哪些资源需要被清理，这个操作不会删除任何内容：")])])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("${KYLIN_HOME}/bin/kylin.sh org.apache.kylin.storage.hbase.util.StorageCleanupJob --delete\nfalse\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[t("ol",{attrs:{start:"3"}},[t("li",[s._v("根据上面的输出结果，挑选一两个资源看看是否是不再需要的。接着，在上面的命令基础上添加“–")])])])]),s._v(" "),t("p",[s._v("delete true”选项，开始执行清理操作，命令执行完成后，中间的HDFS文件和HTables表就被删除了。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("${KYLIN_HOME}/bin/kylin.sh org.apache.kylin.storage.hbase.util.StorageCleanupJob --delete\ntrue\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_7-bi工具集成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-bi工具集成"}},[s._v("#")]),s._v(" 7  BI工具集成")]),s._v(" "),t("p",[s._v("http://kylin.apache.org/cn/docs/howto/howto_use_restapi.html")]),s._v(" "),t("p",[s._v("官方文档使用说明")]),s._v(" "),t("p",[s._v("可以与Kylin结合使用的可视化工具很多，例如：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("ODBC：与Tableau、Excel、PowerBI等工具集成")])]),s._v(" "),t("li",[t("p",[s._v("JDBC：与Saiku、BIRT等Java工具集成")])]),s._v(" "),t("li",[t("p",[s._v("RestAPI：与JavaScript、Web网页集成")])])]),s._v(" "),t("p",[s._v("Kylin开发团队还贡献了Zepplin的插件，也可以使用Zepplin来访问Kylin服务。")]),s._v(" "),t("h3",{attrs:{id:"_7-1-jdbc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-jdbc"}},[s._v("#")]),s._v(" 7.1  JDBC")]),s._v(" "),t("p",[s._v("1）新建项目并导入依赖")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<dependencies>\n    <dependency>\n        <groupId>org.apache.kylin</groupId>\n        <artifactId>kylin-jdbc</artifactId>\n        <version>2.5.1</version>\n    </dependency>\n</dependencies>\n<build>\n    <plugins>\n        \x3c!-- 限制jdk版本插件 --\x3e\n        <plugin>\n            <groupId>org.apache.maven.plugins</groupId>\n            <artifactId>maven-compiler-plugin</artifactId>\n            <version>3.0</version>\n            <configuration>\n                <source>1.8</source>\n                <target>1.8</target>\n                <encoding>UTF-8</encoding>\n            </configuration>\n        </plugin>\n    </plugins>\n</build>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("2）编码")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('package com.kkb.kylin;\n\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\n\npublic class KylinJdbc {\n    public static void main(String[] args) throws Exception {\n\n        //Kylin_JDBC 驱动\n        String KYLIN_DRIVER = "org.apache.kylin.jdbc.Driver";\n\n        //Kylin_URL\n        String KYLIN_URL = "jdbc:kylin://node02:8066/kylin_hive";\n\n        //Kylin的用户名\n        String KYLIN_USER = "ADMIN";\n\n        //Kylin的密码\n        String KYLIN_PASSWD = "KYLIN";\n\n        //添加驱动信息\n        Class.forName(KYLIN_DRIVER);\n\n        //获取连接\n        Connection connection = DriverManager.getConnection(KYLIN_URL, KYLIN_USER, KYLIN_PASSWD);\n\n        //预编译SQL\n        PreparedStatement ps = connection.prepareStatement("SELECT sum(sal) FROM emp group by deptno");\n\n        //执行查询\n        ResultSet resultSet = ps.executeQuery();\n\n        //遍历打印\n        while (resultSet.next()) {\n            System.out.println(resultSet.getInt(1));\n        }\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("3）结果展示")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111251620883.png",alt:"image-20211125162040826"}})]),s._v(" "),t("h2",{attrs:{id:"_8-使用-kylin来分析我们-h-base当-中-的数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-使用-kylin来分析我们-h-base当-中-的数据"}},[s._v("#")]),s._v(" 8  使用 kylin来分析我们 H base当 中 的数据")]),s._v(" "),t("p",[s._v("​\t\t前面我们已经通过flink将数据介入到了hbase当中去了，那么我们接下来就可以通过hive整合hbase，将hbase当中的数据映射到hive表当中来，然后通过kylin来对hive当中的数据进行预分析，实现实时数仓的统计功能")]),s._v(" "),t("h3",{attrs:{id:"_8-1-拷贝-hbase的五个jar包到hive-的-lib目录下"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-拷贝-hbase的五个jar包到hive-的-lib目录下"}},[s._v("#")]),s._v(" 8.1  拷贝 hbase的五个jar包到hive 的 lib目录下")]),s._v(" "),t("p",[s._v("将我们HBase的五个jar包拷贝到hive的lib目录下")]),s._v(" "),t("p",[s._v("hbase的jar包都在/kkb/install/hbase-1.2.0-cdh5.14.2/lib")]),s._v(" "),t("p",[s._v("我们需要拷贝五个jar包名字如下")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("hbase-client-1.2.0-cdh5.14.2.jar     \t \n\nhbase-hadoop2-compat-1.2.0-cdh5.14.2.jar \n\nhbase-hadoop-compat-1.2.0-cdh5.14.2.jar  \n\nhbase-it-1.2.0-cdh5.14.2.jar   \n\nhbase-server-1.2.0-cdh5.14.2.jar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("我们直接在node03执行以下命令，通过创建软连接的方式来进行jar包的依赖")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ln -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-client-1.2.0-cdh5.14.2.jar              /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-client-1.2.0-cdh5.14.2.jar             \nln -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-hadoop2-compat-1.2.0-cdh5.14.2.jar      /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-hadoop2-compat-1.2.0-cdh5.14.2.jar             \nln -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-hadoop-compat-1.2.0-cdh5.14.2.jar       /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-hadoop-compat-1.2.0-cdh5.14.2.jar            \nln -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-it-1.2.0-cdh5.14.2.jar     /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-it-1.2.0-cdh5.14.2.jar               \nln -s /kkb/install/hbase-1.2.0-cdh5.14.2/lib/hbase-server-1.2.0-cdh5.14.2.jar          /kkb/install/hive-1.1.0-cdh5.14.2/lib/hbase-server-1.2.0-cdh5.14.2.jar   \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_8-2-修改hive的配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-修改hive的配置文件"}},[s._v("#")]),s._v(" 8.2 修改hive的配置文件")]),s._v(" "),t("p",[s._v("编辑node03服务器上面的hive的配置文件hive-site.xml添加以下两行配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kkb/install/hive-1.1.0-cdh5.14.2/conf\nvim hive-site.xml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<property>\n                <name>hive.zookeeper.quorum</name>\n                <value>node01,node02,node03</value>\n        </property>\n\n         <property>\n                <name>hbase.zookeeper.quorum</name>\n                <value>node01,node02,node03</value>\n        </property>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_8-3-修改hive-env-sh-配置-文件添加以下配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-修改hive-env-sh-配置-文件添加以下配置"}},[s._v("#")]),s._v(" 8.3 修改hive-env.sh 配置 文件添加以下配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd /kkb/install/hive-1.1.0-cdh5.14.2/conf\nvim hive-env.sh\n\nexport HADOOP_HOME=/kkb/install/hadoop-2.6.0-cdh5.14.2\nexport HBASE_HOME=/kkb/install/hbase-1.2.0-cdh5.14.2/\nexport HIVE_CONF_DIR=/kkb/install/hive-1.1.0-cdh5.14.2/conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_8-4-创建hive-表-映射hbase当-中-的数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-创建hive-表-映射hbase当-中-的数据"}},[s._v("#")]),s._v(" 8.4 创建hive 表 ，映射hbase当 中 的数据")]),s._v(" "),t("p",[s._v("进入hive客户端，创建hive映射表，映射hbase当中的两张表数据")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('create database hive_hbase;\nuse hive_hbase;\nCREATE external TABLE hive_hbase.data_goods(goodsId int ,goodsName     string ,sellingPrice  string ,productPic    string ,productBrand  string ,productfbl    string ,productNum    string ,productUrl    string ,productFrom   string ,goodsStock    int  ,  appraiseNum   int) \nSTORED BY \'org.apache.hadoop.hive.hbase.HBaseStorageHandler\' WITH SERDEPROPERTIES \n("hbase.columns.mapping" = ":key,f1:goodsName    ,f1:sellingPrice ,f1:productPic   ,f1:productBrand ,f1:productfbl   ,f1:productNum   ,f1:productUrl   ,f1:productFrom  ,f1:goodsStock   ,    f1:appraiseNum") \nTBLPROPERTIES("hbase.table.name" ="flink:data_goods");\n\nCREATE external TABLE hive_hbase.data_orders(orderId int,orderNo string ,userId int,goodId int ,goodsMoney decimal(11,2) ,realTotalMoney  decimal(11,2) ,payFrom         int           ,province        string        ,createTime      timestamp ) \nSTORED BY \'org.apache.hadoop.hive.hbase.HBaseStorageHandler\' WITH SERDEPROPERTIES \n("hbase.columns.mapping" = ":key,  f1:orderNo ,  f1:userId        ,   f1:goodId        ,   f1:goodsMoney    ,f1:realTotalMoney,f1:payFrom       ,f1:province,f1:createTime") \nTBLPROPERTIES("hbase.table.name" ="flink:data_orders");\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_8-5-在kylin当中对我们hive的数据进行-多-维度分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-在kylin当中对我们hive的数据进行-多-维度分析"}},[s._v("#")]),s._v(" 8.5 在kylin当中对我们hive的数据进行 多 维度分析")]),s._v(" "),t("p",[s._v("直接登录kylin的管理界面，对hive当中的数据进行多维度分析")])])}),[],!1,null,null,null);a.default=n.exports}}]);