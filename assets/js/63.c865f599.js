(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{546:function(s,t,a){"use strict";a.r(t);var n=a(19),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("Apache Flink is a framework and distributed processing engine for stateful computations over "),a("em",[s._v("unbounded and bounded")]),s._v(" data streams")]),s._v(" "),a("ol",[a("li",[s._v("有界的流和无界的流")]),s._v(" "),a("li",[s._v("分布式的计算引擎")]),s._v(" "),a("li",[s._v("有状态（这个就是重点，也是难点，当然也是flink比较有特色的功能点）")])]),s._v(" "),a("h2",{attrs:{id:"_1-有状态的流和分布式计算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-有状态的流和分布式计算"}},[s._v("#")]),s._v(" 1 有状态的流和分布式计算")]),s._v(" "),a("h3",{attrs:{id:"_1-1-单词计数案例再次演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-单词计数案例再次演示"}},[s._v("#")]),s._v(" 1.1 单词计数案例再次演示")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 单词计数\n * 没有设置并行度\n * 默认电脑有几个cpu core就会有几个并行度\n */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WordCount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StreamExecutionEnvironment")]),s._v(" env "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StreamExecutionEnvironment")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createLocalEnvironmentWithWebUI")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DataStreamSource")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" dataStream "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("socketTextStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SingleOutputStreamOperator")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Tuple2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" wordOneStream "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dataStream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("flatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FlatMapFunction")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Tuple2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("flatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" line"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Collector")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Tuple2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" line"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("split")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" word "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" fields"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("collect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Tuple2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("word"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SingleOutputStreamOperator")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Tuple2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" wordOneStream\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("keyBy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WordCount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSimpleName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("访问地址8081端口")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<dependency>\n    <groupId>org.apache.flink</groupId>\n    <artifactId>flink-runtime-web_2.11</artifactId>\n    <version>${flink.version}</version>\n    \x3c!-- <scope>provided</scope>--\x3e\n</dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231534551.png",alt:"image-20191114232854448"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231534684.png",alt:"有状态的流"}})]),s._v(" "),a("p",[s._v("数据流")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231530480.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231535970.png",alt:"并行度"}})]),s._v(" "),a("p",[s._v("修改一下并行度为4")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231534908.png",alt:"image-20191115001027412"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"D:%5Cdocument%5Cflink%5C20200207_flink2_%E8%AF%BE%E4%BB%B6%5C20200207_flink2_%E8%AF%BE%E4%BB%B6%5C%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAFlink%E4%B9%8Btask.assets%5C%E8%AE%BE%E7%BD%AE%E5%B9%B6%E8%A1%8C%E5%BA%A6.png",alt:"设置并行度"}})]),s._v(" "),a("h3",{attrs:{id:"_1-2-并行度slot、task"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-并行度slot、task"}},[s._v("#")]),s._v(" 1.2  并行度Slot、Task")]),s._v(" "),a("p",[s._v("​\t\tFlink的每个TaskManager为集群提供solt。 solt的数量通常与每个TaskManager节点的可用CPU内核数成比例。一般情况下你的slot数是你每个节点的cpu的核数。")]),s._v(" "),a("p",[a("img",{attrs:{src:"D:%5Cdocument%5Cflink%5C20200207_flink2_%E8%AF%BE%E4%BB%B6%5C20200207_flink2_%E8%AF%BE%E4%BB%B6%5Cassets%5C1574472572814.png",alt:"1574472572814"}})]),s._v(" "),a("h3",{attrs:{id:"_1-3-并行度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-并行度"}},[s._v("#")]),s._v(" 1.3  并行度")]),s._v(" "),a("p",[s._v("​\t\t一个Flink程序由多个任务组成(source、transformation和 sink)。 一个任务由多个并行的实例(线程)来执行， 一个任务的并行实例(线程)数目就被称为该任务的并行度。")]),s._v(" "),a("h3",{attrs:{id:"_1-4-并行度的设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-并行度的设置"}},[s._v("#")]),s._v(" 1.4  并行度的设置")]),s._v(" "),a("p",[s._v("一个任务的并行度设置可以从多个层次指定")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Operator Level（算子层次）")])]),s._v(" "),a("li",[a("p",[s._v("Execution Environment Level（执行环境层次）")])]),s._v(" "),a("li",[a("p",[s._v("Client Level（客户端层次）")])]),s._v(" "),a("li",[a("p",[s._v("System Level（系统层次）")])])]),s._v(" "),a("h4",{attrs:{id:"_1-4-1-算子层次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-算子层次"}},[s._v("#")]),s._v(" 1.4.1 算子层次")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231537638.png",alt:"1574472860477"}})]),s._v(" "),a("h4",{attrs:{id:"_1-4-2-执行环境层次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-2-执行环境层次"}},[s._v("#")]),s._v(" 1.4.2 执行环境层次")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231537475.png",alt:"1574472880358"}})]),s._v(" "),a("h4",{attrs:{id:"_1-4-3-客户端层次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-3-客户端层次"}},[s._v("#")]),s._v(" 1.4.3 客户端层次")]),s._v(" "),a("p",[s._v("​\t\t并行度可以在客户端将job提交到Flink时设定，对于CLI客户端，可以通过-p参数指定并行度")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("./bin/flink run -p 10 WordCount.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_1-4-4-系统层次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-4-系统层次"}},[s._v("#")]),s._v(" 1.4.4 系统层次")]),s._v(" "),a("p",[s._v("​\t在系统级可以通过设置flink-conf.yaml文件中的parallelism.default属性来指定所有执行环境的默认并行度")]),s._v(" "),a("h2",{attrs:{id:"_2-任务提交-集群模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-任务提交-集群模式"}},[s._v("#")]),s._v(" 2  任务提交（集群模式）")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("模式")]),s._v(" "),a("th",[s._v("提交语句")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("StandAlnoe模式")]),s._v(" "),a("td",[s._v("flink run -c streaming.slot.lesson01.WordCount -p 2 flinklesson-1.0-SNAPSHOT.jar")])]),s._v(" "),a("tr",[a("td",[s._v("Flink on Yarn(1)")]),s._v(" "),a("td",[s._v("flink run -m yarn-cluster -p 2 -yn 2 -yjm 1024 -ytm 1024 -c streaming.slot.lesson01.WordCount flinklesson-1.0-SNAPSHOT.jar")])]),s._v(" "),a("tr",[a("td",[s._v("Flink on Yarn(2)")]),s._v(" "),a("td",[s._v("yarn-session.sh -n 2 -jm 1024 -tm 1024"),a("br"),s._v("flink run ./examples/batch/WordCount.jar -input hdfs://hadoop100:9000/LICENSE -output hdfs://hadoop100:9000/wordcount-result.txt")])])])]),s._v(" "),a("p",[s._v("standalone集群：")]),s._v(" "),a("p",[s._v("jobmanager：")]),s._v(" "),a("p",[s._v("​\t\t192.168.167.251")]),s._v(" "),a("p",[s._v("TaskManager")]),s._v(" "),a("p",[s._v("​\t\t192.168.167.251")]),s._v(" "),a("p",[s._v("​\t\t192.168.167.252")]),s._v(" "),a("h3",{attrs:{id:"_2-1-把任务提交到yarn上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-把任务提交到yarn上"}},[s._v("#")]),s._v(" 2.1  把任务提交到yarn上")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 演示一：\nflink run -m yarn-cluster -p 2 -yn 2 -yjm 1024 -ytm 1024 -c streaming.slot.lesson01.WordCount flinklesson-1.0-SNAPSHOT.jar\n\n# 演示二：\nflink run -m yarn-cluster -p 3 -yn 2 -yjm 1024 -ytm 1024 -c streaming.slot.lesson01.WordCount flinklesson-1.0-SNAPSHOT.jar\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_2-2-把任务提交到standalone集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-把任务提交到standalone集群"}},[s._v("#")]),s._v(" 2.2  把任务提交到standalone集群")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231538142.png",alt:"1574475633598"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("演示一：\nflink run -c streaming.slot.lesson01.WordCount -p 2 flinklesson-1.0-SNAPSHOT.jar\n演示二：\nflink run -c streaming.slot.lesson01.WordCount -p 3 flinklesson-1.0-SNAPSHOT.jar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_3-任务task"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-任务task"}},[s._v("#")]),s._v(" 3. 任务task")]),s._v(" "),a("h3",{attrs:{id:"_3-1-数据传输的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-数据传输的方式"}},[s._v("#")]),s._v(" 3.1  数据传输的方式")]),s._v(" "),a("h4",{attrs:{id:"_3-1-1-forward-strategy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-forward-strategy"}},[s._v("#")]),s._v(" 3.1.1 forward strategy")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231530297.png",alt:"1574478499283"}})]),s._v(" "),a("ol",[a("li",[s._v("一个 task 的输出只发送给一个 task 作为输入")]),s._v(" "),a("li",[s._v("如果两个 task 都在一个 JVM 中的话，那么就可以避免网络开销")])]),s._v(" "),a("h4",{attrs:{id:"_3-1-2-key-based-strategy-key-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-key-based-strategy-key-by"}},[s._v("#")]),s._v(" 3.1.2 key based strategy (key by)")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231530565.png",alt:"1574478613578"}})]),s._v(" "),a("ol",[a("li",[s._v("数据需要按照某个属性(我们称为 key)进行分组(或者说分区)")]),s._v(" "),a("li",[s._v("相同 key 的数据需要传输给同一个 task，在一个 task 中进行处理")])]),s._v(" "),a("h4",{attrs:{id:"_3-2-3-broadcast-strategy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-broadcast-strategy"}},[s._v("#")]),s._v(" 3.2.3 broadcast strategy")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231540797.png",alt:"1574478760221"}})]),s._v(" "),a("h4",{attrs:{id:"_3-2-4-random-strategy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-random-strategy"}},[s._v("#")]),s._v(" 3.2.4 random strategy")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231540747.png",alt:"1574478869374"}})]),s._v(" "),a("ol",[a("li",[s._v("数据随机的从一个 task 中传输给下一个 operator 所有的 subtask")]),s._v(" "),a("li",[s._v("保证数据能均匀的传输给所有的 subtask")])]),s._v(" "),a("h3",{attrs:{id:"_3-2-operator-chain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-operator-chain"}},[s._v("#")]),s._v(" 3.2  Operator Chain")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public class WordCount {\n    public static void main(String[] args) throws Exception {\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n        String topic="testSlot";\n        Properties consumerProperties = new Properties();\n        consumerProperties.setProperty("bootstrap.servers","192.168.167.254:9092");\n        consumerProperties.setProperty("group.id","testSlot_consumer");\n\n\n        FlinkKafkaConsumer011<String> myConsumer =\n                new FlinkKafkaConsumer011<>(topic, new SimpleStringSchema(), consumerProperties);\n\n        DataStreamSource<String> data = env.addSource(myConsumer).setParallelism(3);\n\n        SingleOutputStreamOperator<Tuple2<String, Integer>> wordOneStream = data.flatMap(new FlatMapFunction<String, Tuple2<String, Integer>>() {\n            @Override\n            public void flatMap(String line,\n                                Collector<Tuple2<String, Integer>> out) throws Exception {\n                String[] fields = line.split(",");\n                for (String word : fields) {\n                    out.collect(Tuple2.of(word, 1));\n                }\n            }\n        }).setParallelism(2);\n\n        SingleOutputStreamOperator<Tuple2<String, Integer>> result = wordOneStream.keyBy(0).sum(1).setParallelism(2);\n\n        result.map( tuple -> tuple.toString()).setParallelism(2)\n                .print().setParallelism(1);\n\n        env.execute("WordCount2");\n\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231530944.png",alt:"1574479305528"}}),s._v("****")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231540398.png",alt:"1574479086824"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231540572.png",alt:"1574479147372"}})]),s._v(" "),a("h4",{attrs:{id:"_3-2-1-operator-chain的条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-operator-chain的条件"}},[s._v("#")]),s._v(" 3.2.1 Operator Chain的条件：")]),s._v(" "),a("ol",[a("li",[s._v("数据传输策略是 forward strategy")]),s._v(" "),a("li",[s._v("在同一个 TaskManager 中运行")])]),s._v(" "),a("p",[s._v("并行度设置为1：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231530093.png",alt:"1574480303336"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231530489.png",alt:"1574480321456"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/202111231541818.png",alt:"image-20211123154148772"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);