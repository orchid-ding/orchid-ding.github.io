(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{499:function(s,a,t){"use strict";t.r(a);var n=t(19),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725305127-ac24dc3c-d3be-4cc5-ad3f-bee197388fe7.png",alt:"img"}})]),s._v(" "),t("p",[s._v("​\t\t在一个完整的离线大数据处理系统中，除了hdfs+mapreduce+hive组成分析系统的核心之外，还需要数据采集、结果数据导出、任务调度等不可或缺的辅助系统，而这些辅助工具在hadoop生态体系中都有便捷的开源框架。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Flume是Cloudera提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统")])]),s._v(" "),t("li",[t("p",[s._v("Flume支持在日志系统中定制各类数据发送方，用于收集数据；")])]),s._v(" "),t("li",[t("p",[s._v("Flume提供对数据进行简单处理，并写到各种数据接受方（可定制）的能力。")])])]),s._v(" "),t("p",[s._v("​\t\t重构后的版本统称为 Flume NG（next generation）；改动的另一原因是将 Flume 纳入 apache 旗下，cloudera Flume 改名为 Apache Flume。")]),s._v(" "),t("p",[s._v("官方网站： http://flume.apache.org/")]),s._v(" "),t("h2",{attrs:{id:"_1-框架结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-框架结构"}},[s._v("#")]),s._v(" 1. 框架结构")]),s._v(" "),t("p",[s._v("​\t\tFlume 的核心是把数据从数据源收集过来，再送到目的地。为了保证输送一定成功，在送到目的地之前，会先缓存数据，待数据真正到达目的地后，删除自己缓存的数据。")]),s._v(" "),t("p",[s._v("​\t\tFlume分布式系统中最核心的角色是agent，flume采集系统就是由一个个agent所连接起来形成。")]),s._v(" "),t("h3",{attrs:{id:"_1-1-flume构成组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-flume构成组件"}},[s._v("#")]),s._v(" 1.1 flume构成组件")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Client")]),s._v(" "),t("p",[s._v("​\tClient生产数据，运行在一个独立的线程。")])]),s._v(" "),t("li",[t("p",[s._v("Event")]),s._v(" "),t("p",[s._v("​\t一个数据单元，消息头和消息体组成。（Events可以是日志记录、 avro 对象等。）")])]),s._v(" "),t("li",[t("p",[s._v("Flow")]),s._v(" "),t("p",[s._v("​\tEvent从源点到达目的点的迁移的抽象。")])]),s._v(" "),t("li",[t("p",[s._v("Agent结构")]),s._v(" "),t("p",[s._v("​\tFlume 运行的核心是 Agent。Flume以agent为最小的独立运行单位。一个agent就是一个JVM。它是一个完整的数据收集工具，含有三个核心组件，分别是source、 channel、 sink。通过这些组件， Event 可以从一个地方流向另一个地方，如下图所示。")])]),s._v(" "),t("li",[t("p",[s._v("Source")]),s._v(" "),t("p",[s._v("​\tSource是数据的收集端，负责将数据捕获后进行特殊的格式化，将数据封装到事件（event） 里，然后将事件推入Channel中。 Flume提供了很多内置的Source， 支持 Avro， log4j， syslog 和 http post(body为json格式)。可以让应用程序同已有的Source直接打交道，如AvroSource，SyslogTcpSource。 如果内置的Source无法满足需要， Flume还支持自定义Source。")])]),s._v(" "),t("li",[t("p",[s._v("Channel")]),s._v(" "),t("p",[s._v("​\tChannel是连接Source和Sink的组件，大家可以将它看做一个数据的缓冲区（数据队列），它可以将事件暂存到内存中也可以持久化到本地磁盘上， 直到Sink处理完该事件。介绍两个较为常用的Channel， MemoryChannel和FileChannel。")])]),s._v(" "),t("li",[t("p",[s._v("Sink")]),s._v(" "),t("p",[s._v("​\tSink从Channel中取出事件，然后将数据发到别处，可以向文件系统、数据库、 hadoop存数据， 也可以是其他agent的Source。在日志数据较少时，可以将数据存储在文件系统中，并且设定一定的时间间隔保存数据。")])])]),s._v(" "),t("h3",{attrs:{id:"_1-2-系统结构图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-系统结构图"}},[s._v("#")]),s._v(" 1.2 系统结构图")]),s._v(" "),t("h4",{attrs:{id:"_1-2-1-单个agent采集数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-单个agent采集数据"}},[s._v("#")]),s._v(" 1.2.1 单个agent采集数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725305035-b407b013-e36d-45d2-84c0-04f5a1b8edc6.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_1-2-2-2个agent串联"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-2个agent串联"}},[s._v("#")]),s._v(" 1.2.2  2个agent串联")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304836-a8abc00b-ff5c-43c8-aaf3-8fee00a221eb.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_1-2-3-多个agent串联"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-多个agent串联"}},[s._v("#")]),s._v(" 1.2.3 多个agent串联")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304839-2ca37d3f-0661-4cb3-9d80-48a85e18f19a.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_1-2-4-多个channel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-多个channel"}},[s._v("#")]),s._v(" 1.2.4 多个channel")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304870-b771f3a4-80f2-4f79-859f-353192176331.png",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"_2-安装使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装使用"}},[s._v("#")]),s._v(" 2. 安装使用")]),s._v(" "),t("p",[s._v("下载：http://archive.cloudera.com/cdh5/cdh/5/flume-ng-1.6.0-cdh5.14.2.tar.gz")]),s._v(" "),t("ul",[t("li",[s._v("vim flume-env.sh，")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加java环境变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/kkb/install/jdk1.8.0_141\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_2-1-采集文件到控制台"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-采集文件到控制台"}},[s._v("#")]),s._v(" 2.1 采集文件到控制台")]),s._v(" "),t("ul",[t("li",[s._v("vim tail-memory-logger.conf")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义一个agent，分别指定source、channel、sink别名")]),s._v("\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定source的类型为exec，通过Unix命令来传输结果数据")]),s._v("\na1.sources.r1.type = exec\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监控一个文件，有新的数据产生就不断采集走")]),s._v("\na1.sources.r1.command = tail "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("F /kfly/install/flumeData/tail.log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定source的数据流入的channel中")]),s._v("\na1.sources.r1.channels = c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定channel的类型为memory")]),s._v("\na1.channels.c1.type = memory\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定channel的最多可以存放数据的容量")]),s._v("\na1.channels.c1.capacity = 1000\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定在一个事务中source写数据到channel或者sink从channel取数据最大条数")]),s._v("\na1.channels.c1.transactionCapacity = 100\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置sink")]),s._v("\na1.sinks.k1.channel = c1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#类型是日志格式，结果会打印在控制台")]),s._v("\na1.sinks.k1.type = logger\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("ul",[t("li",[s._v("启动agent")])]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("其中：\n-n表示指定该agent名称\n-c表示配置文件所在的目录\n-f表示配置文件的路径名称\n-D表示指定key=value键值对---这里指定的是启动的日志输出级别\n\nbin/flume-ng agent -n a1 -c myconf -f myconf/tail-memory-logger.conf -Dflume.root.logger=info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"_2-2-采集文件到hdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-采集文件到hdfs"}},[s._v("#")]),s._v(" 2.2 采集文件到HDFS")]),s._v(" "),t("ul",[t("li",[s._v("vim file2Hdfs.conf")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置source")]),s._v("\na1.sources.r1.type = exec\na1.sources.r1.command = tail "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("F /kfly/install/flumeData/tail.log\na1.sources.r1.channels = c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置channel")]),s._v("\na1.channels.c1.type = file\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置检查点目录--该目录是记录下event在数据目录下的位置")]),s._v("\na1.channels.c1.checkpointDir=/kfly/data/flume_checkpoint\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据存储所在的目录")]),s._v("\na1.channels.c1.dataDirs=/kfly/data/flume_data\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置sink")]),s._v("\na1.sinks.k1.channel = c1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定sink类型为hdfs")]),s._v("\na1.sinks.k1.type = hdfs\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定数据收集到hdfs目录")]),s._v("\na1.sinks.k1.hdfs.path = hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//node01"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8020/tailFile/%Y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("%d/%H%M\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定生成文件名的前缀")]),s._v("\na1.sinks.k1.hdfs.filePrefix = events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否启用时间上的”舍弃”   --\x3e控制目录 ")]),s._v("\na1.sinks.k1.hdfs.round = true\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#时间上进行“舍弃”的值")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如 12:10 -- 12:19 => 12:10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如 12:20 -- 12:29 => 12:20")]),s._v("\na1.sinks.k1.hdfs.roundValue = 10\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#时间上进行“舍弃”的单位")]),s._v("\na1.sinks.k1.hdfs.roundUnit = minute\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 控制文件个数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#60s或者50字节或者10条数据，谁先满足，就开始滚动生成新文件")]),s._v("\na1.sinks.k1.hdfs.rollInterval = 60\na1.sinks.k1.hdfs.rollSize = 50\na1.sinks.k1.hdfs.rollCount = 10\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个批次写入的数据量")]),s._v("\n\na1.sinks.k1.hdfs.batchSize = 100\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开始本地时间戳--开启后就可以使用%Y-%m-%d去解析时间")]),s._v("\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件类型，默认是Sequencefile，可用DataStream，则为普通文本")]),s._v("\n  a1.sinks.k1.hdfs.fileType = DataStream\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("ul",[t("li",[s._v("启动")])]),s._v(" "),t("div",{staticClass:"language-plain line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/file2Hdfs.conf -Dflume.root.logger=info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-3-采集目录到hdfs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-采集目录到hdfs"}},[s._v("#")]),s._v(" 2.3 采集目录到HDFS")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304838-086ee7f2-6aaf-4b88-9929-1d775de71c6a.png",alt:"img"}})]),s._v(" "),t("ul",[t("li",[s._v("vim  dir2Hdfs.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##注意：不能往监控目中重复丢同名文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("spooldir")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.spoolDir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/kfly/install/flumeData/files")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否将文件的绝对路径添加到header")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.fileHeader")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs://node01:8020/spooldir/%Y-%m-%d/%H%M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.filePrefix")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("events-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.round")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.roundValue")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.roundUnit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("minute")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollInterval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("50")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollCount")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.batchSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.useLocalTimeStamp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件类型，默认是Sequencefile，可用DataStream，则为普通文本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.fileType")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("DataStream")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("ul",[t("li",[s._v("启动")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/dir2Hdfs.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-4-两个agent级联"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-两个agent级联"}},[s._v("#")]),s._v(" 2.4 两个agent级联")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304830-adad9626-6dad-4a7c-8dee-8cb4df251304.png",alt:"img"}})]),s._v(" "),t("ul",[t("li",[s._v("第一个： vim dir2avro.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##注意：不能往监控目录中重复丢同名文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("spooldir")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.spoolDir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/kfly/install/flumeData/files")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.fileHeader")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AvroSink是用来通过网络来传输数据的,可以将event发送到RPC服务器(比如AvroSource)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("avro")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#node02 注意修改为自己的hostname")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hostname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node02")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5211")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("ul",[t("li",[s._v("第二个：vim avro2Hdfs.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过AvroSource接受AvroSink的网络数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("avro")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AvroSource服务的ip地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node02")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AvroSource服务的端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5211")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs://node01:8020/avro-hdfs/%Y-%m-%d/%H-%M")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.filePrefix")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("events-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.round")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.roundValue")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.roundUnit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("minute")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollInterval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("50")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollCount")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.batchSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.useLocalTimeStamp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件类型，默认是Sequencefile，可用DataStream，则为普通文本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.fileType")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("DataStream")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("ul",[t("li",[s._v("启动\n1、先启动第二个flume。然后在启动第一个flume")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/avro2Hdfs.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("​\t\t2、 启动第一个")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/dir2avro.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_3-高可用配置案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-高可用配置案例"}},[s._v("#")]),s._v(" 3. 高可用配置案例")]),s._v(" "),t("h3",{attrs:{id:"_3-1-failover故障转移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-failover故障转移"}},[s._v("#")]),s._v(" 3.1 failover故障转移")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304855-5c476f74-241e-440d-beec-ed92e8310287.png",alt:"img"}})]),s._v(" "),t("h4",{attrs:{id:"_3-1-1-节点分配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-节点分配"}},[s._v("#")]),s._v(" 3.1.1 节点分配")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("名称")]),s._v(" "),t("th",[s._v("服务器主机名")]),s._v(" "),t("th",[s._v("ip地址")]),s._v(" "),t("th",[s._v("角色")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Agent1")]),s._v(" "),t("td",[s._v("node01")]),s._v(" "),t("td",[s._v("192.168.200.200")]),s._v(" "),t("td",[s._v("WebServer")])]),s._v(" "),t("tr",[t("td",[s._v("Collector1")]),s._v(" "),t("td",[s._v("node02")]),s._v(" "),t("td",[s._v("192.168.200.210")]),s._v(" "),t("td",[s._v("AgentMstr1")])]),s._v(" "),t("tr",[t("td",[s._v("Collector2")]),s._v(" "),t("td",[s._v("node03")]),s._v(" "),t("td",[s._v("192.168.200.220")]),s._v(" "),t("td",[s._v("AgentMstr2")])])])]),s._v(" "),t("p",[s._v("​\tAgent1数据分别流入到Collector1和Collector2，Flume NG本身提供了Failover机制，可以自动切换和恢复。")]),s._v(" "),t("ul",[t("li",[s._v("vim flume-client-failover.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#agent name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义了2个sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1 k2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set gruop")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置一个sink组，一个sink组下可以包含很多个sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinkgroups")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("g1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set sink group")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定g1这个sink组下有k1  k2 这2个sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinkgroups.g1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1 k2")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.command")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("tail -F /kfly/install/flumeData/tail.log")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set sink1    指定sink1的数据会传输给node02")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("avro")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hostname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node02")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("52020")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set sink2    指定sink2的数据会传输给node03")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k2.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k2.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("avro")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k2.hostname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node03")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k2.port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("52020")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set failover")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定sink组高可用的策略---failover故障转移")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinkgroups.g1.processor.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("failover")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定k1这个sink的优先级")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinkgroups.g1.processor.priority.k1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定k2这个sink的优先级")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinkgroups.g1.processor.priority.k2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定故障转移的最大时间，如果超时会出现异常")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinkgroups.g1.processor.maxpenalty")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("​\t\t这里首先要申明一个sinkgroups,然后再设置2个sink ,k1与k2,其中2个优先级是10和5。而processor的maxpenalty被设置为10秒，默认是30秒.表示故障转移的最大时间。")]),s._v(" "),t("ul",[t("li",[s._v("vim flume-server-failover.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set Agent name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("avro")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("0.0.0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("52020")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置拦截器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定2个拦截器  i1  i2 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.interceptors")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("i1 i2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#i1的类型为时间戳拦截器  可以解析%Y-%m-%d 时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.interceptors.i1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("timestamp")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#i2的类型为主机拦截器，可以获取当前event中携带的主机名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.interceptors.i2.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("host")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定主机名变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.interceptors.i2.hostHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hostname")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set sink to hdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs://node01:8020/failover/logs/%{hostname}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.filePrefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("%Y-%m-%d")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.round")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.roundValue")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.roundUnit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("minute")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollInterval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("50")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.rollCount")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.batchSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.hdfs.fileType")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("DataStream")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("ul",[t("li",[s._v("先分别在node02和node03上启动flume")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/flume-server-failover.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("然后在node01上启动flume")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/flume-client-failover.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-2-负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-负载均衡"}},[s._v("#")]),s._v(" 3.2 负载均衡")]),s._v(" "),t("ul",[t("li",[s._v("第一个：vim  flume-client-loadbalance.conf")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#agent name")]),s._v("\n  a1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n  a1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\n  a1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set gruop")]),s._v("\n  a1.sinkgroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" g1\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set sink group")]),s._v("\n  a1.sinkgroups.g1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set source")]),s._v("\n  a1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n  a1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n  a1.sources.r1.command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /kfly/install/flumeData/tail.log\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set channel")]),s._v("\n  a1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\n  a1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  a1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set sink1")]),s._v("\n  a1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n  a1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\n  a1.sinks.k1.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node02\n  a1.sinks.k1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52020")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set sink2")]),s._v("\n  a1.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n  a1.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\n  a1.sinks.k2.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node03\n  a1.sinks.k2.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52020")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set load-balance")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定sink组高可用的策略---load_balance负载均衡")]),s._v("\n  a1.sinkgroups.g1.processor.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("load_balance\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认是round_ robin，还可以选择random")]),s._v("\n  a1.sinkgroups.g1.processor.selector "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" round_robin\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果backoff被开启，则sink processor会屏蔽故障的sink")]),s._v("\n  a1.sinkgroups.g1.processor.backoff "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("ul",[t("li",[s._v("后两个：vim  flume-server-loadbalance.conf")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set Agent name")]),s._v("\n  a1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\n  a1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n  a1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set channel")]),s._v("\n  a1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\n  a1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  a1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set source")]),s._v("\n  a1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\n  a1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n  a1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52020")]),s._v("\n  a1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置拦截器")]),s._v("\n  a1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1 i2\n  a1.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" timestamp\n  a1.sources.r1.interceptors.i2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n  a1.sources.r1.interceptors.i2.hostHeader"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hostname\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#hostname不使用ip显示，直接就是该服务器对应的主机名")]),s._v("\n  a1.sources.r1.interceptors.i2.useIP"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#set sink to hdfs")]),s._v("\n  a1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n  a1.sinks.k1.type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hdfs\n  a1.sinks.k1.hdfs.path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hdfs://node01:8020/loadbalance/logs/%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  a1.sinks.k1.hdfs.filePrefix"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%Y-%m-%d\n  a1.sinks.k1.hdfs.round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  a1.sinks.k1.hdfs.roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  a1.sinks.k1.hdfs.roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" minute\n  a1.sinks.k1.hdfs.rollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n  a1.sinks.k1.hdfs.rollSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n  a1.sinks.k1.hdfs.rollCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  a1.sinks.k1.hdfs.batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  a1.sinks.k1.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br")])]),t("ul",[t("li",[s._v("先分别启动后两个flume")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/flume-server-loadbalance.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("然后在node01上启动flume")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("bin/flume-ng agent -n a1 -c myconf -f myconf/flume-client-loadbalance.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info,console\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-3-静态拦截器使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-静态拦截器使用"}},[s._v("#")]),s._v(" 3.3 静态拦截器使用")]),s._v(" "),t("ul",[t("li",[s._v("场景")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("A、B两台日志服务机器实时生产日志主要类型为access.log、nginx.log、web.log \n现在需要把A、B 机器中的access.log、nginx.log、web.log 采集汇总到C机器上然后统一收集到hdfs中。\n但是在hdfs中要求的目录为：\n/source/logs/access/20180101/**\n/source/logs/nginx/20180101/**\n/source/logs/web/20180101/**\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("场景分析")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304850-aa01ae73-2379-4415-8fe6-3c2db672a90f.png",alt:"img"}})]),s._v(" "),t("ul",[t("li",[s._v("数据流程处理分析")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/kflys/uPic/raw/master/uPic/1613725304834-4181fa31-49da-4f85-846c-dff415ddd8b9.png",alt:"img"}})]),s._v(" "),t("ul",[t("li",[s._v("vim exec_source_avro_sink.conf")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Name the components on this agent\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义三个source")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1 r2 r3\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\na1.sources.r1.command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /kfly/install/flumeData/access.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定source r1 使用拦截器i1")]),s._v("\na1.sources.r1.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拦截器类型static静态")]),s._v("\na1.sources.r1.interceptors.i1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" static\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# static拦截器的功能就是往采集到的数据的header中插入自己定义的key-value对")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自己进行设置,我们这里的key和value相当于键值对,k=type v=access")]),s._v("\na1.sources.r1.interceptors.i1.key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v("\na1.sources.r1.interceptors.i1.value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" access\n\na1.sources.r2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\na1.sources.r2.command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /kfly/install/flumeData/nginx.log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定source r2 使用拦截器i2")]),s._v("\na1.sources.r2.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i2\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拦截器类型static静态")]),s._v("\na1.sources.r2.interceptors.i2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" static\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自己进行设置")]),s._v("\na1.sources.r2.interceptors.i2.key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v("\na1.sources.r2.interceptors.i2.value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nginx\n\na1.sources.r3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\na1.sources.r3.command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /kfly/install/flumeData/web.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定source r3 使用拦截器i3")]),s._v("\na1.sources.r3.interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i3\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拦截器类型static静态")]),s._v("\na1.sources.r3.interceptors.i3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" static\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自己进行设置")]),s._v("\na1.sources.r3.interceptors.i3.key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v("\na1.sources.r3.interceptors.i3.value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" web\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k1.hostname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node03\na1.sinks.k1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41414")]),s._v("\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sources.r2.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sources.r3.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br")])]),t("ul",[t("li",[s._v("vim avro_source_hdfs_sink.conf")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("a1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义source")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" node03\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41414")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义channels")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义sink")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此处的%{type} 这里是取我们在node01和node02定义的type的值,也就是value")]),s._v("\na1.sinks.k1.hdfs.path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hdfs://node01:8020/source/logs/%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%Y%m%d\na1.sinks.k1.hdfs.filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("events-\na1.sinks.k1.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\na1.sinks.k1.hdfs.writeFormat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Text\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#时间类型")]),s._v("\na1.sinks.k1.hdfs.useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件不按条数生成")]),s._v("\na1.sinks.k1.hdfs.rollCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件按时间生成")]),s._v("\na1.sinks.k1.hdfs.rollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件按大小生成")]),s._v("\na1.sinks.k1.hdfs.rollSize  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10485760")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#批量写入hdfs的个数")]),s._v("\na1.sinks.k1.hdfs.batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flume操作hdfs的线程数（包括新建，写入等）")]),s._v("\na1.sinks.k1.hdfs.threadsPoolSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#操作hdfs超时时间")]),s._v("\na1.sinks.k1.hdfs.callTimeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#组装source、channel、sink")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("h3",{attrs:{id:"_3-4-自定义拦截器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-自定义拦截器"}},[s._v("#")]),s._v(" 3.4 自定义拦截器")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.flume"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("flume-ng-core"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.6.0-cdh5.14.2"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// flume自定义拦截器对数据加密")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomInterceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定需要加密的字段下标")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" encrypted_field_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定不需要对应列的下标")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" out_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 提供构建方法，后期可以接受配置文件中的参数")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomInterceptor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" encrypted_field_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" out_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定义拦截器规则")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" line "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Charsets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UTF_8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// TODO 处理逻辑      ")]),s._v("\n      event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBody")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newLine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Charsets")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UTF_8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 遍历调用intercept")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyBuilder")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomInterceptor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Builder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定需要加密的字段下标")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" encrypted_field_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定不需要对应列的下标")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" out_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomInterceptor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomInterceptor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("encrypted_field_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" out_index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 后去flume配置文件中指定的内容          ")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encrypted_field_index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"encrypted_field_index"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out_index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"out_index"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br")])]),t("ul",[t("li",[s._v("打成jar包后放到flume安装目录下的lib中")]),s._v(" "),t("li",[s._v("创建配置文件 flume-interceptor-hdfs.conf")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Name")]),s._v(" the components on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v(" agent\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n#配置source\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" exec\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tail "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("F")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kfly"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("install"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flumeData"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i1\n# 自定义拦截器路径\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("i1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("bigdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("CustomInterceptor")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyBuilder")]),s._v("\n#  传入自定义拦截器的参数\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("i1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encrypted_field_index"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("i1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out_index"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n#配置channel\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n#配置sink\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node01"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8020")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("interceptor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("files"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Y")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("H")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("M")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n# 时间舍弃\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" minute\n# 限定生成文件时机\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rollSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rollCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n#生成的文件类型，默认是"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sequencefile")]),s._v("，可用"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DataStream")]),s._v("，则为普通文本\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DataStream")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("h3",{attrs:{id:"_3-5-自定义source"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-自定义source"}},[s._v("#")]),s._v(" 3.5 自定义Source")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CustomSource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PollableSource")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取 events ，传入下方")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannelProcessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("processEventBatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("READY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BACKOFF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("vim mysqlsource.conf")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Name")]),s._v(" the components on "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),s._v(" agent\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Describe")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("configure the source\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("bigdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("source"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("CustomSource")]),s._v("\n# 老师的是node01"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("同学们改成自己的节点 一定要注意\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jdbc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node03"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysqlsource\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" student\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("columns"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("select "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delay"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Describe")]),s._v(" the channel\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Describe")]),s._v(" the sink\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n\n\n# "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Bind")]),s._v(" the source and sink "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("the")]),s._v(" channel\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"_3-6-自定义sink"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-自定义sink"}},[s._v("#")]),s._v(" 3.6 自定义Sink")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MysqlSink")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSink")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Start transaction")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Channel")]),s._v(" ch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Transaction")]),s._v(" txn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTransaction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("begin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// event取出数据，存入mysql")]),s._v("\n            txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rollback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCause")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            status "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BACKOFF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            txn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("ul",[t("li",[s._v("vim mysqlsink.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("    #配置source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sources.r1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sources.r1.command")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("tail -F /kfly/install/flumeData/data.log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sources.r1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("    #配置channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.channels.c1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.channels.c1.capacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.channels.c1.transactionCapacity")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("    #配置sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sinks.k1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sinks.k1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("bigdata.flume.sink.CustomSink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sinks.k1.mysqlurl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("jdbc:mysql://node03:3306/mysqlsource?useSSL=false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sinks.k1.username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("root")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sinks.k1.password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    a1.sinks.k1.tablename")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("flume2mysql")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h2",{attrs:{id:"_4-注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-注意事项"}},[s._v("#")]),s._v(" 4. 注意事项")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("capacity：默认该通道中最大的可以存储的event数量\ntrasactionCapacity：每次最大可以从source中拿到或者送到sink中的event数量\n注意：capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" trasactionCapacity\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_4-1-hdfs配置说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-hdfs配置说明"}},[s._v("#")]),s._v(" 4.1 HDFS配置说明")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义sink")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na1.sinks.k1.hdfs.path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hdfs://node01:8020/source/logs/%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%Y%m%d\na1.sinks.k1.hdfs.filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("events\na1.sinks.k1.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\na1.sinks.k1.hdfs.writeFormat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Text\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#时间类型")]),s._v("\na1.sinks.k1.hdfs.useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件不按条数生成")]),s._v("\na1.sinks.k1.hdfs.rollCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件按时间生成")]),s._v("\na1.sinks.k1.hdfs.rollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成的文件按大小生成")]),s._v("\na1.sinks.k1.hdfs.rollSize  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10485760")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#批量写入hdfs的个数")]),s._v("\na1.sinks.k1.hdfs.batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flume操作hdfs的线程数（包括新建，写入等）")]),s._v("\na1.sinks.k1.hdfs.threadsPoolSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#操作hdfs超时时间")]),s._v("\na1.sinks.k1.hdfs.callTimeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",[s._v("hdfs.round")]),s._v(" "),t("th",[s._v("false")]),s._v(" "),t("th",[s._v("Should the timestamp be rounded down (if true, affects all time based escape sequences except %t)")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("strong",[s._v("hdfs.roundValue")])]),s._v(" "),t("td",[s._v("1")]),s._v(" "),t("td",[s._v("Rounded down to the highest multiple of this (in the unit configured usinghdfs.roundUnit), less than current time.")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("hdfs.roundUnit")])]),s._v(" "),t("td",[s._v("second")]),s._v(" "),t("td",[s._v("The unit of the round down value - second, minute or hour.")])])])]),s._v(" "),t("p",[s._v("Ø round： 默认值：false 是否启用时间上的”舍弃”，这里的”舍弃”，类似于”四舍五入”")]),s._v(" "),t("p",[s._v("Ø roundValue：默认值：1  时间上进行“舍弃”的值；")]),s._v(" "),t("p",[s._v("Ø roundUnit： 默认值：seconds时间上进行”舍弃”的单位，包含：second,minute,hour")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("# 案例一：\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Y")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("H")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("M")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" minute\n# 当时间为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2015")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v("时候，hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path依然会被解析为：\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2015")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2015")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2015")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v("\n# 因为设置的是舍弃"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("分钟内的时间，因此，该目录每"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("分钟新生成一个。\n\n# 案例二：\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Y")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("H")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("M")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("S")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hdfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" second\n# 现象："),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("秒为时间梯度生成对应的目录，目录下面包括很多小文件！！！\n# 格式如下：\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flume"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2016")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("h3",{attrs:{id:"_4-2-实现数据的断点续传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-实现数据的断点续传"}},[s._v("#")]),s._v(" 4.2 实现数据的断点续传")]),s._v(" "),t("p",[s._v("其本质就是记录下每一次消费的位置，把消费信息的位置保存到文件中，后续程序挂掉了再重启的时候，可以接着上一次消费的数据位置继续拉取。")]),s._v(" "),t("ul",[t("li",[s._v("vim taildir.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("s1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ch1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs-sink1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.ch1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.ch1.capacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.ch1.transactionCapacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("500")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.channels")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ch1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监控一个目录下的多个文件新增的内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("taildir")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过 json 格式存下每个文件消费的偏移量，避免从头消费")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.positionFile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/k/install/flumeData/index/taildir_position.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.filegroups")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("f1 f2 f3 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.filegroups.f1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/hadoop/taillogs/access.log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.filegroups.f2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/hadoop/taillogs/nginx.log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.filegroups.f3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/hadoop/taillogs/web.log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.headers.f1.headerKey")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("access")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.headers.f2.headerKey")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.headers.f3.headerKey")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("web")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.s1.fileHeader")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.channel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ch1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("hdfs://node01:8020/demo/data/%{headerKey}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.filePrefix")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("event_data")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.fileSuffix")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v(".log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.rollSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1048576")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.rollInterval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("20")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.rollCount")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.batchSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1500")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.round")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.roundUnit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("minute")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.threadsPoolSize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("25")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.fileType")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("DataStream")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.writeFormat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("Text")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.hdfs-sink1.hdfs.callTimeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("60000")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("# 运行后生成的 taildir_position.json文件信息如下：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"inode"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102626782")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pos"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"file"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/hadoop/taillogs/access.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"inode"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102626785")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pos"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"file"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/hadoop/taillogs/web.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"inode"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102626786")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pos"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"file"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/hadoop/taillogs/nginx.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n#这里inode就是标记文件的，文件名称改变，这个iNode不会变，pos记录偏移量，file就是绝对路径\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_4-3-header参数配置讲解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-header参数配置讲解"}},[s._v("#")]),s._v(" 4.3 header参数配置讲解")]),s._v(" "),t("ul",[t("li",[s._v("vim test-header.conf")])]),s._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置信息test-header.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("r1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("k1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.channels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("spooldir")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.spoolDir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/hadoop/test")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.batchSize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.inputCharset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("UTF-8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否添加一个key存储目录下文件的绝对路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.fileHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定存储目录下文件的绝对路径的key")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.fileHeaderKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("mm")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否添加一个key存储目录下的文件名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.basenameHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定存储目录下文件的名称的key")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sources.r1.basenameHeaderKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("nn")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#channel")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("memory")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.capacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.channels.c1.transactionCapacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("500")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sink")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("logger")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("a1.sinks.k1.channel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("c1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("ul",[t("li",[s._v("tail / tail -f /tail -F区别")])]),s._v(" "),t("div",{staticClass:"language-markdown line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-markdown"}},[t("code",[t("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" tail -f\n\t等同于--follow=descriptor，根据文件描述符进行追踪，当文件改名或被删除，追踪停止\n"),t("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" tail -F\n\t等同于--follow=name --retry，根据文件名进行追踪，并保持重试，即该文件被删除或改名后，如果再次创建相同的文件名，会继续追踪\n"),t("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" tailf\n\t等同于tail -f -n 10（貌似tail -f或-F默认也是打印最后10行，然后追踪文件），与tail -f不同的是，如果文件不增长，它不会去访问磁盘文件，所以tailf特别适合那些便携机上跟踪日志文件，因为它减少了磁盘访问，\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);