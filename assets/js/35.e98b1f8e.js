(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{521:function(s,t,a){"use strict";a.r(t);var n=a(19),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一、键值设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、键值设计"}},[s._v("#")]),s._v(" "),a("strong",[s._v("一、键值设计")])]),s._v(" "),a("h3",{attrs:{id:"_1、key名设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、key名设计"}},[s._v("#")]),s._v(" 1、key名设计")]),s._v(" "),a("h4",{attrs:{id:"可读性和可管理性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可读性和可管理性"}},[s._v("#")]),s._v(" 可读性和可管理性")]),s._v(" "),a("p",[s._v("以业务名(或数据库名)为前缀(防止key冲突)，用冒号分隔，比如业务名:表名:id")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("ugc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("video"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),s._v(" "),a("h4",{attrs:{id:"简洁性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简洁性"}},[s._v("#")]),s._v(" 简洁性")]),s._v(" "),a("p",[s._v("保证语义的前提下，控制key的长度，当key较多时，内存占用也不容忽视，例如：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("friends"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("messages"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("简化为u"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("uid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("fr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"不要包含特殊字符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不要包含特殊字符"}},[s._v("#")]),s._v(" 不要包含特殊字符")]),s._v(" "),a("p",[s._v("反例：包含空格、换行、单双引号以及其他转义字符")]),s._v(" "),a("h3",{attrs:{id:"_2、value设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、value设计"}},[s._v("#")]),s._v(" 2、value设计")]),s._v(" "),a("h4",{attrs:{id:"拒绝bigkey"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拒绝bigkey"}},[s._v("#")]),s._v(" 拒绝bigkey")]),s._v(" "),a("p",[s._v("防止网卡流量、慢查询，string类型控制在10KB以内，hash、list、set、zset元素个数不要超过5000。\n反例：一个包含200万个元素的list。\n非字符串的bigkey，不要使用del删除，使用hscan、sscan、zscan方式渐进式删除，同时要注意防止bigkey过期时间自动删除问题(例如一个200万的zset设置1小时过期，会触发del操作，造成阻塞，而且该操作不会不出现在慢查询中(latency可查))，查找方法和删除方法")]),s._v(" "),a("h4",{attrs:{id:"选择适合的数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选择适合的数据类型"}},[s._v("#")]),s._v(" 选择适合的数据类型")]),s._v(" "),a("p",[s._v("例如：实体类型(要合理控制和使用数据结构内存编码优化配置,例如ziplist，但也要注意节省内存和性能之间的平衡)\n反例：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("set user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("name tomset user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("age 19set user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("favor football\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("正例：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("hmset user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" name tom age "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" favor football\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"控制key的生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制key的生命周期"}},[s._v("#")]),s._v(" 控制key的生命周期")]),s._v(" "),a("p",[s._v("redis不是垃圾桶，建议使用expire设置过期时间(条件允许可以打散过期时间，防止集中过期)，不过期的数据重点关注idletime。")]),s._v(" "),a("h2",{attrs:{id:"二、命令使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、命令使用"}},[s._v("#")]),s._v(" "),a("strong",[s._v("二、命令使用")])]),s._v(" "),a("h4",{attrs:{id:"_1、o-n-命令关注n的数量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、o-n-命令关注n的数量"}},[s._v("#")]),s._v(" 1、O(N)命令关注N的数量")]),s._v(" "),a("p",[s._v("例如hgetall、lrange、smembers、zrange、sinter等并非不能使用，但是需要明确N的值。有遍历的需求可以使用hscan、sscan、zscan代替。")]),s._v(" "),a("h4",{attrs:{id:"_2、禁用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、禁用命令"}},[s._v("#")]),s._v(" 2、禁用命令")]),s._v(" "),a("p",[s._v("禁止线上使用keys、flushall、flushdb等，通过redis的rename机制禁掉命令，或者使用scan的方式渐进式处理。")]),s._v(" "),a("h4",{attrs:{id:"_3、合理使用select"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、合理使用select"}},[s._v("#")]),s._v(" 3、合理使用select")]),s._v(" "),a("p",[s._v("redis的多数据库较弱，使用数字进行区分，很多客户端支持较差，同时多业务用多数据库实际还是单线程处理，会有干扰。")]),s._v(" "),a("h4",{attrs:{id:"_4、使用批量操作提高效率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用批量操作提高效率"}},[s._v("#")]),s._v(" 4、使用批量操作提高效率")]),s._v(" "),a("ul",[a("li",[s._v("原生命令：例如mget、mset。")]),s._v(" "),a("li",[s._v("非原生命令：可以使用pipeline提高效率。")])]),s._v(" "),a("p",[s._v("但要注意控制一次批量操作的"),a("strong",[s._v("元素个数")]),s._v(" (例如500以内，实际也和元素字节数有关)。\n注意两者不同：")]),s._v(" "),a("ul",[a("li",[s._v("原生是原子操作，pipeline是非原子操作。")]),s._v(" "),a("li",[s._v("pipeline可以打包不同的命令，原生做不到")]),s._v(" "),a("li",[s._v("pipeline需要客户端和服务端同时支持。")])]),s._v(" "),a("h4",{attrs:{id:"_5、不建议过多使用redis事务功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、不建议过多使用redis事务功能"}},[s._v("#")]),s._v(" 5、不建议过多使用Redis事务功能")]),s._v(" "),a("p",[s._v("Redis的事务功能较弱(不支持回滚)，而且集群版本(自研和官方)要求一次事务操作的key必须在一个slot上(可以使用hashtag功能解决)")]),s._v(" "),a("h4",{attrs:{id:"_6、redis集群版本在使用lua上有特殊要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、redis集群版本在使用lua上有特殊要求"}},[s._v("#")]),s._v(" 6、Redis集群版本在使用Lua上有特殊要求")]),s._v(" "),a("p",[s._v('1、所有key都应该由 KEYS 数组来传递，redis.call/pcall 里面调用的redis命令，key的位置，必须是KEYS array, 否则直接返回error，"-ERR bad lua script for redis cluster, all the keys that the script uses should be passed using the KEYS arrayrn"\n2、所有key，必须在1个slot上，否则直接返回error, "-ERR eval/evalsha command keys must in same slotrn"')]),s._v(" "),a("h4",{attrs:{id:"_7、monitor命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、monitor命令"}},[s._v("#")]),s._v(" 7、monitor命令")]),s._v(" "),a("p",[s._v("必要情况下使用monitor命令时，要注意不要长时间使用。")]),s._v(" "),a("h2",{attrs:{id:"三、客户端使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、客户端使用"}},[s._v("#")]),s._v(" "),a("strong",[s._v("三、客户端使用")])]),s._v(" "),a("h4",{attrs:{id:"_1、避免多个应用使用一个redis实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、避免多个应用使用一个redis实例"}},[s._v("#")]),s._v(" 1、避免多个应用使用一个Redis实例")]),s._v(" "),a("p",[s._v("不相干的业务拆分，公共数据做服务化。")]),s._v(" "),a("h4",{attrs:{id:"_2、使用连接池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用连接池"}},[s._v("#")]),s._v(" 2、使用连接池")]),s._v(" "),a("p",[s._v("可以有效控制连接，同时提高效率，标准使用方式：")]),s._v(" "),a("h4",{attrs:{id:"_3、熔断功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、熔断功能"}},[s._v("#")]),s._v(" 3、熔断功能")]),s._v(" "),a("p",[s._v("高并发下建议客户端添加熔断功能(例如netflix hystrix)")]),s._v(" "),a("h4",{attrs:{id:"_4、合理的加密"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、合理的加密"}},[s._v("#")]),s._v(" 4、合理的加密")]),s._v(" "),a("p",[s._v("设置合理的密码，如有必要可以使用SSL加密访问（阿里云Redis支持）")]),s._v(" "),a("h4",{attrs:{id:"_5、淘汰策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、淘汰策略"}},[s._v("#")]),s._v(" 5、淘汰策略")]),s._v(" "),a("p",[s._v("根据自身业务类型，选好maxmemory-policy(最大内存淘汰策略)，设置好过期时间。\n默认策略是volatile-lru，即超过最大内存后，在过期键中使用lru算法进行key的剔除，保证不过期数据不被删除，但是可能会出现OOM问题。\n"),a("strong",[s._v("其他策略如下：")])]),s._v(" "),a("ul",[a("li",[s._v("allkeys-lru：根据LRU算法删除键，不管数据有没有设置超时属性，直到腾出足够空间为止。")]),s._v(" "),a("li",[s._v("allkeys-random：随机删除所有键，直到腾出足够空间为止。")]),s._v(" "),a("li",[s._v("volatile-random:随机删除过期键，直到腾出足够空间为止。")]),s._v(" "),a("li",[s._v("volatile-ttl：根据键值对象的ttl属性，删除最近将要过期数据。如果没有，回退到noeviction策略。")]),s._v(" "),a("li",[s._v('noeviction：不会剔除任何数据，拒绝所有写入操作并返回客户端错误信息"(error) OOM command not allowed when used memory"，此时Redis只响应读操作。')])]),s._v(" "),a("h2",{attrs:{id:"四、相关工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、相关工具"}},[s._v("#")]),s._v(" "),a("strong",[s._v("四、相关工具")])]),s._v(" "),a("h4",{attrs:{id:"_1、数据同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、数据同步"}},[s._v("#")]),s._v(" 1、数据同步")]),s._v(" "),a("p",[s._v("redis间数据同步可以使用：redis-port")]),s._v(" "),a("h4",{attrs:{id:"_2、big-key搜索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、big-key搜索"}},[s._v("#")]),s._v(" 2、big key搜索")]),s._v(" "),a("p",[s._v("redis大key搜索工具")]),s._v(" "),a("h4",{attrs:{id:"_3、热点key寻找"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、热点key寻找"}},[s._v("#")]),s._v(" 3、热点key寻找")]),s._v(" "),a("p",[s._v("内部实现使用monitor，所以建议短时间使用facebook的redis-faina 阿里云Redis已经在内核层面解决热点key问题")]),s._v(" "),a("h2",{attrs:{id:"五、删除bigkey"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、删除bigkey"}},[s._v("#")]),s._v(" "),a("strong",[s._v("五、删除bigkey")])]),s._v(" "),a("ul",[a("li",[s._v("下面操作可以使用pipeline加速。")]),s._v(" "),a("li",[s._v("redis 4.0已经支持key的异步删除，欢迎使用。")])]),s._v(" "),a("h4",{attrs:{id:"_1、hash删除-hscan-hdel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、hash删除-hscan-hdel"}},[s._v("#")]),s._v(" 1、Hash删除: hscan + hdel")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("public void delBigHash(String host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" int port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String bigHashKey) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Jedis jedis = new Jedis(host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port);\n    if (password != "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" && !"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(".equals(password)) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        jedis.auth(password);\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    ScanParams scanParams = new ScanParams().count("),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(");\n    String cursor = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(";\n    do "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ScanResult<Entry<String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String>> scanResult = jedis.hscan(bigHashKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cursor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" scanParams);\n        List<Entry<String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String>> entryList = scanResult.getResult();\n        if (entryList != "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" && !entryList.isEmpty()) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            for (Entry<String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String> entry "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" entryList) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                jedis.hdel(bigHashKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" entry.getKey());\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        cursor = scanResult.getStringCursor();\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" while (!"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(".equals(cursor));\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//删除bigkey")]),s._v("\n    jedis.del(bigHashKey);\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"_2、list删除-ltrim"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、list删除-ltrim"}},[s._v("#")]),s._v(" 2、List删除: ltrim")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("public void delBigList(String host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" int port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String bigListKey) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Jedis jedis = new Jedis(host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port);\n    if (password != "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" && !"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(".equals(password)) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        jedis.auth(password);\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    long llen = jedis.llen(bigListKey);\n    int counter = "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(";\n    int left = "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(";\n    while (counter < llen) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//每次从左侧截掉100个")]),s._v("\n        jedis.ltrim(bigListKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" left"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" llen);\n        counter += left;\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最终删除key")]),s._v("\n    jedis.del(bigListKey);\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"_3、set删除-sscan-srem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、set删除-sscan-srem"}},[s._v("#")]),s._v(" 3、Set删除: sscan + srem")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("public void delBigSet(String host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" int port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String bigSetKey) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Jedis jedis = new Jedis(host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port);\n    if (password != "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" && !"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(".equals(password)) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        jedis.auth(password);\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    ScanParams scanParams = new ScanParams().count("),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(");\n    String cursor = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(";\n    do "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ScanResult<String> scanResult = jedis.sscan(bigSetKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cursor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" scanParams);\n        List<String> memberList = scanResult.getResult();\n        if (memberList != "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" && !memberList.isEmpty()) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            for (String member "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" memberList) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                jedis.srem(bigSetKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" member);\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        cursor = scanResult.getStringCursor();\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" while (!"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(".equals(cursor));\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//删除bigkey")]),s._v("\n    jedis.del(bigSetKey);\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"_4、sortedset删除-zscan-zrem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、sortedset删除-zscan-zrem"}},[s._v("#")]),s._v(" 4、SortedSet删除: zscan + zrem")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("public void delBigZset(String host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" int port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String bigZsetKey) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Jedis jedis = new Jedis(host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port);\n    if (password != "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" && !"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(".equals(password)) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        jedis.auth(password);\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    ScanParams scanParams = new ScanParams().count("),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(");\n    String cursor = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(";\n    do "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ScanResult<Tuple> scanResult = jedis.zscan(bigZsetKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cursor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" scanParams);\n        List<Tuple> tupleList = scanResult.getResult();\n        if (tupleList != "),a("span",{pre:!0,attrs:{class:"token null keyword"}},[s._v("null")]),s._v(" && !tupleList.isEmpty()) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            for (Tuple tuple "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" tupleList) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                jedis.zrem(bigZsetKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tuple.getElement());\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        cursor = scanResult.getStringCursor();\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" while (!"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(".equals(cursor));\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//删除bigkey")]),s._v("\n    jedis.del(bigZsetKey);\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);