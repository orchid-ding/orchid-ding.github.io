(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{624:function(s,t,e){"use strict";e.r(t);var a=e(19),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"opentsdb时序数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#opentsdb时序数据库"}},[s._v("#")]),s._v(" OpentsDB时序数据库")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.jianshu.com/p/1cae8641109b",target:"_blank",rel:"noopener noreferrer"}},[s._v("原理精解参见"),e("OutboundLink")],1)])]),s._v(" "),e("h2",{attrs:{id:"环境搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[s._v("#")]),s._v(" 环境搭建")]),s._v(" "),e("div",{staticClass:"language-markdown line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-markdown"}},[e("code",[e("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 首先确保已经安装了HBase集群\n"),e("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" OpentsDB本身没有集群解决方案，而是以HBase集群为基础实现分布式集群方案。多个节点的OpentsDB访问同一个HBase集群实现。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ol",[e("li",[s._v("安装gnuplot支持，automake等依赖")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gnuplot automake autoconf "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("下载opentsDB\n"),e("ul",[e("li",[s._v("选择相应的版本下载 "),e("a",{attrs:{href:"https://github.com/OpenTSDB/opentsdb/releases/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/OpenTSDB/opentsdb/releases/"),e("OutboundLink")],1)])])]),s._v(" "),e("li",[s._v("安装")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /kfly/install/opentsdb-2.2.0/\n./build.sh \n\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" build/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("启动opentsDB钱准备")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一次启动首先要进行hbase准备,执行初始化脚本")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("COMPRESSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NONE "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HBASE_HOME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/kfly/install/hbase-0.94.27 ./src/create_table.sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("配置文件 opensdb.conf\n"),e("ul",[e("li",[s._v("将配置文件放在build/目录下")]),s._v(" "),e("li",[e("a",{attrs:{href:"http://opentsdb.net/docs/build/html/user_guide/configuration.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详细配置信息查看"),e("OutboundLink")],1)])])])]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --------- NETWORK ----------")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # The TCP port TSD should use for communications")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # *** REQUIRED ***")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(" tsd.network.port")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("4399")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # ----------- HTTP -----------")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # The location of static files for the HTTP GUI interface.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # *** REQUIRED ***")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("tsd.http.staticroot")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("./staticroot")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # Where TSD should write it's cache files to")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # *** REQUIRED ***")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tsd.http.cachedir = /root/openTSDB_temp")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # --------- CORE ----------")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # Whether or not to automatically create UIDs for new metric types, default")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # is False")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(" tsd.core.auto_create_metrics")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# # Name of the HBase table where data points are stored, default is "tsdb"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(" tsd.storage.hbase.data_table")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("tsdb")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# # Path under which the znode for the -ROOT- region is located, default is "/hbase"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("tsd.storage.hbase.zk_basedir")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/hbase")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # A comma separated list of Zookeeper hosts to connect to, with or without")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# # port specifiers, default is "localhost"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("tsd.storage.hbase.zk_quorum")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("server4,server5,server6")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("ol",{attrs:{start:"6"}},[e("li",[s._v("启动")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("./build/tsdb tsd\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"7"}},[e("li",[s._v("日志管理\n"),e("ul",[e("li",[s._v("一般由于opentsdb默认的日志特别多，尤其以nohup启动的话，日志很有可能占满整个磁盘。所以这里需要修改opentsdb的bug级别。")])])])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\x3c!-- Per class logger levels --\x3e\n<logger name="QueryLog" level="OFF" additivity="false">\n  <appender-ref ref="QUERY_LOG"/>\n</logger>\n\x3c!--为减少日志输出，日志级别OFF修改为ERROR--\x3e\n  \x3c!-- Per class logger levels --\x3e\n<logger name="QueryLog" level="ERROR" additivity="false">\n  <appender-ref ref="QUERY_LOG"/>\n</logger>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"java-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#java-api"}},[s._v("#")]),s._v(" Java Api")]),s._v(" "),e("h3",{attrs:{id:"写入数据-详细"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#写入数据-详细"}},[s._v("#")]),s._v(" 写入数据 "),e("a",{attrs:{href:"http://opentsdb.net/docs/build/html/user_guide/writing/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详细"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('HttpClientImpl client = new HttpClientImpl("http://node03:4399");\nMetricBuilder builder = MetricBuilder.getInstance();\nbuilder.addMetric("metric1").setDataPoint(30L)\n  .addTag("tag1", "tab1value").addTag("tag2", "tab2value");\nbuilder.addMetric("metric2").setDataPoint(232.34)\n  .addTag("tag3", "tab3value");\ntry {\n  Response response = client.pushMetrics(builder,\n                                         ExpectResponse.SUMMARY);\n  System.out.println(response);\n} catch (IOException e) {\n  e.printStackTrace();\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"查询数据-详细"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查询数据-详细"}},[s._v("#")]),s._v(" 查询数据 "),e("a",{attrs:{href:"http://opentsdb.net/docs/build/html/user_guide/query/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详细"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('HttpClientImpl client = new HttpClientImpl("http://node03:4399");\nQueryBuilder builder = QueryBuilder.getInstance();\nSubQueries subQueries = new SubQueries();\nString zimsum = Aggregator.zimsum.toString();\nsubQueries.addMetric("top.kfly.host2").addTag("tag", "value");\nsubQueries.addAggregator(zimsum);\nlong now = new Date().getTime() / 1000;\nbuilder.getQuery().addStart(126358720).addEnd(now).addSubQuery(subQueries);\nSimpleHttpResponse response = client.pushQueries(builder,ExpectResponse.STATUS_CODE);\nString content = response.getContent();\nSystem.out.println(content);\nint statusCode = response.getStatusCode();\nif (statusCode == 200) {\n  JSONArray jsonArray = JSON.parseArray(content);\n  System.out.println(jsonArray.toJSONString());\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/shifeng258/opentsdb-client",target:"_blank",rel:"noopener noreferrer"}},[s._v("opentsDB client"),e("OutboundLink")],1)])]),s._v(" "),e("h2",{attrs:{id:"详细教程参见官网"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#详细教程参见官网"}},[s._v("#")]),s._v(" "),e("a",{attrs:{href:"http://opentsdb.net/docs/build/html/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("详细教程参见官网"),e("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);